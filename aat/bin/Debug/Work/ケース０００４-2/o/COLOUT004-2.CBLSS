   NOTE:                                                                    
                                                                            
   プログラム名称       遅延型処理メイン                                    
                                                                            
   機能説明　　　       トランザクションファイルにレコード                  
                        を作成し、機能毎に各プログラムへの                  
   　　　　　　　       振り分けを行う。                                    
                                                                            
   作成　　　　　          04-03-31  (R01.00)  高尾　哲矢                   
                                                                            
   更新履歴　　　          YY-MM-DD  (R99.99)                               
                                                                            
   NEND:                                                                    
   ID:                     HRCAL010                                         
   DATE-WRITTEN.                                                            
   DATE-COMPILED.                                                           
   ED:                                                                      
   CS:                                                                      
   SOURCE-COMPUTER.        ACOS.                                            
   OBJECT-COMPUTER.        ACOS.                                            
   SPACE:0                                                                  
   IOS:                                                                     
   FILE-CONTROL.                                                            
       SELECT  BASED  運用管理ファイル                                      
                           ASSIGN TO FUNYKPTR                               
                           ORGANIZATION IS VSAS RELATIVE                    
                           ACCESS MODE  IS DYNAMIC                          
                           RELATIVE  KEY   ＵＮＹＫ相対キー                 
                           FILE STATUS  IS ＳＴＳコード                     
                                           ＳＴＳ詳細.                      
       SELECT  BASED  世代別運用管理ファイル                                
                           ASSIGN TO FSEUKPTR                               
                           ORGANIZATION IS VSAS RELATIVE                    
                           ACCESS MODE  IS DYNAMIC                          
                           RELATIVE  KEY   ＳＥＵＫ相対キー                 
                           FILE STATUS  IS ＳＴＳコード                     
                                           ＳＴＳ詳細.                      
       SELECT  BASED  パス別受信管理ファイル                                
                           ASSIGN TO FPSJSPTR                               
                           ORGANIZATION IS VSAS RELATIVE                    
                           ACCESS MODE  IS DYNAMIC                          
                           RELATIVE  KEY   ＰＳＪＳ相対キー                 
                           FILE STATUS  IS ＳＴＳコード                     
                                           ＳＴＳ詳細.                      
       SELECT  BASED  有効表                                                
                           ASSIGN TO DYUKOPTR-RDB                           
                           ORGANIZATION IS INDEXED                          
                           ACCESS MODE  IS DYNAMIC                          
                           RECORD KEY   IS ＹＵＫＯ識別コード               
                           FILE STATUS  IS ＳＴＳコード                     
                                           ＳＴＳ詳細.                      
       SELECT  BASED  ゲーム計数ファイル                                    
                           ASSIGN TO FGMKSPTR                               
                           ORGANIZATION IS VSAS INDEXED                     
                           ACCESS MODE  IS DYNAMIC                          
                           RECORD KEY   IS ＧＭＫＳキー項目                 
                           FILE STATUS  IS ＳＴＳコード                     
                                           ＳＴＳ詳細.                      
       SELECT  BASED  トランザクションＥＲＦ                                
                           ASSIGN TO FTRERPTR                               
                           ORGANIZATION IS VSAS RELATIVE                    
                           ACCESS MODE  IS DYNAMIC                          
                           RELATIVE  KEY   ＴＲＥＲ相対キー                 
                           FILE STATUS  IS ＳＴＳコード                     
                                           ＳＴＳ詳細.                      
       SELECT  BASED  トランザクション出力履歴Ｆ                              
                           ASSIGN TO FTRSRPTR                               
                           ORGANIZATION IS VSAS INDEXED                     
                           ACCESS MODE  IS DYNAMIC                          
                           RECORD  KEY  IS ＴＲＳＲキー項目                 
                           FILE  STATUS IS ＳＴＳコード                     
                                           ＳＴＳ詳細.                      
       SELECT  BASED  ゲームタイプファイル                                  
                           ASSIGN TO FGMTYPTR                               
                           ORGANIZATION IS VSAS INDEXED                     
                           ACCESS MODE  IS DYNAMIC                          
                           RECORD  KEY  IS ＧＭＴＹゲームタイプ             
                           FILE  STATUS IS ＳＴＳコード                     
                                           ＳＴＳ詳細.                      
   DD:                                                                      
   FS:                                                                      
  *                                                                         
   FD  運用管理ファイル                                                     
       LABEL RECORD STANDARD.                                               
   01  運用管理Ｒ１.                                                        
       COPY:CFUNK1                                                          
  * 運用管理Ｆのレコード長をあわせるため、運用管理Ｆの第２レコード          
  * （最大レコード長）のコピー句を定義                                      
   01  運用管理Ｒ２.                                                        
       COPY:CFUNK2                                                          
  *                                                                         
   FD  世代別運用管理ファイル                                               
       LABEL RECORD STANDARD.                                               
   01  世代別運用管理Ｒ.                                                    
       COPY:CFSUK1                                                          
  *                                                                         
   FD  パス別受信管理ファイル                                               
       LABEL RECORD STANDARD.                                               
   01  パス別受信管理Ｒ.                                                    
       COPY:CFPSJS                                                          
  *                                                                         
   FD  有効表                                                               
       LABEL  RECORD  STANDARD.                                             
   01  有効Ｒ.                                                              
       COPY:CFYUKO                                                          
  *                                                                         
   FD  ゲーム計数ファイル                                                   
       LABEL  RECORD  STANDARD.                                             
   01  ゲーム計数Ｒ.                                                        
       COPY:CFGMKS                                                          
  *                                                                         
   FD  トランザクションＥＲＦ                                               
       LABEL  RECORD  STANDARD.                                             
   01  ＴＲＥＲ管理Ｒ.                                                      
     03  ＴＲＥＲカレント相対キー                                           
                                 COMP-2.                                    
     03  ＴＲＥＲ予備１          PIC  X(2044).                              
   01  ＴＲＥＲ明細Ｒ１.                                                    
     03  ＴＲＥＲデータ種別      PIC  X(01).                                
     03  ＴＲＥＲ処理状態        PIC  X(02).                                
     03  ＴＲＥＲ送受信端末名    PIC  X(06).                                
     03  ＴＲＥＲセンター状態    PIC  X(01).                                
     03  ＴＲＥＲ電文            PIC  X(1456).                              
     03   FILLER                 PIC  X(582).                               
  *                                                                         
   FD  トランザクション出力履歴Ｆ                                           
       LABEL RECORD STANDARD.                                               
   01  トランザクション出力履歴Ｒ.                                          
   COPY: CFTRSR                                                             
  *                                                                         
   FD  ゲームタイプファイル                                                 
       LABEL RECORD STANDARD.                                               
   01  ゲームタイプＲ.                                                      
   COPY: CFGMTY                                                             
  *                                                                         
   NOTE:                                                                    
     データ部（コンスタント）                                               
   NEND:                                                                    
   CNS:                                                                     
   01  リターンコード.                                                      
     03  正常終了          COMP-1   VALUE  000.                             
     03  重送              COMP-1   VALUE  214.                             
     03  欠送              COMP-1   VALUE  215.                             
  *                                                                         
   01  レコードＩＤ.                                                        
     03   発券ＩＤ         PIC 9(01)   VALUE  1.                            
     03   発券取消ＩＤ     PIC 9(01)   VALUE  2.                            
     03   支払ＩＤ         PIC 9(01)   VALUE  4.                            
     03   支払取消ＩＤ     PIC 9(01)   VALUE  5.                            
     03   期限後支払ＩＤ   PIC 9(01)   VALUE  6.                            
     03   代替券ＩＤ       PIC 9(01)   VALUE  7.                            
     03   障害取消ＩＤ     PIC 9(01)   VALUE  8.                            
  *                                                                         
   01  電文種別.                                                            
     03  発券要求                    PIC  X(04) VALUE  "T100".              
     03  発券取消要求                PIC  X(04) VALUE  "T120".              
     03  支払要求                    PIC  X(04) VALUE  "T210".              
     03  代替券発行要求              PIC  X(04) VALUE  "T220".              
     03  支払取消要求                PIC  X(04) VALUE  "T240".              
     03  発券障害取消要求            PIC  X(04) VALUE  "T900".              
  *                                                                         
     03  トランザクション転送要求    PIC  X(04) VALUE  "F100".              
     03  ヘルスチェック              PIC  X(04) VALUE  "F190".              
     03  コネクション情報通知        PIC  X(04) VALUE  "F840".              
     03  発券端末サーバ障害取消要求  PIC  X(04) VALUE  "F900".              
  *                                                                         
     03  トランザクション転送応答Ｊ  PIC  X(04) VALUE ""46313031"".         
     03  コネクション情報通知受付Ｊ  PIC  X(04) VALUE ""46383431"".         
   ; ＳＪＩＳコード                                                         
  *                                                                         
   01 ページ属性.                                                           
     03  通常電文           PIC  X(01) VALUE  ""30"".                       
     03  最終電文           PIC  X(01) VALUE  ""31"".                       
   ; ＳＪＩＳコード                                                         
  *                                                                         
   01  識別コード区分.                                                      
     03  １６桁             PIC  X(01) VALUE  "0".                          
     03  ２４桁             PIC  X(01) VALUE  "1".                          
  *                                                                         
   01 処理区分.                                                             
     03  通常               PIC  X(01) VALUE  "0".                          
     03  再処理             PIC  X(01) VALUE  "1".                          
  *                                                                         
   01 世代.                                                                 
     03  世代Ａ             PIC  9(01) VALUE   1.                           
     03  世代Ｂ             PIC  9(01) VALUE   2.                           
  *                                                                         
   01 フラグ.                                                               
     03  ＯＦＦ             PIC  9(01) VALUE   0.                           
     03  ＯＮ               PIC  9(01) VALUE   1.                           
  *                                                                         
   01 販売チャネル状態.                                                     
     03  未受信             PIC  X(01) VALUE  "0".                          
     03  受信済             PIC  X(01) VALUE  "1".                          
     03  該当なし           PIC  X(01) VALUE  "9".                          
  *                                                                         
   01 ゲーム状態.                                                           
     03  発売中             PIC  X(01) VALUE  "0".                          
     03  発売終了           PIC  X(01) VALUE  "1".                          
  *                                                                         
   01 終了チェック状態.                                                     
     03  未終了             PIC  X(01) VALUE  "0".                          
     03  終了済             PIC  X(01) VALUE  "1".                          
  *                                                                         
   01 販売チャネルコード.                                                   
     03  発券端末           PIC  9(02) VALUE   1.                           
  *                                                                         
   01 支払フラグ.                                                           
     03  期限後支払         PIC  X(01) VALUE  "1".                          
  *                                                                         
   01 レコード状態.                                                         
     03  有効               PIC  X(01) VALUE  "0".                          
     03  無効               PIC  X(01) VALUE  "1".                          
  *                                                                         
   01 サーバ状態.                                                           
     03  稼動               PIC  X(01) VALUE  "1".                          
     03  待機               PIC  X(01) VALUE  "2".                          
     03  停止               PIC  X(01) VALUE  "3".                          
  *                                                                         
   01 トランザクションエラー関連.                                           
     03  電文               PIC  X(01) VALUE  "1".                          
     03  未処理             PIC  X(02) VALUE  "00".                         
  *                                                                         
   01 ゲーム種別.                                                           
     03  ナンバーズ         PIC  9(01) VALUE   1.                           
     03  ロト               PIC  9(01) VALUE   2.                           
  *                                                                         
   01 センター番号.                                                         
     03  第１センター       PIC  9(01) VALUE   1.                           
  *                                                                         
   01 くじ券タイプ.                                                         
     03  単独くじ券           PIC  9(01) VALUE   1.                         
     03  継続くじ券           PIC  9(01) VALUE   2.                         
  *                                                                         
   01 パネル分割.                                                           
     03  １−５パネル編集時   PIC  9(01) VALUE   1.                         
     03  ６−７パネル編集時   PIC  9(01) VALUE   2.                         
  *                                                                         
   01 障害取消方式区分.                                                     
     03  電文通番取消         PIC  X(01) VALUE  "1".                        
     03  識別コード取消       PIC  X(01) VALUE  "2".                        
  *                                                                         
   01 ナンバーズ等級.                                                       
     03  ストレート PIC 1(16) USAGE IS BIT                                  
                                    VALUE B"1000000000000000".              
     03  ボックス   PIC 1(16) USAGE IS BIT                                  
                                    VALUE B"0100000000000000".              
     03  Ｓ／Ｂストレート PIC 1(16) USAGE IS BIT                            
                                    VALUE B"0010000000000000".              
     03  Ｓ／Ｂボックス PIC 1(16) USAGE IS BIT                              
                                    VALUE B"0001000000000000".              
     03  Ｆペア     PIC 1(16) USAGE IS BIT                                  
                                    VALUE B"0000100000000000".              
     03  Ｂペア     PIC 1(16) USAGE IS BIT                                  
                                    VALUE B"0000010000000000".              
     03  チャンス／ピタリ PIC 1(16) USAGE IS BIT                            
                                    VALUE B"0000001000000000".              
     03  チャンス／一字違 PIC 1(16) USAGE IS BIT                            
                                    VALUE B"0000000100000000".              
  *                                                                         
   01  ロト等級.                                                            
     03  １等  PIC 1(16) USAGE IS BIT VALUE B"1000000000000000".            
     03  ２等  PIC 1(16) USAGE IS BIT VALUE B"0100000000000000".            
     03  ３等  PIC 1(16) USAGE IS BIT VALUE B"0010000000000000".            
     03  ４等  PIC 1(16) USAGE IS BIT VALUE B"0001000000000000".            
     03  ５等  PIC 1(16) USAGE IS BIT VALUE B"0000100000000000".            
     03  ６等  PIC 1(16) USAGE IS BIT VALUE B"0000010000000000".            
     03  ７等  PIC 1(16) USAGE IS BIT VALUE B"0000001000000000".            
     03  ８等  PIC 1(16) USAGE IS BIT VALUE B"0000000100000000".            
     03  ９等  PIC 1(16) USAGE IS BIT VALUE B"0000000010000000".            
  *                                                                         
   01  初期化.                                                              
     03  ＴＲＮＳ初期化.                                                    
       05  ＴＲレコード共通.                                                
         07  レコードＩＤ        PIC 9(1)        VALUE  0.                  
         07  識別コード.                                                    
           09  識別コード上      USAGE COMP-2    VALUE  0.                  
           09  識別コード中      USAGE COMP-2    VALUE  0.                  
           09  識別コード下      USAGE COMP-2    VALUE  0.                  
         07  取引日付            USAGE COMP-2    VALUE  0.                  
         07  取引時刻            USAGE COMP-2    VALUE  0.                  
         07  受付日付            USAGE COMP-2    VALUE  0.                  
         07  受付時刻            USAGE COMP-2    VALUE  0.                  
         07  売場コード          PIC X(6)        VALUE  "      ".           
         07  販売員ＩＤ          PIC X(1)        VALUE  " ".                
         07  機種区分            PIC X(2)        VALUE  "  ".               
         07  販売チャネルコード  PIC 9(2)        VALUE  0.                  
         07  ロール番号          PIC 9(7) USAGE COMP-3  VALUE  0.           
         07  連番                PIC 9(4) USAGE COMP-3  VALUE  0.           
         07  連番チェックＤ      PIC 9(1)        VALUE  0.                  
         07  補正ロール番号      PIC 9(7) USAGE COMP-3  VALUE  0.           
         07  補正連番            PIC 9(4) USAGE COMP-3  VALUE  0.           
         07  補正連番チェックＤ  PIC 9(1)        VALUE  0.                  
         07  電文通番            USAGE COMP-2    VALUE  0.                  
         07  出力番号            USAGE COMP-1    VALUE  0.                  
         07  出力枚数            USAGE COMP-1    VALUE  0.                  
         07  金額                PIC 9(13) USAGE COMP-3  VALUE  0.          
         07  入力方式１          PIC X(1)        VALUE  " ".                
         07  入力方式２          PIC X(1)        VALUE  " ".                
  * セキュリティコードは、LOW-VALUE で初期化                                
         07  セキュリティコード  PIC X(20)       VALUE  LOW-VALUE.          
       05  発券共通.                                                        
         07  ゲームＩＤ.                                                    
           09  ゲームタイプ      PIC 9(2)        VALUE  0.                  
           09  ブロックコード    USAGE COMP-1    VALUE  0.                  
           09  開始回号          USAGE COMP-1    VALUE  0.                  
         07  当初継続回号数      PIC 9(1)        VALUE  0.                  
         07  実質継続回号数      PIC 9(1)        VALUE  0.                  
         07  パネル数            PIC 9(1)        VALUE  0.                  
         07  口数                USAGE COMP-1    VALUE  0.                  
         07  ゲーム種別          PIC 9(1)        VALUE  0.                  
         07  分子                PIC 9(2)        VALUE  0.                  
         07  分母                PIC 9(2)        VALUE  0.                  
       05  関連識別ＣＤＬ情報.                                              
         07  発券識別コード.                                                
           09  発券識別コード上  USAGE COMP-2    VALUE  0.                  
           09  発券識別コード中  USAGE COMP-2    VALUE  0.                  
           09  発券識別コード下  USAGE COMP-2    VALUE  0.                  
         07  取消識別コード.                                                
           09  取消識別コード上  USAGE COMP-2    VALUE  0.                  
           09  取消識別コード中  USAGE COMP-2    VALUE  0.                  
           09  取消識別コード下  USAGE COMP-2    VALUE  0.                  
         07  支払識別コード.                                                
           09  支払識別コード上  USAGE COMP-2    VALUE  0.                  
           09  支払識別コード中  USAGE COMP-2    VALUE  0.                  
           09  支払識別コード下  USAGE COMP-2    VALUE  0.                  
         07  代替識別コード.                                                
           09  代替識別コード上  USAGE COMP-2    VALUE  0.                  
           09  代替識別コード中  USAGE COMP-2    VALUE  0.                  
           09  代替識別コード下  USAGE COMP-2    VALUE  0.                  
         07  取消区分            PIC 9(1)        VALUE  0.                  
         07  取消解除カウンタ    PIC 9(1)        VALUE  0.                  
         07  支払取消カウンタ    PIC 9(1)        VALUE  0.                  
         07  特殊取引アドレス    USAGE COMP-2    VALUE  0.                  
         07  特殊取引世代区分    PIC 9(1)        VALUE  0.                  
       05  取消支払情報.                                                    
         07  取消支払売場コード  PIC X(6)        VALUE  "      ".           
         07  取消支払販売員ＩＤ  PIC X(1)        VALUE  " ".                
         07  取消支払取引日付    USAGE COMP-2    VALUE  0.                  
         07  取消支払取引時刻    USAGE COMP-2    VALUE  0.                  
         07  取消支払受付日付    USAGE COMP-2    VALUE  0.                  
         07  取消支払受付時刻    USAGE COMP-2    VALUE  0.                  
         07  取消支払ＦＥＰ番号  PIC 9(2)        VALUE  0.                  
         07  取消支払パス通番    PIC 9(1)        VALUE  0.                  
         07  取消支払Ｃ状態      PIC X(1)        VALUE  " ".                
         07  支払金額            PIC 9(13) USAGE COMP-3  VALUE  0.          
         07  持込認定日          USAGE COMP-2    VALUE  0.                  
         07  回収日              USAGE COMP-2    VALUE  0.                  
       05  申込情報.                                                        
         07  申込明細                                                       
               OCCURS 5 TIMES.                                              
           09  申込数字          PIC 9(15) USAGE COMP-3  VALUE  0.          
           09  クイックピック区分  PIC 9(1)      VALUE  0.                  
           09  申込タイプ          PIC 9(1)      VALUE  0.                  
  * 当せん情報の各判定区分、フラグは、ZERO で初期化                         
       05  当せん情報.                                                      
         07  当せん明細                                                     
               OCCURS 5 TIMES.                                              
           09  当せん等級          PIC 9(2)      VALUE  0.                  
           09  当せん判定区分      PIC X(1)      VALUE  "0".                
           09  支払フラグ          PIC X(1)      VALUE  "0".                
       05  コンビ当せん情報.                                                
         07  コンビ最下位当等級    PIC 9(2)      VALUE  0.                  
         07  コンビ当せん明細                                               
               OCCURS 11 TIMES.                                             
           09  コンビ当せん口数    USAGE COMP-1  VALUE  0.                  
           09  コンビ当判定区分    PIC X(1)      VALUE  "0".                
         07  コンビ支払フラグ      PIC X(1)      VALUE  "0".                
       05  代替券発行情報.                                                  
         07  未抽せん回号数        PIC 9(1)      VALUE  0.                  
         07  特殊代替通算日        USAGE COMP-1  VALUE  0.                  
         07  特殊代替発行時刻      USAGE COMP-2  VALUE  0.                  
       05  レコード状態            PIC X(1)      VALUE  " ".                
       05  センター状態            PIC X(1)      VALUE  " ".                
  * 当せんチェック、事故券登録フラグは、ZERO で初期化                       
       05  当チェックフラグ        PIC X(1)      VALUE  "0".                
       05  事故券登録フラグ        PIC X(1)      VALUE  "0".                
       05  識別コード体系情報.                                              
         07  識別コード区分        PIC X(1)      VALUE  " ".                
         07  旧識別コード.                                                  
           09  旧識別コード上      USAGE COMP-2  VALUE  0.                  
           09  旧識別コード下      USAGE COMP-2  VALUE  0.                  
       05  障害取消通番            USAGE COMP-2  VALUE  0.                  
       05  直前取引情報.                                                    
         07  直前取引ＦＥＰ番号    PIC 9(2)      VALUE  0.                  
         07  直前取引Ｒ番号        PIC X(4)      VALUE  "    ".             
       05  統計情報.                                                        
         07  購入者通番            USAGE COMP-1  VALUE  0.                  
         07  取引通番              USAGE COMP-1  VALUE  0.                  
         07  申込カード種別        USAGE COMP-1  VALUE  0.                  
       05  分割識別コード.                                                  
         07  分割識別コード上      USAGE COMP-2  VALUE  0.                  
         07  分割識別コード中      USAGE COMP-2  VALUE  0.                  
         07  分割識別コード下      USAGE COMP-2  VALUE  0.                  
       05  予備                    PIC X(07)     VALUE  "       ".          
  *                                                                         
   SPACE:0                                                                  
   NOTE:                                                                    
     データ部（作業場所節）                                                 
   NEND:                                                                    
   AS:                                                                      
   01    ワークエリア.                                                      
  *** POINTER ***                                                           
     03  DYUKOPTR                       USAGE POINTER.                      
     03  FGMKSPTR                       USAGE POINTER.                      
     03  FTRERPTR                       USAGE POINTER.                      
     03  YUKOPTR                        USAGE POINTER.                      
  *** リターンコード ***                                                    
     03  ＳＴＳコード                   PIC  X(02).                         
     03  ＳＴＳ詳細                     PIC  9(05).                         
     03  ＷＫ−ＲＴＮＣＤ               PIC  X(02).                         
  *** 相対キー ***                                                          
     03  ＵＮＹＫ相対キー               PIC  9(02).                         
     03  ＳＥＵＫ相対キー               PIC  9(02).                         
     03  ＰＳＪＳ相対キー               PIC  9(02).                         
     03  ＴＲＥＲ相対キー               PIC  9(05).                         
  *** 添字 ***                                                              
     03  IDX-GMTY                       COMP-1.                             
     03  IDX-GMKS                       COMP-1.                             
     03  IDX-SEDAI                      PIC 9(01).                          
     03  IDX-KAIGOU                     COMP-1.                             
     03  IDX-CODE                       COMP-1.                             
  *** カウンタ ***                                                          
     03  CNT                            USAGE  COMP-1.                      
     03  CNT-FEP                        PIC 9(02).                          
     03  CNT-CHANNEL                    PIC 9(02).                          
     03  CNT-PANEL                      PIC 9(02).                          
     03  ＣＮＴ−回号                   COMP-1.                             
     03  ＣＮＴ−当初継続回号数         PIC 9(01).                          
     03  ＣＮＴ−識別                   COMP-1.                             
  *** フラグ ***                                                            
     03  ＦＬＧパネル分割            PIC 9(01).                             
     03  ＦＬＧロトコンビ            PIC 9(01).                             
     03  ＦＬＧくじ券タイプ          PIC 9(01).                             
     03  ＦＬＧ一致                  PIC 9(01).                             
     03  ＦＬＧ終了                  PIC X(01).                             
     03  電文有無フラグ.                                                    
       05  世代別１                   OCCURS  2.                            
         07  ＦＬＧ世代別電文有無            PIC 9(01).                     
       05  ＦＥＰ別１                 OCCURS  20.                           
         07  ＦＬＧＦＥＰ別電文有無          PIC 9(01).                     
       05  世代別２                   OCCURS  2.                            
         07  ＦＥＰ別２                 OCCURS  20.                         
           09  販売チャネルコード別       OCCURS  10.                       
             11  ＦＬＧ世別Ｆ別Ｃ別電文有無  PIC 9(01).                     
     03  ＦＬＧプールＣＨＫ          PIC 9(01).                             
     03  ＦＬＧプール更新            PIC 9(01).                             
  *** 識別コード編集 ***                                                    
     03  ＷＫ−識別コード.                                                  
       05  ＷＫ−識別コード上           PIC  9(08).                         
       05  ＷＫ−識別コード中           PIC  9(08).                         
       05  ＷＫ−識別コード下           PIC  9(08).                         
     03  ＷＫ−識別コードＲ           REDEFINES  ＷＫ−識別コード.          
       05  ＷＫ−識別ゲームタイプ       PIC  9(02).                         
       05  ＷＫ−識別ブロックタイプ     PIC  9(03).                         
       05  ＷＫ−ＦＩＬＬＥＲ           PIC  9(03).                         
       05  ＷＫ−識別西暦下１桁         PIC  9(01).                         
       05  ＷＫ−識別通算日             PIC  9(03).                         
       05  ＷＫ−識別チェックコード     PIC  9(01).                         
       05  ＷＫ−識別チェックデジット   PIC  9(01).                         
       05  ＷＫ−識別ＦＥＰ番号         PIC  9(02).                         
       05  ＷＫ−識別ＦＥＰ内一連番号   PIC  9(08).                         
  *** コンソールメッセージ置換テキスト ***                                  
     03  ＷＫ−ゲーム計数キー.                                              
       05  ＷＫ−計数ゲームタイプ       PIC  9(02).                         
       05  ＷＫ−計数ブロックコード     PIC  9(04).                         
       05  ＷＫ−出力用ブロックコード   PIC  9(03).                         
       05  ＷＫ−出力用販売チャネル     PIC  9(02).                         
       05  ＷＫ−出力用電文日付         PIC  9(08).                         
       05  ＷＫ−出力用電文通番         PIC  9(10).                         
  *** 識別コード変換用 ***                                                  
     03  ＦＬＧ識別変換ＰＴＲセット     PIC  9(01).                         
     03  ＷＫ−変換前識別コード.                                              
       05  ＷＫ−変換前識別コード上     USAGE  COMP-2.                      
       05  ＷＫ−変換前識別コード中     USAGE  COMP-2.                      
       05  ＷＫ−変換前識別コード下     USAGE  COMP-2.                      
     03  ＷＫ−変換後識別コード.                                              
       05  ＷＫ−変換後識別コード上     USAGE  COMP-2.                      
       05  ＷＫ−変換後識別コード中     USAGE  COMP-2.                      
       05  ＷＫ−変換後識別コード下     USAGE  COMP-2.                      
     03  ＷＫ−１６桁識別コード.                                              
       05  ＷＫ−１６桁識別コード上     PIC  9(08).                         
       05  ＷＫ−１６桁識別コード下     PIC  9(08).                         
     03  ＷＫ−２４桁識別コード.                                              
       05  ＷＫ−２４桁識別コード上     PIC  9(08).                         
       05  ＷＫ−２４桁識別コード中     PIC  9(08).                         
       05  ＷＫ−２４桁識別コード下     PIC  9(08).                         
     03  PTR_SBCDBEFORE                 USAGE POINTER.                      
     03  PTR_SBCDAFTER                  USAGE POINTER.                      
  *** コード変換用、送受信端末名編集 ***                                    
     03  ＷＫ−コード変換前項目.                                            
       05  ＷＫ−変換前送受信端末名     PIC  X(06).                         
       05  ＷＫ−変換前センター状態     PIC  X(01).                         
       05  ＷＫ−変換前電文種別         PIC  X(04).                         
     03  ＷＫ−コード変換後項目.                                            
       05  ＷＫ−送受信端末名.                                              
           07  ＷＫ−端末名１           PIC  X(05).                         
           07  ＷＫ−端末名２           PIC  X(01).                         
       05  ＷＫ−送受信端末名Ｒ  REDEFINES  ＷＫ−送受信端末名.             
           07  ＷＫ−サブシステム識別   PIC  X(01).                         
           07  ＷＫ−ＦＥＰ番号         PIC  9(02).                         
           07  ＷＫ−パス種別           PIC  X(01).                         
           07  ＷＫ−パス番号           PIC  9(02).                         
       05  ＷＫ−センター状態           PIC  X(01).                         
       05  ＷＫ−電文種別               PIC  X(04).                         
     03  ＷＫ−送受信端末名２.                                              
       05  ＷＫ−サブシステム識別２     PIC  X(01).                         
       05  ＷＫ−ＦＥＰ番号２           PIC  9(02).                         
       05  ＷＫ−パス種別２             PIC  X(01).                         
       05  ＷＫ−パス番号２             PIC  9(02).                         
  *** 出力電文編集 ***                                                      
     03  ＷＫ−出力電文項目.                                                
       05  ＷＫ−業務リターンコード     COMP-1.                             
       05  ＷＫ−欠送電文日付           COMP-2.                             
       05  ＷＫ−欠送電文通番           COMP-2.                             
  *** 連番編集 ***                                                          
     03  ＷＫ−連番ＣＤ分解           PIC  9(05).                           
     03  ＷＫ−連番ＣＤ分解Ｒ REDEFINES ＷＫ−連番ＣＤ分解.                 
       05  ＷＫ−チケット連番         PIC  9(04).                           
       05  ＷＫ−ＣＤ                 PIC  9(01).                           
  *** 等級編集 ***                                                          
     03  ＷＫ−等級Ｘ                PIC X(02).                             
     03  ＷＫ−等級Ｒ         REDEFINES  ＷＫ−等級Ｘ.                      
       05  ＷＫ−等級ＢＩＴ          PIC 1(16) USAGE BIT.                   
     03  ＷＫ−等級９                PIC 9(02).                             
  *** ゲームタイプ、ゲーム計数一括更新テーブル用 ***                        
     03  ＷＫ−日付                  COMP-2.                                
     03  ＷＫ−ゲームタイプ          PIC 9(02).                             
     03  ＷＫ−ブロックコード        COMP-1.                                
  *** 世代区分判定用 ***                                                    
     03  ＷＫ−世代区分              PIC 9(01).                             
     03  ＷＫ−世代判定業務日付      COMP-2.                                
  *** VMUCA分解用 ***                                                       
     03  WK-TERM.                                                           
       05  WK-TERMHDR      PIC  X(02).  ; 送信元の判定に使用                
       05  WK-TERMDAT      PIC  X(04).                                      
  *** 連番チェックディジット                                                
     03  ＷＫ−ＣＫＤ計算Ｘ.                                                
       05  ＷＫ−ＣＫＤロール番号    PIC 9(07).                             
       05  ＷＫ−ＣＫＤ連番          PIC 9(04).                             
     03  ＷＫ−ＣＫＤ計算９          REDEFINES ＷＫ−ＣＫＤ計算Ｘ           
                                     PIC 9(11).                             
     03  ＷＫ−ＣＫＤ                PIC 9(01).                             
     03  ＷＫ−商                    PIC 9(11).                             
  *** その他 ***                                                            
     03  ＷＫ−ブロック              PIC 9(02).                             
     03  ＷＫ−バイト数              PIC 9(04).                             
     03  ＷＫ−金額９                PIC 9(14).                             
     03  ＷＫ−サーバ状態            PIC X(01).                             
     03  ＷＫ−レコード状態          PIC X(01).                             
     03  ＷＫ−処理区分              PIC X(01).                             
     03  ＷＫ−退避ゲームタイプ      PIC 9(02).                             
     03  ＷＫ−退避ブロックコード    COMP-1.                                
     03  ＷＫ−退避開始回号          COMP-1.                                
     03  ＷＫ−回号                  PIC  9(04).                            
     03  ＷＫ−格納位置              PIC  9(01).                            
     03  ＷＫ−相対番号              COMP-2.                                
     03  ＷＫ−申込通り数            COMP-2.                                
     03  ＷＫ−ＴＲＮＳ件数          COMP-1.                                
     03  ＷＫ−発券電文ＣＮＴ        COMP-1.                                
     03  ＷＫ−発券以外電文ＣＮＴ    COMP-1.                                
     03  ＷＫ−発券レコード件数      COMP-1.                                
     03  ＷＫ−ＧＫレコード件数      COMP-1.                                
     03  ＷＫ−添字                  COMP-1.                                
     03  ＷＫ−パス別電文日付        COMP-2.                                
     03  ＷＫ−パス別電文通番        COMP-2.                                
     03  WK-I                        COMP-1.                                
     03  ＷＫ−履歴ゲームタイプ      PIC 9(02).                             
     03  ＷＫ−履歴ブロックコード    COMP-1.                                
     03 ＷＫ−ブロックコードＸ       PIC X(02).                             
     03 ＷＫ−ブロックコードＲ   REDEFINES  ＷＫ−ブロックコードＸ.         
       05 ＷＫ−ブロックコード９     USAGE COMP-1.                          
  *                                                                         
   NOTE:                                                                    
     パラメータ                                                             
   NEND:                                                                    
  *                                                                         
  * 発券申込パラメータ                                                      
  *                                                                         
   01  発券申込ＰＲＭ.                                                      
     03  ＰＲＭ１世代区分          PIC  9(01).                              
     03  ＰＲＭ１ＧＡＭＥＰＴＲ    POINTER.                                 
     03  ＰＲＭ１処理区分          PIC  X(01).                              
  *                                                                         
  * 障害取消パラメータ                                                      
  *                                                                         
   01  障害取消ＰＲＭ.                                                      
     03  ＰＲＭ２世代区分          PIC  9(01).                              
     03  ＰＲＭ２同期区分          PIC  X(01).                              
     03  ＰＲＭ２終了チェック状態  PIC  X(01).                              
     03  ＰＲＭ２処理日付          COMP-2.                                  
     03  ＰＲＭ２処理通番          COMP-2.                                  
     03  ＰＲＭ２障害取消要求電文  PIC  X(580).                             
                             ; 共通ヘッダ長+発券障害取消要求電文長          
  *                                                                         
  * 発券取消、当せん金支払、代替券発行、支払取消パラメータ                  
  *                                                                         
   01  発券以外ＰＲＭ.                                                      
     03  ＰＲＭ３トランザクションＲ.                                        
     COPY:CFTRNS    (//ＴＲＮＳ// BY //ＰＲＭ３//)                          
     03  ＰＲＭ３世代区分        PIC  9(01).                                
     03  ＰＲＭ３処理区分        PIC  X(01).                                
     03  ＰＲＭ３サーバ状態      PIC  X(01).                                
  *                                                                         
  * 遅延型電文チェック／コード変換パラメータ                                
  *                                                                         
   01  遅延型電文チェックＰＲＭ.                                            
     02  ＣＤＣＫ世代区分          PIC 9(1).                                
     02  ＣＤＣＫ業務日付情報      OCCURS 2 TIMES.                          
       03  ＣＤＣＫ業務日付        PIC 9(08).                               
     02  ＣＤＣＫＧＡＭＥ１ＰＴＲ  POINTER.                                 
     02  ＣＤＣＫＧＡＭＥ２ＰＴＲ  POINTER.                                 
     02  ＣＤＣＫ送受信端末名      PIC X(06).                               
     02  ＣＤＣＫセンター状態      PIC X(01).                               
     02  ＣＤＣＫ入力電文          PIC X(1456).                             
     02  ＣＤＣＫ変換後入力電文.                                            
       COPY:CRT001             (//Ｔ００１// BY //ＣＤＣＫ//)               
      03  ＣＤＣＫ個別データ       PIC X(1394).                             
     02  ＣＤＣＫＲＴＮＣＤ        PIC X(02).                               
  *                                                                         
  * トランザクション出力パラメータ                                          
  *                                                                         
   01  トランザクション出力ＰＲＭ.                                          
       COPY:CLTRBC                                                          
     03  ＴＲＢＣトランザクションＴ  OCCURS  480.                           
      04 ＴＲＢＣトランザクションＲ.                                        
       COPY:CFTRNS           (//ＴＲＮＳ// BY //ＴＰＲＭ//)                 
  *                                                                         
  * プール計数一括更新パラメータ                                            
  *                                                                         
   01  プール計数一括更新ＰＲＭ.                                            
       COPY:CLPLBC                                                          
  *                                                                         
   NOTE:                                                                    
     トランザクションファイル                                               
   NEND:                                                                    
   01  トランザクションファイル.                                            
     03  トランザクションＲ.                                                
       COPY: CFTRNS                                                         
  *                                                                         
   NOTE:                                                                    
     退避エリア                                                             
   NEND:                                                                    
  *                                                                         
   01  退避用ゲーム計数ファイル.                                            
    02  退避ＧＫゲーム計数Ｒ.                                               
        COPY:CFGMKS             (//ＧＭＫＳ// BY //退避ＧＫ//)              
  *                                                                         
   01  共通ヘッダ退避.                                                      
       COPY:CRT001              (//Ｔ００１// BY //退避ＫＨ//)              
                                                                            
  *                                                                         
   NOTE:                                                                    
   発券端末入力電文ＴＢＬ                                                   
   NEND:                                                                    
  *                                                                         
   01  発券電文ＴＢＬ.                                                      
    02  ＷＫ−発券電文ＴＢＬ   OCCURS   127.                                
       COPY:CRT001             (//Ｔ００１// BY //ＷＫ１//)                 
     03  ＷＫ１個別データ          PIC X(1394).                             
  * ＷＫ１個別データのバイト数 = 発券要求電文のバイト数                     
  *  (T100:34 + T101:72 + T103:804 + T104:484)                              
  *                                                                         
  ** 発券要求 **                                                            
     03  発券要求電文         REDEFINES  ＷＫ１個別データ.                  
         COPY:CRT100                                                        
      04  パネル情報.                                                       
          COPY:CRT105                                                       
      04  ハッシュ値情報.                                                   
          COPY:CRT103                                                       
      04  識別コード情報.                                                   
          COPY:CRT104                                                       
  ** 発券障害取消要求 **                                                    
     03  発券障害取消要求電文    REDEFINES  ＷＫ１個別データ.               
         COPY:CRT900                                                        
         05  FILLER      PIC X(862).                                        
  ** 発券端末サーバ障害取消要求 **                                          
     03  発券端末Ｓ障害取消要求電文  REDEFINES  ＷＫ１個別データ.           
         COPY:CRF900                                                        
         05  FILLER      PIC X(898).                                        
  *                                                                         
     03  ＷＫ１終了チェック状態    PIC X(01).                               
     03  ＷＫ１発券金額            PIC 9(13) USAGE COMP-3.                  
     03  ＷＫ１重複電文登録フラグ  PIC 9(01).                               
  *                                                                         
   01  発券以外電文ＴＢＬ.                                                  
    02  ＷＫ−発券以外電文ＴＢＬ   OCCURS   127.                            
       COPY:CRT001             (//Ｔ００１// BY //ＷＫ２//)                 
     03  ＷＫ２個別データ          PIC X(128).                              
  * ＷＫ２個別データのバイト数 = 支払要求電文のバイト数                     
  *  (T210:128Byte)                                                         
  ** 発券取消要求 **                                                        
     03  発券取消要求電文        REDEFINES  ＷＫ２個別データ.               
         COPY:CRT120                                                        
       05  FILLER      PIC X(88).                                           
  ** 支払要求 **                                                            
     03  支払要求電文            REDEFINES  ＷＫ２個別データ.               
           COPY:CRT210                                                      
  ** 代替券発行要求 **                                                      
     03  代替券発行要求電文      REDEFINES  ＷＫ２個別データ.               
         COPY:CRT221                                                        
         05  FILLER      PIC X(46).                                         
  ** 支払取消要求 **                                                        
     03  支払取消要求電文        REDEFINES  ＷＫ２個別データ.               
         COPY:CRT240                                                        
         05  FILLER      PIC X(84).                                         
  *                                                                         
   NOTE:                                                                    
     テーブル                                                               
   NEND:                                                                    
  *                                                                         
   01  世代別運用管理テーブル.                                              
    02  Ｔ−ＳＵ世代別運用管理Ｒ     OCCURS  2.                             
       COPY:CFSUK1            (//ＳＵＫ１// BY //Ｔ−ＳＵ//)                
  *                                                                         
   01  ゲーム計数一括更新ＴＢＬ１.                                          
     02 Ｔ−Ｇ１レコード件数       COMP-1.                                  
     02 Ｔ−Ｇ１ゲーム計数Ｒ       OCCURS  30.                              
       COPY:CFGMKS             (//ＧＭＫＳ// BY //Ｔ−Ｇ１//)               
  *                                                                         
   01  ゲーム計数一括更新ＴＢＬ２.                                          
     02 Ｔ−Ｇ２レコード件数       COMP-1.                                  
     02 Ｔ−Ｇ２ゲーム計数Ｒ       OCCURS  30.                              
       COPY:CFGMKS             (//ＧＭＫＳ// BY //Ｔ−Ｇ２//)               
  *                                                                         
   01  トランザクションテーブル.                                            
     03  Ｔ−ＴＲレコード件数        COMP-2.                                
     03  Ｔ−ＴＲトランザクションＲ  OCCURS  480.                           
         COPY:CFTRNS           (//ＴＲＮＳ// BY //Ｔ−ＴＲ//)               
     03  発券電文ＴＢＬＣＮＴ        OCCURS  480.                           
       05  Ｔ−ＴＲ発券電文ＴＣＮＴ    COMP-1.                              
  *                                                                         
   SPACE:0                                                                  
   NOTE:                                                                    
     データ部（ベースデータ節）                                             
   NEND:                                                                    
   BS:                                                                      
   NOTE:                                                                    
     入力電文  (ＴＷＡ 電文受信領域）                                       
   NEND:                                                                    
  *                                                                         
   01  入力電文                BASED  ON  受信電文ＰＴＲ.                   
       COPY:CRT000                                                          
       COPY:CRT001                                                          
       03  ＲＴＴＲＮＳ転送要求.                                            
         05  ＲＴトランザクション件数    COMP-1.                            
         05  ＲＴページ番号              COMP-1.                            
         05  ＲＴページ属性              PIC X(01).                         
         05  ＲＴ予備                    PIC X(55).                         
       03  FILLER                        PIC X(1328).                       
  *                                                                         
   01  発券端末入力電文            REDEFINES  入力電文.                     
       COPY:CRT001             (//Ｔ００１// BY //ＲＴＸＸ//)               
       03  個別データ          PIC X(1408).                                 
  *                                                                         
   SPACE:0                                                                  
   NOTE:                                                                    
     出力電文  (ＴＷＡ 電文送信領域）                                       
   NEND:                                                                    
  *                                                                         
   01  出力電文                  BASED ON   送信電文ＰＴＲ.                 
       COPY:CRT000             (//Ｔ０００// BY //ＳＴ００//)               
       COPY:CRT001             (//Ｔ００１// BY //ＳＴ０１//)               
       03  ＳＴ業務リターンコード      COMP-1.                              
       03  ＳＴＴＲＮＳ転送応答.                                            
         05  ＳＴ予備                    PIC X(02).                         
         05  ＳＴ欠送電文日付            COMP-2.                            
         05  ＳＴ欠送電文通番            COMP-2.                            
         05  ＳＴトランザクション件数    COMP-1.                            
  *                                                                         
   NOTE:                                                                    
     ＶＭＵＣＡ  (ＴＷＡ ＶＭＵＣＡ領域）                                   
   NEND:                                                                    
   01  ＶＭＵＣＡ　              BASED ON  ＶＭＵＣＡＰＴＲ.                
       COPY: CVMUCA                                                         
  *                                                                         
   NOTE:                                                                    
     個別インターフェース  （ＴＷＡ 個別Ｉ／Ｆ領域）                        
   NEND:                                                                    
  *                                                                         
   01  個別インターフェース領域     BASED ON   個別領域ＰＴＲ.              
  *                                                                         
  * ＷＫ−発券電文ＴＢＬ明細格納領域                                        
  *                                                                         
    02  個別ＩＦ発券電文ＴＢＬ       PIC X(1450).                           
  *                                                                         
  * プール計数一括更新テーブル格納領域                                      
  *                                                                         
    02  プール計数一括更新テーブル.                                         
     03  Ｔ−ＰＬ取引件数        COMP-1.                                    
     03  Ｔ−ＰＬ取引明細        OCCURS  127.                               
       05  Ｔ−ＰＬゲームタイプ         PIC 9(2).                           
       05  Ｔ−ＰＬブロックコード       USAGE COMP-1.                       
       05  Ｔ−ＰＬプール計数一括更新.                                      
         07  Ｔ−ＰＬ開始回号           USAGE COMP-1.                       
         07  Ｔ−ＰＬ回号数             PIC 9(2).                           
         07  Ｔ−ＰＬ口数               USAGE COMP-1.                       
         07  Ｔ−ＰＬパネル数           PIC 9(1).                           
         07  Ｔ−ＰＬパネル別情報       OCCURS 7 TIMES.                     
           09  Ｔ−ＰＬ申込数字         PIC 9(15) USAGE COMP-3.             
           09  Ｔ−ＰＬ申込タイプ       PIC 9(1).                           
  *                                                                         
  * ゲームタイプファイルテーブル格納領域                                    
  *                                                                         
    02  Ｔ−ＧＴレコード件数         COMP-1.                                
    02  Ｔ−ＧＴゲームタイプＲ       OCCURS  99.                            
         COPY:CFGMTY            (//ＧＭＴＹ// BY //Ｔ−ＧＴ//)              
  *                                                                         
   NOTE:                                                                    
     メモリテーブル                                                         
   NEND:                                                                    
  *                                                                         
   01  販売チャネル管理テーブル   BASED ON 販売チャネルＰＴＲ.              
       COPY:CTCHAN                                                          
  *                                                                         
   01  パス管理テーブル           BASED ON パス管理ＰＴＲ.                  
       COPY:CTPATH                                                          
  *                                                                         
   SPACE:0                                                                  
   NOTE:                                                                    
     データ部（連絡節）                                                     
   NEND:                                                                    
   LS:                                                                      
       COPY: VISUCA                                                         
   01  VISFPTR.                                                             
       COPY: CLHFP2                                                         
   SPACE:0                                                                  
   PD:(VISUCA , VISFPTR )                                                   
   NOTE:                                                                    
                                                                            
   手続き （レベル０）                                                      
                                                                            
   NEND:                                                                    
   PROC:MAIN-RTN                                                            
      ENTRY:                                                                
        CALL:S000-RTN              ;  初期処理                              
        CALL:P000-RTN              ;  主処理                                
      EXIT:S                                                                
   SPACE:0                                                                  
   NOTE:                                                                    
                                                                            
   手続き （レベル０）                                                      
                                                                            
   NEND:                                                                    
   NOTE:                                                                    
   初期処理                                                                 
   NEND:                                                                    
   PROC:S000-RTN                                                            
       ENTRY:                                                               
  * 再処理回数チェック                                                      
         IF: TRNS-SUBSEQ  = 1                                               
   ; サブトランザクション回数＝１の場合                                     
            ＷＫ−処理区分 := 通常                                          
         ELSE:                                                              
   ; サブトランザクション回数＝２回以上の場合                               
            ＷＫ−処理区分 := 再処理                                        
         END:                                                               
  * ＴＷＡポインタセット                                                    
         @ZCTTWPTR(RECVPTR = 受信電文ＰＴＲ ,                               
                   SENDPTR = 送信電文ＰＴＲ ,                               
                   VMPTR   = ＶＭＵＣＡＰＴＲ ,                             
                   WKPTR   = 個別領域ＰＴＲ );                              
  * メモリポインタセット                                                    
   ; 販売チャネル管理テーブルポインタセット                                 
         @ZCTJWPTR(KBN = 2 ,                                                
                   PTR = 販売チャネルＰＴＲ );                              
   ; パス管理テーブルポインタセット                                         
         @ZCTJWPTR(KBN = 3 ,                                                
                   PTR = パス管理ＰＴＲ );                                  
  * 運用管理ファイル読込                                                    
         ＵＮＹＫ相対キー := 1                                              
         READ  運用管理ファイル  INVALID KEY CONTINUE                       
         IF: ＳＴＳコード NOT = ZERO                                        
           @ZCTABORT( MSGID  = #RT201 ,                                     
                      PROGID = HRCAL010 ,                                   
                      CNT    = 01 ,                                         
                      TEXT1  = "ｳﾝﾖｳｶﾝﾘF" ,                                 
                      TEXT2  = "-" ,                                        
                      TEXT3  = "-" ,                                        
                      TEXT4  = "READ" ,                                     
                      TEXT5  = ＵＮＹＫ相対キー ,                           
                      TEXT6  = ＳＴＳコード ,                               
                      TEXT7  = ＳＴＳ詳細 ) ;                               
         END:                                                               
  * 世代別運用管理ファイル読込                                              
  * 現世代レコード退避                                                      
         ＳＥＵＫ相対キー := ＵＮＫ１世代区分                               
         READ  世代別運用管理ファイル  INVALID KEY CONTINUE                 
         IF: ＳＴＳコード NOT = ZERO                                        
           @ZCTABORT( MSGID  = #RT201 ,                                     
                      PROGID = HRCAL010 ,                                   
                      CNT    = 02 ,                                         
                      TEXT1  = "ｾﾀﾞｲﾍﾞﾂｳﾝﾖｳｶﾝﾘF" ,                          
                      TEXT2  = "-" ,                                        
                      TEXT3  = "-" ,                                        
                      TEXT4  = "READ" ,                                     
                      TEXT5  = ＳＥＵＫ相対キー ,                           
                      TEXT6  = ＳＴＳコード ,                               
                      TEXT7  = ＳＴＳ詳細 ) ;                               
         END:                                                               
         Ｔ−ＳＵ世代別運用管理Ｒ(ＳＥＵＫ相対キー) ,                       
           := 世代別運用管理Ｒ                                              
  * 別世代レコード退避                                                      
         IF: ＵＮＫ１世代区分 = 世代Ａ                                      
            ＳＥＵＫ相対キー := 世代Ｂ                                      
         ELSE:                                                              
            ＳＥＵＫ相対キー := 世代Ａ                                      
         END:                                                               
         IF: ＵＮＫ１翌日情報作成バッチ = "0"                               
  * 翌日情報作成バッチ中でない場合、別世代の世代別運用管理Ｒを退避          
            READ  世代別運用管理ファイル  INVALID KEY CONTINUE              
            IF: ＳＴＳコード NOT = ZERO                                     
              @ZCTABORT( MSGID  = #RT201 ,                                  
                         PROGID = HRCAL010 ,                                
                         CNT    = 03 ,                                      
                         TEXT1  = "ｾﾀﾞｲﾍﾞﾂｳﾝﾖｳｶﾝﾘF" ,                       
                         TEXT2  = "-" ,                                     
                         TEXT3  = "-" ,                                     
                         TEXT4  = "READ" ,                                  
                         TEXT5  = ＳＥＵＫ相対キー ,                        
                         TEXT6  = ＳＴＳコード ,                            
                         TEXT7  = ＳＴＳ詳細 ) ;                            
            END:                                                            
            Ｔ−ＳＵ世代別運用管理Ｒ(ＳＥＵＫ相対キー) ,                    
              := 世代別運用管理Ｒ                                           
         ELSE:                                                              
  * 翌日情報作成バッチの場合、別世代の世代別運用管理Ｒ退避エリアを          
  * 初期化                                                                  
            INITIALIZE  Ｔ−ＳＵ世代別運用管理Ｒ(ＳＥＵＫ相対キー).         
         END:                                                               
  * 電文受信                                                                
         @ZMSVRECV(PTR   = 受信電文ＰＴＲ  ,                                
                   RTNCD = ＷＫ−ＲＴＮＣＤ  );                             
         CASE: ＷＫ−ＲＴＮＣＤ                                             
         OF: ZERO                                                           
            CONTINUE.                                                       
         OF: "90"                                                           
            RETURN:S                                                        
         OTHER:                                                             
            @ZCTABORT( MSGID  = #RT204 ,                                    
                       PROGID = HRCAL010 ,                                  
                       CNT    = 04 ,                                        
                       TEXT1  = ＷＫ−ＲＴＮＣＤ ) ;                        
         END:                                                               
  * サーバ状態退避                                                          
         IF: ＵＮＫ１自センター番号 = 第１センター                          
            ＷＫ−サーバ状態 := ＵＮＫ１第１基幹業務Ｓ状態                  
         ELSE:                                                              
            ＷＫ−サーバ状態 := ＵＮＫ１第２基幹業務Ｓ状態                  
         END:                                                               
  * サーバ状態チェック                                                      
         IF: ＷＫ−サーバ状態 = 停止                                        
            RETURN:S                                                        
         END:                                                               
  * システムヘッダ、共通ヘッダ情報コード変換、退避                          
         ＷＫ−変換前送受信端末名  :=  Ｔ０００送受信端末名                 
         ＷＫ−変換前センター状態  :=  Ｔ０００センター状態                 
         ＷＫ−変換前電文種別      :=  Ｔ００１電文種別                     
         @ZMSCVCD( MODE    = JISEBC ,                                       
                   TYPE    = ANK ,                                          
                   INDATA  = ＷＫ−コード変換前項目 ,                       
                   OUTDATA = ＷＫ−コード変換後項目 ,                       
                   LENG    =  11 ,                                          
                   RTNCD   =  ＷＫ−ＲＴＮＣＤ );                           
         IF: ＷＫ−ＲＴＮＣＤ NOT = ZERO                                    
           @ZCTABORT( MSGID  = #RT224 ,                                     
                      PROGID = HRCAL010 ,                                   
                      CNT    = 05 ,                                         
                      TEXT1  = ＷＫ−ＲＴＮＣＤ ) ;                         
         END:                                                               
  * ＷＫエリア初期化                                                        
         INITIALIZE  電文有無フラグ.                                        
         INITIALIZE  ＷＫ−出力電文項目.                                    
         INITIALIZE  ＷＫ−日付.                                            
         INITIALIZE  ＷＫ−ゲームタイプ.                                    
         INITIALIZE  ＷＫ−ブロックコード.                                  
         INITIALIZE  ＷＫ−業務リターンコード.                              
         INITIALIZE  ＦＬＧ識別変換ＰＴＲセット.                            
         INITIALIZE  Ｔ−ＰＬ取引件数.                                      
         INITIALIZE  Ｔ−ＧＴレコード件数.                                  
         INITIALIZE  ゲーム計数一括更新ＴＢＬ１.                            
         INITIALIZE  ゲーム計数一括更新ＴＢＬ２.                            
  * Ｔ０００送受信端末名内のパス番号はゼロオリジンのため、１加算            
         ＷＫ−パス番号 := ＷＫ−パス番号 + 1                               
  * トランザクションファイル出力処理のパラメータへセットする値を            
  * 退避しておく                                                            
         ＷＫ−パス別電文日付  :=  Ｔ００１受付日付                         
         ＷＫ−パス別電文通番  :=  Ｔ００１電文通番                         
       EXIT:                                                                
   SPACE:0                                                                  
   NOTE:                                                                    
   主処理                                                                   
   NEND:                                                                    
   PROC:P000-RTN                                                            
       ENTRY:                                                               
  * ＷＫ−処理区分が”通常”の場合のみパス別通番チェック処理を実施          
  * ＷＫ−処理区分が”再処理”の場合、既にパス別通番チェック処理は          
  * ”正常”として完了済でありパス別通番管理ファイルは更新済                
  * また、トランザクションエラーＦ復旧時もパス別通番チェック処理は          
  * 行わない                                                                
         WK-TERM  :=  VM-TERM                                               
  * VMUCA の VM-TERM より、遅延型処理の起動元を判定                         
         IF: ＷＫ−処理区分 = 通常  AND ,                                   
             WK-TERMHDR  =  "FD"                                            
            CALL:  P100-RTN     ;  パス別通番チェック処理                   
         END:                                                               
  * ヘルスチェック電文の場合、かつ、欠送以外の場合、処理終了                
         IF: ＷＫ−電文種別 = ヘルスチェック                                
            IF: ＷＫ−業務リターンコード = 正常終了 OR 重送                 
               RETURN:S                                                     
            END:                                                            
         END:                                                               
  *                                                                         
         IF: ＷＫ−電文種別 = トランザクション転送要求  AND ,               
             ＷＫ−業務リターンコード = 正常終了  AND ,                     
             ＲＴトランザクション件数 NOT = ZERO                            
            CALL:  P200-RTN     ;電文入替処理                               
            CALL:  P300-RTN     ;トランザクション編集処理                   
            CASE: ＷＫ−処理区分                                            
            OF: 通常                                                        
               CALL:  P400-RTN    ;有効表出力処理                           
               CALL:  P500-RTN    ;トランザクションファイル出力処理         
               CALL:  PB00-RTN    ;ゲーム計数一括読込処理                   
               CALL:  P600-RTN    ;発券電文個別処理                         
               CALL:  P700-RTN    ;ゲーム計数一括更新処理                   
               CALL:  TRNSEND-RTN ;トランザクションエンド                   
               CALL:  P800-RTN    ;プール計数一括更新処理                   
            OF: 再処理                                                      
               CALL:  PB00-RTN    ;ゲーム計数一括読込処理                   
               CALL:  P600-RTN    ;発券電文個別処理                         
               CALL:  P800-RTN    ;プール計数一括更新処理                   
            END:                                                            
            CALL:  P900-RTN    ;発券以外電文個別処理                        
         END:                                                               
  * 発券端末サーバからの遅延型電文受信時のみ                                
  * （トランザクションエラーＦ復旧時は電文送信は行わない）                  
         IF: WK-TERMHDR  =  "FD"                                            
            CALL:  PA00-RTN     ;  電文送信処理                             
         END:                                                               
       EXIT:                                                                
  *                                                                         
   SPACE:0                                                                  
   NOTE:                                                                    
   手続き （レベル１）                                                      
   NEND:                                                                    
  *                                                                         
   NOTE:                                                                    
   パス別通番チェック処理                                                   
   NEND:                                                                    
   PROC:P100-RTN                                                            
       ENTRY:                                                               
  * パス別受信管理ファイル読込                                              
         ＰＳＪＳ相対キー := ＷＫ−ＦＥＰ番号                               
         READ  パス別受信管理ファイル  INVALID KEY CONTINUE                 
         IF: ＳＴＳコード NOT = ZERO                                        
           @ZCTABORT( MSGID  = #RT201 ,                                     
                      PROGID = HRCAL010 ,                                   
                      CNT    = 06 ,                                         
                      TEXT1  = "ﾊﾟｽﾍﾞﾂｼﾞｭｼﾝｶﾝﾘF" ,                          
                      TEXT2  = "-" ,                                        
                      TEXT3  = "-" ,                                        
                      TEXT4  = "READ" ,                                     
                      TEXT5  = ＰＳＪＳ相対キー ,                           
                      TEXT6  = ＳＴＳコード ,                               
                      TEXT7  = ＳＴＳ詳細 ) ;                               
         END:                                                               
  * 電文種別に応じて、パス別通番チェック処理をＣＡＬＬ                      
         CASE: ＷＫ−電文種別                                               
           OF: トランザクション転送要求                                     
              CALL: P110-RTN ; パス別通番チェック（ＴＸ転送要求）           
           OF: ヘルスチェック                                               
              CALL: P120-RTN ; パス別通番チェック（ヘルスチェック）         
           OF: コネクション情報通知                                         
              ＷＫ−業務リターンコード := 正常終了                          
         END:                                                               
  * 重送、欠送以外の場合のみ、パス別受信管理レコードを更新                  
  * ※コネクション情報通知の場合は、更新しない                              
         IF: ＷＫ−電文種別 = トランザクション転送要求  OR ,                
                              ヘルスチェック                                
            IF: ＷＫ−業務リターンコード = 正常終了                         
               ＰＳＪＳ最新電文受付日付(ＷＫ−パス番号) ,                   
                 := Ｔ００１受付日付                                        
               ＰＳＪＳ最新電文受付時刻(ＷＫ−パス番号) ,                   
                 := Ｔ００１受付時刻                                        
  * パス別受信管理ファイル更新                                              
               REWRITE  パス別受信管理Ｒ  INVALID KEY CONTINUE              
               IF: ＳＴＳコード NOT = ZERO                                  
                 @ZCTABORT( MSGID  = #RT201 ,                               
                            PROGID = HRCAL010 ,                             
                            CNT    = 07 ,                                   
                            TEXT1  = "ﾊﾟｽﾍﾞﾂｼﾞｭｼﾝｶﾝﾘF" ,                    
                            TEXT2  = "-" ,                                  
                            TEXT3  = "-" ,                                  
                            TEXT4  = "REWRITE" ,                            
                            TEXT5  = ＰＳＪＳ相対キー ,                     
                            TEXT6  = ＳＴＳコード ,                         
                            TEXT7  = ＳＴＳ詳細 ) ;                         
               END:                                                         
            END:                                                            
         END:                                                               
       EXIT:                                                                
  *                                                                         
   SPACE:0                                                                  
   NOTE:                                                                    
   電文入替処理                                                             
   NEND:                                                                    
   PROC:P200-RTN                                                            
       ENTRY:                                                               
  * カウンタ初期化                                                          
         ＷＫ−発券電文ＣＮＴ      :=  ZERO                                 
         ＷＫ−発券以外電文ＣＮＴ  :=  ZERO                                 
  * トランザクション件数退避                                                
         ＷＫ−ＴＲＮＳ件数 := ＲＴトランザクション件数                     
  * 遅延型電文チェック／コード変換パラメータセット（共通部)                 
         ＣＤＣＫ世代区分          := ＵＮＫ１世代区分                      
         ＣＤＣＫ業務日付(1)       := Ｔ−ＳＵ業務日付(1)                   
         ＣＤＣＫ業務日付(2)       := Ｔ−ＳＵ業務日付(2)                   
         SET  ＣＤＣＫＧＡＭＥ１ＰＴＲ  TO  ADDRESS  OF  ,                  
                             ゲーム計数一括更新ＴＢＬ１                     
         SET  ＣＤＣＫＧＡＭＥ２ＰＴＲ  TO  ADDRESS  OF  ,                  
                             ゲーム計数一括更新ＴＢＬ２                     
         ＣＤＣＫ送受信端末名  := ＷＫ−変換前送受信端末名                  
         ＣＤＣＫセンター状態  := ＷＫ−変換前センター状態                  
  * 入力電文数 繰り返し処理                                                 
         CNT := 1                                                           
         WHILE: CNT <= ＷＫ−ＴＲＮＳ件数                                   
  * ブロッキング処理                                                        
            IF: CNT       = 1                                               
               SET 受信電文ＰＴＲ  UP BY 128                                
  * システムヘッダ(20byte) + 共通ヘッダ(20byte)                             
  *  + トランザクション件数等(60byte) = 128byte                             
            ELSE:                                                           
               ＷＫ−ブロック := (ＲＴＸＸ電文長 + 127) / 128               
  * 小数点以下切り捨て                                                      
               ＷＫ−バイト数 := ＷＫ−ブロック * 128                       
               SET 受信電文ＰＴＲ UP BY  ＷＫ−バイト数                     
            END:                                                            
  * 遅延型電文チェック／コード変換処理                                      
  * ※トランザクションエラー復旧時で変換後電文に対する再処理時は、          
  *   遅延型電文チェック／コード変換処理は行わない                          
            IF: WK-TERMHDR = "FD" ; 通常                                    
               ＣＤＣＫ入力電文  :=  発券端末入力電文                       
               ECALL: HSAAL230 (VISUCA , VISFPTR ,                          
                                          遅延型電文チェックＰＲＭ)         
            ELSE: ; トランザクションエラー復旧時                            
               IF: ＲＴＸＸ電文種別(1:1) = "T" OR "F"                       
  * 遅延型電文チェック／コード変換にて変換後の電文の場合                    
                  ＣＤＣＫ変換後入力電文 := 発券端末入力電文                
                  ＣＤＣＫＲＴＮＣＤ := ZERO                                
  * ゲームタイプファイル、ゲーム計数ファイル読込処理                        
                  CASE: ＲＴＸＸ電文種別                                    
                    OF: 発券要求                                            
                       CALL: GMTY-READ-RTN                                  
                       CALL: GMKS-READ-RTN                                  
                    OF: 発券取消要求    OR ,                                
                        支払要求        OR ,                                
                        代替券発行要求  OR ,                                
                        支払取消要求    OR ,                                
                        発券障害取消要求                                    
                       CALL: GMTY-READ-RTN                                  
                  END:                                                      
               ELSE:                                                        
  * 遅延型電文チェック／コード変換にて変換前の電文の場合                    
                  ＣＤＣＫ入力電文  :=  発券端末入力電文                    
                  ECALL: HSAAL230 (VISUCA , VISFPTR ,                       
                                          遅延型電文チェックＰＲＭ)         
               END:                                                         
            END:                                                            
  *                                                                         
            CASE: ＣＤＣＫＲＴＮＣＤ                                        
            OF: ZERO                                                        
  * 発券電文、障害取消電文とそれ以外にわけてテーブルに格納                  
   ; 発券要求、障害取消要求電文                                             
               IF: ＣＤＣＫ電文種別 = 発券要求 OR ,                         
                   ＣＤＣＫ電文種別 = 発券障害取消要求 OR ,                 
                   ＣＤＣＫ電文種別 = 発券端末サーバ障害取消要求            
                     CALL: P210-RTN  ;発券電文テーブルソート処理            
               ELSE:                                                        
   ; 発券取消、支払、代替券発行、支払取消要求電文                           
                 ＷＫ−発券以外電文ＣＮＴ ,                                 
                     := ＷＫ−発券以外電文ＣＮＴ +  1                       
                 ＷＫ−発券以外電文ＴＢＬ(ＷＫ−発券以外電文ＣＮＴ),        
                     :=  ＣＤＣＫ変換後入力電文                             
               END:                                                         
            OF: "90"  ; 電文不正                                            
  * ＣＤＣＫＲＴＮＣＤのリターンコードが"90"（電文不正）の場合、            
  * 次電文の処理へ移る                                                      
               CONTINUE.                                                    
            OTHER:                                                          
               @ZCTABORT( MSGID  = #RT220 ,                                 
                          PROGID = HRCAL010 ,                               
                          CNT  = 08 ) ;                                     
            END:                                                            
            CNT := CNT + 1                                                  
         END:                                                               
       EXIT:                                                                
  *                                                                         
   SPACE:0                                                                  
   NOTE:                                                                    
   トランザクション編集処理                                                 
   NEND:                                                                    
   PROC:P300-RTN                                                            
       ENTRY:                                                               
  * ゲームタイプ、ゲーム計数テーブルセット用ＷＫエリアを初期化              
         INITIALIZE  ＷＫ−日付.                                            
         INITIALIZE  ＷＫ−ゲームタイプ.                                    
         INITIALIZE  ＷＫ−ブロックコード.                                  
  *                                                                         
         Ｔ−ＴＲレコード件数    :=  0                                      
  * 発券レコード作成処理                                                    
         CNT := 1                                                           
         WHILE: CNT <= ＷＫ−発券電文ＣＮＴ                                 
  * 初期化                                                                  
           ＷＫ１重複電文登録フラグ(CNT) := ＯＦＦ                          
           ＷＫ１発券金額(CNT)           := ZERO                            
           ＷＫ−レコード状態            := 有効                            
  * 共通ヘッダ情報退避                                                      
           退避ＫＨ共通ヘッダ  :=  ＷＫ１共通ヘッダ(CNT)                    
  * 電文種別に応じて処理を振り分け                                          
           IF: ＷＫ１電文種別(CNT) = 発券要求                               
              トランザクションファイル  :=  ＴＲＮＳ初期化                  
              CALL: P310-RTN  ;終了チェック処理                             
              IF: ＷＫ−レコード状態 = 有効                                 
                 CALL: P320-RTN  ;発券レコード編集処理                      
              END:                                                          
           ELSE:   ; 障害取消要求                                           
              トランザクションファイル  :=  ＴＲＮＳ初期化                  
              CALL: P310-RTN  ;終了チェック処理                             
              IF: ＷＫ−レコード状態 = 有効                                 
                 CALL: P340-RTN  ;障害取消レコード編集処理                  
              END:                                                          
           END:                                                             
           IF: ＷＫ−レコード状態 = 有効                                    
              ＷＫ１終了チェック状態(CNT) :=  未終了                        
           ELSE:                                                            
  * 販売チャネル終了、またはゲーム終了済の場合                              
              ＷＫ１終了チェック状態(CNT) :=  終了済                        
           END:                                                             
           CNT := CNT + 1                                                   
         END:                                                               
  * 発券、障害取消のレコード件数をＷＫエリアに退避                          
         ＷＫ−発券レコード件数 := Ｔ−ＴＲレコード件数                     
  * ゲームタイプ、ゲーム計数テーブルセット用ＷＫエリアを初期化              
         INITIALIZE  ＷＫ−日付.                                            
         INITIALIZE  ＷＫ−ゲームタイプ.                                    
         INITIALIZE  ＷＫ−ブロックコード.                                  
  * 発券取消、支払、代替券、支払取消レコード作成処理                        
         CNT := 1                                                           
         WHILE: CNT <= ＷＫ−発券以外電文ＣＮＴ                             
  * 共通ヘッダ情報退避                                                      
           退避ＫＨ共通ヘッダ  :=  ＷＫ２共通ヘッダ(CNT)                    
  *                                                                         
           トランザクションファイル  :=  ＴＲＮＳ初期化                     
           ＷＫ−レコード状態 := 有効                                       
           CALL: P310-RTN  ;終了チェック処理                                
           IF: ＷＫ−レコード状態 = 有効                                    
              CALL: P330-RTN  ;発券以外レコード編集処理                     
           END:                                                             
           CNT := CNT + 1                                                   
         END:                                                               
       EXIT:                                                                
  *                                                                         
   SPACE:0                                                                  
   NOTE:                                                                    
   有効表出力処理                                                           
   NEND:                                                                    
   PROC:P400-RTN                                                            
       ENTRY:                                                               
  * アクセス規約により、ＦＥＰ番号の昇順にファイルを出力する                
         CNT-FEP := 1                                                       
         WHILE: CNT-FEP <= ＰＡＴＨＦＥＰ台数                               
           IF: ＦＬＧＦＥＰ別電文有無(CNT-FEP)  =  ＯＮ                     
              CALL: P410-RTN  ; ＦＥＰ別有効表出力処理                      
           END:                                                             
           CNT-FEP := CNT-FEP + 1                                           
         END:                                                               
       EXIT:                                                                
   SPACE:0                                                                  
   NOTE:                                                                    
   トランザクションファイル出力処理                                         
   NEND:                                                                    
   PROC:P500-RTN                                                            
       ENTRY:                                                               
  * アクセス規約により、世代区分、ＦＥＰ番号、販売チャネルコード            
  * の昇順にファイルを出力する                                              
         IDX-SEDAI := 1                                                     
         WHILE: IDX-SEDAI <= 2                                              
           CNT-FEP := 1                                                     
           WHILE: CNT-FEP <= ＰＡＴＨＦＥＰ台数                             
             CNT-CHANNEL := 1                                               
             WHILE: CNT-CHANNEL <= ＣＨＡＮ販売チャネル数                   
               IF: ＦＬＧ世別Ｆ別Ｃ別電文有無 ,                             
                   (IDX-SEDAI CNT-FEP CNT-CHANNEL) = ＯＮ                   
                  CALL: P510-RTN                                            
    ;世代・ＦＥＰ・販売チャネル別トランザクションファイル出力処理           
               END:                                                         
               CNT-CHANNEL := CNT-CHANNEL + 1                               
             END:                                                           
             CNT-FEP := CNT-FEP + 1                                         
           END:                                                             
           IDX-SEDAI := IDX-SEDAI + 1                                       
         END:                                                               
       EXIT:                                                                
  *                                                                         
   SPACE:0                                                                  
   NOTE:                                                                    
   発券電文個別処理                                                         
   NEND:                                                                    
   PROC:P600-RTN                                                            
       ENTRY:                                                               
  *                                                                         
  * 発券要求電文処理                                                        
  *                                                                         
  * ゲームタイプ、ゲーム計数テーブルセット用ＷＫエリアを初期化              
         INITIALIZE  ＷＫ−日付.                                            
         INITIALIZE  ＷＫ−ゲームタイプ.                                    
         INITIALIZE  ＷＫ−ブロックコード.                                  
  * 発券、障害取消要求電文数分、繰り返し                                    
         CNT := 1                                                           
         WHILE: CNT <= ＷＫ−発券電文ＣＮＴ                                 
           IF: ＷＫ１電文種別(CNT) = 発券要求  AND ,                        
               ＷＫ１終了チェック状態(CNT)   = 未終了 AND ,                 
               ＷＫ１重複電文登録フラグ(CNT) = ＯＦＦ                       
  * 前回処理した発券要求電文と受付日付、ゲームタイプ、                      
  * ブロックコードが異なる場合のみ、ゲーム種別、分子等を取得                
              IF: ＷＫ−日付 NOT = ＷＫ１受付日付(CNT)  OR ,                
                  ＷＫ−ゲームタイプ NOT = ,                                
                    Ｔ１００ゲームタイプ(CNT)  OR ,                         
                  ＷＫ−ブロックコード NOT = ,                              
                    Ｔ１００ブロックコード(CNT)                             
                 ＷＫ−日付           :=  ＷＫ１受付日付(CNT)               
                 ＷＫ−ゲームタイプ   := Ｔ１００ゲームタイプ(CNT)          
                 ＷＫ−ブロックコード ,                                     
                   := Ｔ１００ブロックコード(CNT)                           
                 CALL:IDX-GMTYSET-RTN                                       
                   ; ゲームタイプテーブル添字セット処理                     
                 CALL:GMKS-SET-RTN                                          
                   ; ゲーム計数レコードセット処理                           
              END:                                                          
  * 発券申込パラメータセット（個別）                                        
              ＷＫ−世代判定業務日付 := ＷＫ１受付日付(CNT)                 
              CALL: SEDAI-RTN ; 世代区分判定処理                            
              ＰＲＭ１世代区分 := ＷＫ−世代区分                            
              IF: ＰＲＭ１世代区分 = 世代Ａ                                 
                 SET  ＰＲＭ１ＧＡＭＥＰＴＲ ,                              
                   TO  ADDRESS  OF ゲーム計数一括更新ＴＢＬ１               
              ELSE:  ; 世代Ｂ                                               
                 SET  ＰＲＭ１ＧＡＭＥＰＴＲ ,                              
                   TO  ADDRESS  OF ゲーム計数一括更新ＴＢＬ２               
              END:                                                          
              ＰＲＭ１処理区分 := ＷＫ−処理区分                            
  * 個別Ｉ／Ｆ領域にＷＫ−発券電文ＴＢＬの内容をセット                      
  * （発券申込処理にて、同一領域を参照）                                    
              個別ＩＦ発券電文ＴＢＬ := ＷＫ−発券電文ＴＢＬ(CNT)           
  * 発券申込                                                                
              CASE: Ｔ−ＧＴゲーム種別(IDX-GMTY)                            
              OF:ナンバーズ                                                 
                 CASE: 退避ＧＫ分子数(1)                                    
                 OF: 3  ;ナンバーズ３                                       
                    ECALL: HRCHK011 (VISUCA , VISFPTR ,                     
                                               発券申込ＰＲＭ)              
                 OF: 4  ;ナンバーズ４                                       
                    ECALL: HRCHK021 (VISUCA , VISFPTR ,                     
                                               発券申込ＰＲＭ)              
                 END:                                                       
              OF: ロト                                                      
                 ECALL: HRCHK031 (VISUCA , VISFPTR ,                        
                                            発券申込ＰＲＭ)                 
              END:                                                          
           END:                                                             
           CNT := CNT + 1                                                   
         END:                                                               
  *                                                                         
  * 障害取消要求電文処理                                                    
  *                                                                         
         IF: ＷＫ−処理区分  =  通常                                        
  * 障害取消パラメータセット（共通）                                        
           ＰＲＭ２同期区分          := 通常                                
           ＰＲＭ２処理日付          := 0                                   
           ＰＲＭ２処理通番          := 0                                   
  * 発券、障害取消要求電文数分、繰り返し                                    
           CNT := 1                                                         
           WHILE: CNT <= ＷＫ−発券電文ＣＮＴ                               
             IF: ＷＫ１電文種別(CNT) = 発券障害取消要求  OR ,               
                 ＷＫ１電文種別(CNT) = 発券端末サーバ障害取消要求           
  * 終了チェック状態が未終了の場合のみ                                      
                IF: ＷＫ１終了チェック状態(CNT) = 未終了                    
  * 障害取消パラメータセット（個別）                                        
                   ＷＫ−世代判定業務日付 := ＷＫ１受付日付(CNT)            
                   CALL: SEDAI-RTN ; 世代区分判定処理                       
                   ＰＲＭ２世代区分 := ＷＫ−世代区分                       
                   ＰＲＭ２終了チェック状態 ,                               
                     := ＷＫ１終了チェック状態(CNT)                         
                   ＰＲＭ２障害取消要求電文 ,                               
                     := ＷＫ−発券電文ＴＢＬ(CNT)                           
  * 障害取消                                                                
                ECALL: HRCST011 (VISUCA , VISFPTR , 障害取消ＰＲＭ)         
                END:                                                        
             END:                                                           
             CNT := CNT + 1                                                 
           END:                                                             
         END:                                                               
       EXIT:                                                                
  *                                                                         
   SPACE:0                                                                  
   NOTE:                                                                    
     ゲーム計数一括更新処理                                                 
   NEND:                                                                    
   PROC:P700-RTN                                                            
       ENTRY:                                                               
  * アクセス規約により、世代区分の昇順にファイルを更新する                  
         IDX-SEDAI := 1                                                     
         WHILE: IDX-SEDAI <= 2                                              
           IF: ＦＬＧ世代別電文有無(IDX-SEDAI) = ＯＮ                       
              CALL: P710-RTN  ;世代別ゲーム計数一括更新処理                 
           END:                                                             
           IDX-SEDAI := IDX-SEDAI + 1                                       
         END:                                                               
       EXIT:                                                                
  *                                                                         
   SPACE:0                                                                  
   NOTE:                                                                    
     プール計数一括更新処理                                                 
   NEND:                                                                    
   PROC:P800-RTN                                                            
       ENTRY:                                                               
  * アクセス規約により、ゲームタイプ、ブロックコードの昇順に                
  * ファイルを更新する                                                      
  * 尚、プール計数一括更新テーブルは、発券申込処理にて、                    
  * ゲームタイプ、ブロックコードの昇順にソートされている                    
                                                                            
  * ゲームタイプ、ゲーム計数テーブルセット用ＷＫエリアを初期化              
         INITIALIZE  ＷＫ−日付.                                            
         INITIALIZE  ＷＫ−ゲームタイプ.                                    
         INITIALIZE  ＷＫ−ブロックコード.                                  
                                                                            
  * プール計数一括更新パラメータセット（共通）                              
         ＰＬＢＣ世代区分        := ＵＮＫ１世代区分                        
   ; システムヘッダの送受信端末名の退避情報をセット                         
         ＰＬＢＣＦＥＰ識別子    := ＷＫ−ＦＥＰ番号                        
         ＰＬＢＣパス番号        := ＷＫ−パス番号                          
   ; 共通ヘッダ（発券端末サーバ編集）の退避情報をセット                     
         ＰＬＢＣパス別電文日付  := ＷＫ−パス別電文日付                    
         ＰＬＢＣパス別電文通番  := ＷＫ−パス別電文通番                    
  *                                                                         
         CNT := 1                                                           
         ＰＬＢＣ取引件数  := 0                                             
         ＦＬＧプールＣＨＫ := ＯＦＦ                                       
         WHILE: CNT <= Ｔ−ＰＬ取引件数                                     
           ＰＬＢＣ取引件数 := ＰＬＢＣ取引件数 + 1                         
           ＰＬＢＣ一括更新テーブル(ＰＬＢＣ取引件数) ,                     
             :=  Ｔ−ＰＬプール計数一括更新(CNT)                            
           IF: (CNT = Ｔ−ＰＬ取引件数)                                     
  * プール計数一括更新テーブルの最終明細処理時                              
              CALL: P810-RTN  ;ゲーム別プール計数一括更新処理               
           ELSE:                                                            
              IF: (Ｔ−ＰＬゲームタイプ(CNT),                               
                     NOT = Ｔ−ＰＬゲームタイプ(CNT + 1)) OR ,              
                  (Ｔ−ＰＬブロックコード(CNT) ,                            
                    NOT = Ｔ−ＰＬブロックコード(CNT + 1))                  
  * プール計数一括更新テーブルの最終明細処理時以外の場合、かつ              
  * 現明細と次明細のゲームタイプ、またはブロックコードが異なる場合          
                 CALL: P810-RTN  ;ゲーム別プール計数一括更新処理            
                 ＰＬＢＣ取引件数 := 0                                      
              END:                                                          
           END:                                                             
           CNT := CNT + 1                                                   
         END:                                                               
       EXIT:                                                                
  *                                                                         
   SPACE:0                                                                  
   NOTE:                                                                    
     発券以外電文個別処理                                                   
   NEND:                                                                    
   PROC:P900-RTN                                                            
       ENTRY:                                                               
  * 発券以外パラメータセット（共通）                                        
         ＰＲＭ３処理区分    := ＷＫ−処理区分                              
         ＰＲＭ３サーバ状態  := ＷＫ−サーバ状態                            
  * 発券以外要求電文数分、繰り返し                                          
  *（P300-RTN にて発券、障害取消レコード件数をＷＫエリアに退避済）          
         CNT := ＷＫ−発券レコード件数 + 1                                  
         WHILE: CNT <= Ｔ−ＴＲレコード件数                                 
           IF: Ｔ−ＴＲレコード状態(CNT) = 有効                             
              ＰＲＭ３トランザクションＲ ,                                  
                := Ｔ−ＴＲトランザクションＲ(CNT)                          
  *                                                                         
              ＷＫ−世代判定業務日付 := ＰＲＭ３受付日付                    
              CALL: SEDAI-RTN ; 世代区分判定処理                            
              ＰＲＭ３世代区分 := ＷＫ−世代区分                            
  *                                                                         
              CASE: ＰＲＭ３レコードＩＤ                                    
  ** 発券取消 **                                                            
              OF: 発券取消ＩＤ                                              
                 ECALL: HRCHK111 (VISUCA , VISFPTR , 発券以外ＰＲＭ)        
  ** 当せん金支払 **                                                        
              OF: 支払ＩＤ OR 期限後支払ＩＤ                                
                 ECALL: HRCSH011 (VISUCA , VISFPTR , 発券以外ＰＲＭ)        
  ** 代替券発行 **                                                          
              OF: 代替券ＩＤ                                                
                 ECALL: HRCSH021 (VISUCA , VISFPTR , 発券以外ＰＲＭ)        
  ** 支払取消 **                                                            
              OF: 支払取消ＩＤ                                              
                 ECALL: HRCSH031 (VISUCA , VISFPTR , 発券以外ＰＲＭ)        
              END:                                                          
  * トランザクションエンド                                                  
              CALL:TRNSEND-RTN    ;  トランザクションエンド                 
           END:                                                             
           CNT := CNT + 1                                                   
         END:                                                               
       EXIT:                                                                
  *                                                                         
   SPACE:0                                                                  
   NOTE:                                                                    
     電文送信                                                               
   NEND:                                                                    
   PROC:PA00-RTN                                                            
       ENTRY:                                                               
  * 受信電文ＰＴＲのアドレスを入力電文の先頭位置へ再セット                  
         @ZCTTWPTR(RECVPTR = 受信電文ＰＴＲ ) ;                             
  * 入力電文のシステムヘッダ、共通ヘッダを出力電文へセット                  
         ＳＴ００システムヘッダ  :=  Ｔ０００システムヘッダ                 
         ＳＴ０１共通ヘッダ      :=  Ｔ００１共通ヘッダ                     
  *                                                                         
         CASE: ＷＫ−電文種別                                               
           OF: トランザクション転送要求                                     
              ＳＴ００電文長       :=  82                                   
              ＳＴ０１電文長       :=  62                                   
              ＳＴ０１電文種別     :=  トランザクション転送応答Ｊ           
   ; ＪＩＳコードで電文種別をセット                                         
              ＳＴ業務リターンコード   := ＷＫ−業務リターンコード          
              ＳＴ欠送電文日付 :=  ＷＫ−欠送電文日付                       
              ＳＴ欠送電文通番 :=  ＷＫ−欠送電文通番                       
              ＳＴトランザクション件数 ,                                    
                := ＲＴトランザクション件数                                 
           OF: ヘルスチェック                                               
              ＳＴ００電文長       :=  82                                   
              ＳＴ０１電文長       :=  62                                   
              ＳＴ０１電文種別     :=  トランザクション転送応答Ｊ           
   ; ＪＩＳコードで電文種別をセット                                         
  * ＳＴ０１電文通番には、処理済電文通番をセット                            
              ＳＴ０１電文通番     :=  ＷＫ−欠送電文通番 - 1               
              ＳＴ業務リターンコード  := ＷＫ−業務リターンコード           
              ＳＴ欠送電文日付 :=  ＷＫ−欠送電文日付                       
              ＳＴ欠送電文通番 :=  ＷＫ−欠送電文通番                       
              ＳＴトランザクション件数 := 0                                 
           OF: コネクション情報通知                                         
              ＳＴ００電文長       :=  70                                   
              ＳＴ０１電文長       :=  50                                   
              ＳＴ０１電文種別     :=  コネクション情報通知受付Ｊ           
   ; ＪＩＳコードで電文種別をセット                                         
              ＳＴ業務リターンコード   := 0                                 
         END:                                                               
         ＷＫ−送受信端末名        := VM-TERM                               
         ＷＫ−端末名２            := "V"                                   
  * 電文送信                                                                
         @ZMSVSEND(TYPE   = APT ,                                           
                   DOUHOU = NO ,                                            
                   MSGLEN = ＳＴ００電文長 ,                                
                   TERM   = ＷＫ−送受信端末名 ,                            
                   MARK   = SPACE ,                                         
                   PTR    = 送信電文ＰＴＲ ,                                
                   RTNCD  = ＷＫ−ＲＴＮＣＤ ) ;                            
         IF: ＷＫ−ＲＴＮＣＤ NOT = ZERO                                    
            IF: ＷＫ−ＲＴＮＣＤ = "14"  AND , ;ＶＩＳとＶＤが切断          
                ＷＫ−電文種別 = コネクション情報通知                       
  * ＶＩＳ起動直後に、ＶＩＳとＯＬＦのＶＤが未接続の場合、                  
  * 警告ＭＳＧを出力させるのみ（アボートさせない）                          
              @ZCTMSGOT( MSGID  = #RT205 ,                                  
                         PROGID = HRCAL010 ,                                
                         TEXT1  = ＷＫ−ＲＴＮＣＤ ) ;                      
            ELSE:                                                           
              @ZCTABORT( MSGID  = #RT205 ,                                  
                         PROGID = HRCAL010 ,                                
                         CNT    = 09 ,                                      
                         TEXT1  = ＷＫ−ＲＴＮＣＤ ) ;                      
           END:                                                             
         END:                                                               
       EXIT:                                                                
  *                                                                         
   SPACE:0                                                                  
   NOTE:                                                                    
     ゲーム計数一括読込処理                                                 
   NEND:                                                                    
   PROC:PB00-RTN                                                            
       ENTRY:                                                               
  * ゲーム計数一括更新テーブルには、HSAAL230 にて参照用のゲーム             
  * 計数ファイルより READ したレコードが展開されている                      
  * 本サブルーチンにて、更新用のゲーム計数ファイルより再度                  
  * ゲーム計数ファイルを読み込み、ゲーム計数一括更新テーブルへ              
  * レコードを再展開する                                                    
  * （ゲーム計数ファイルのアクセス規約による）                              
                                                                            
  * アクセス規約により、世代区分の昇順にファイルを読み込む                  
         IDX-SEDAI := 1                                                     
         WHILE: IDX-SEDAI <= 2                                              
           IF: ＦＬＧ世代別電文有無(IDX-SEDAI) = ＯＮ                       
              CALL: PB10-RTN  ;世代別ゲーム計数一括読込処理                 
           END:                                                             
           IDX-SEDAI := IDX-SEDAI + 1                                       
         END:                                                               
       EXIT:                                                                
  *                                                                         
   SPACE:0                                                                  
   NOTE:                                                                    
   手続き （レベル２）                                                      
   NEND:                                                                    
  *                                                                         
   NOTE:                                                                    
   パス別通番チェック処理（トランザクション転送要求）                       
   NEND:                                                                    
   PROC:P110-RTN                                                            
       ENTRY:                                                               
         IF: ＰＳＪＳ処理済電文日付(ＷＫ−パス番号) ,                       
                = Ｔ００１受付日付                                          
  * 処理済電文日付と受付日付が同一の場合                                    
            CASE:                                                           
              OF: ＰＳＪＳ処理済電文通番(ＷＫ−パス番号) + 1 ,              
                    = Ｔ００１電文通番                                      
                 IF: ＲＴページ属性  = 通常電文 ; 通常(ｺｰﾄﾞ:0)              
                    ＰＳＪＳ処理済電文通番(ＷＫ−パス番号) ,                
                      := Ｔ００１電文通番                                   
                 ELSE:                                                      
  * ページ属性 = 最終(最終電文)                                             
                    ＰＳＪＳ処理済前日日付(ＷＫ−パス番号) ,                
                     := Ｔ００１受付日付                                    
                    ＰＳＪＳ処理済前日最終通番(ＷＫ−パス番号) ,            
                     := Ｔ００１電文通番                                    
                    ＰＳＪＳ処理済電文日付(ＷＫ−パス番号) ,                
                     := ZERO                                                
                    ＰＳＪＳ処理済電文通番(ＷＫ−パス番号) ,                
                     := ZERO                                                
                 END:                                                       
                 ＷＫ−業務リターンコード := 正常終了                       
              OF: ＰＳＪＳ処理済電文通番(ＷＫ−パス番号) + 1 ,              
                    > Ｔ００１電文通番                                      
                 ＷＫ−業務リターンコード := 重送                           
  * Ｔ００１電文通番が１の場合のみ、警告メッセージを出力                    
                 IF: Ｔ００１電文通番 = 1                                   
                    ＷＫ−出力用電文日付 := ,                               
                      ＰＳＪＳ処理済電文日付(ＷＫ−パス番号)                
                    ＷＫ−出力用電文通番 := ,                               
                      ＰＳＪＳ処理済電文通番(ＷＫ−パス番号)                
                    ＷＫ−送受信端末名２ := ,                               
                      ＷＫ−送受信端末名                                    
                    ＷＫ−パス番号２ := ＷＫ−パス番号２ - 1                
                    @ZCTMSGOT( MSGID   =  #RT107 ,                          
                               PROGID  =  HRCAL010 ,                        
                               TEXT1   =  ＷＫ−送受信端末名２ ,            
                               TEXT2   =  ＷＫ−出力用電文日付 ,            
                               TEXT3   =  ＷＫ−出力用電文通番);            
                 END:                                                       
              OF: ＰＳＪＳ処理済電文通番(ＷＫ−パス番号) + 1 ,              
                    < Ｔ００１電文通番                                      
                 ＷＫ−業務リターンコード := 欠送                           
                 ＷＫ−欠送電文日付 := ,                                    
                   ＰＳＪＳ処理済電文日付(ＷＫ−パス番号)                   
                 ＷＫ−欠送電文通番 := ,                                    
                   ＰＳＪＳ処理済電文通番(ＷＫ−パス番号) + 1               
             END:                                                           
         ELSE:                                                              
  * 処理済電文日付と受付日付が異なる場合                                    
            CASE:                                                           
            OF: ＰＳＪＳ処理済前日日付(ＷＫ−パス番号) ,                    
                  = Ｔ００１受付日付                                        
  * @前日の電文を重複して受信した場合                                      
  * A業務日付切替時刻前に全販売チャネルが販売チャネル                      
  *   終了済となっている発券端末サーバの場合が、障害後に                    
  *   再起動され、当日送信済の最終電文を送信してきた場合                    
  *   （運行監視処理にて、パス別受信管理レコードは日替済）                  
                 IF: ＲＴページ属性  = 通常電文 ; 通常(ｺｰﾄﾞ:0)              
                    ＷＫ−業務リターンコード := 重送                        
                 ELSE:                                                      
  * ページ属性 = 最終(最終電文)                                             
  * @業務日付切替時刻前に全販売チャネルが販売チャネル                      
  *   終了済となっている発券端末サーバの場合が、業務日付                    
  *   切替時刻に、日替の最終電文を送信してきた場合                          
                    ＷＫ−業務リターンコード := 正常終了                    
                 END:                                                       
            OF: ＰＳＪＳ処理済電文日付(ＷＫ−パス番号) ,                    
                  = ZERO                                                    
  * 前日の最終電文受信直後の状態                                            
               IF: Ｔ００１電文通番 = 1                                     
                  IF: ＲＴページ属性 = 通常電文 ; 通常(ｺｰﾄﾞ:0)              
                     ＰＳＪＳ処理済電文日付(ＷＫ−パス番号) ,               
                       := Ｔ００１受付日付                                  
                     ＰＳＪＳ処理済電文通番(ＷＫ−パス番号) ,               
                       := Ｔ００１電文通番                                  
                  ELSE:                                                     
  * ページ属性 = 最終(最終電文)                                             
                     ＰＳＪＳ処理済前日日付(ＷＫ−パス番号) ,               
                      := Ｔ００１受付日付                                   
                     ＰＳＪＳ処理済前日最終通番(ＷＫ−パス番号) ,           
                      := Ｔ００１電文通番                                   
                     ＰＳＪＳ処理済電文日付(ＷＫ−パス番号) ,               
                      := ZERO                                               
                     ＰＳＪＳ処理済電文通番(ＷＫ−パス番号) ,               
                      := ZERO                                               
                  END:                                                      
                  ＷＫ−業務リターンコード := 正常終了                      
               ELSE:                                                        
  * Ｔ００１電文通番 > 1                                                    
                  IF: ＲＴページ属性 = 通常電文 ; 通常(ｺｰﾄﾞ:0)              
                     ＷＫ−業務リターンコード := 欠送                       
                     ＷＫ−欠送電文日付 := Ｔ００１受付日付                 
                     ＷＫ−欠送電文通番 := 1                                
                  ELSE:                                                     
  * ページ属性 = 最終(最終電文)                                             
  * @業務日付切替時刻前に全販売チャネルが販売チャネル                      
  *   終了済となっている発券端末サーバの場合が、業務日付                    
  *   切替時刻に、日替の最終電文を送信してきた場合                          
                     ＷＫ−業務リターンコード := 正常終了                   
                  END:                                                      
               END:                                                         
            OF: ＰＳＪＳ処理済電文日付(ＷＫ−パス番号) ,                    
                  NOT = ZERO                                                
  * 前日の最終電文が欠送した状態で当日の電文を受信した場合                  
               ＷＫ−業務リターンコード := 欠送                             
               ＷＫ−欠送電文日付 := ,                                      
                 ＰＳＪＳ処理済電文日付(ＷＫ−パス番号)                     
               ＷＫ−欠送電文通番 := ,                                      
                 ＰＳＪＳ処理済電文通番(ＷＫ−パス番号) + 1                 
  * 警告メッセージを出力                                                    
               ＷＫ−出力用電文日付 := ,                                    
                 ＰＳＪＳ処理済電文日付(ＷＫ−パス番号)                     
               ＷＫ−出力用電文通番 := ,                                    
                 ＰＳＪＳ処理済電文通番(ＷＫ−パス番号)                     
               ＷＫ−送受信端末名２ := ＷＫ−送受信端末名                   
               ＷＫ−パス番号２     := ＷＫ−パス番号２ - 1                 
               @ZCTMSGOT( MSGID   =  #RT108 ,                               
                          PROGID  =  HRCAL010 ,                             
                          TEXT1   =  ＷＫ−送受信端末名２ ,                 
                          TEXT2   =  ＷＫ−出力用電文日付 ,                 
                          TEXT3   =  ＷＫ−出力用電文通番);                 
            END:                                                            
         END:                                                               
       EXIT:                                                                
  *                                                                         
   SPACE:0                                                                  
   NOTE:                                                                    
   パス別通番チェック処理（ヘルスチェック電文）                             
   NEND:                                                                    
   PROC:P120-RTN                                                            
       ENTRY:                                                               
         IF: ＰＳＪＳ処理済電文日付(ＷＫ−パス番号) ,                       
                = Ｔ００１受付日付                                          
  * 処理済電文日付と受付日付が同一の場合                                    
            CASE:                                                           
              OF: ＰＳＪＳ処理済電文通番(ＷＫ−パス番号)  ,                 
                    = Ｔ００１電文通番                                      
                 ＷＫ−業務リターンコード := 正常終了                       
              OF: ＰＳＪＳ処理済電文通番(ＷＫ−パス番号)  ,                 
                    > Ｔ００１電文通番                                      
                 ＷＫ−業務リターンコード := 重送                           
              OF: ＰＳＪＳ処理済電文通番(ＷＫ−パス番号)  ,                 
                    < Ｔ００１電文通番                                      
                 ＷＫ−業務リターンコード := 欠送                           
                 ＷＫ−欠送電文日付 := ,                                    
                   ＰＳＪＳ処理済電文日付(ＷＫ−パス番号)                   
                 ＷＫ−欠送電文通番 := ,                                    
                   ＰＳＪＳ処理済電文通番(ＷＫ−パス番号) + 1               
             END:                                                           
         ELSE:                                                              
  * 処理済電文日付と受付日付が異なる場合                                    
            CASE:                                                           
            OF: ＰＳＪＳ処理済前日日付(ＷＫ−パス番号) ,                    
                  = Ｔ００１受付日付                                        
  * 前日の電文を重複して受信                                                
               ＷＫ−業務リターンコード := 重送                             
            OF: ＰＳＪＳ処理済電文日付(ＷＫ−パス番号) ,                    
                  = ZERO                                                    
  * ヘルスチェック電文の場合、本条件では通番チェック処理は行わない          
  * ・前日の最終電文受信直後の状態                                          
  * ・当日、電文を１件も受信していない状態                                  
  * ・販売チャネル終了済にてパス別受信管理レコード初期化後の状態            
               ＷＫ−業務リターンコード := 正常終了                         
            OF: ＰＳＪＳ処理済電文日付(ＷＫ−パス番号) ,                    
                  NOT = ZERO                                                
  * 前日の最終電文が欠送した状態で当日の電文を受信した場合                  
               ＷＫ−業務リターンコード := 欠送                             
               ＷＫ−欠送電文日付 := ,                                      
                 ＰＳＪＳ処理済電文日付(ＷＫ−パス番号)                     
               ＷＫ−欠送電文通番 := ,                                      
                 ＰＳＪＳ処理済電文通番(ＷＫ−パス番号) + 1                 
            END:                                                            
         END:                                                               
       EXIT:                                                                
  *                                                                         
   SPACE:0                                                                  
   NOTE:                                                                    
     発券電文テーブルソート処理                                             
   NEND:                                                                    
   PROC:P210-RTN                                                            
       ENTRY:                                                               
  ** 売場コードの昇順に発券電文をテーブルに格納 **                          
         WK-I                   :=   ＷＫ−発券電文ＣＮＴ                   
         ＷＫ−発券電文ＣＮＴ   :=   ＷＫ−発券電文ＣＮＴ +  1              
         WHILE: WK-I >= 1                                                   
             IF: ＷＫ１発信元ＩＤ(WK-I) > ＣＤＣＫ発信元ＩＤ                
                 ＷＫ−発券電文ＴＢＬ(WK-I + 1)  :=          ,              
                                   ＷＫ−発券電文ＴＢＬ(WK-I)               
                 WK-I :=  WK-I - 1                                          
             ELSE:                                                          
                 ＷＫ−発券電文ＴＢＬ(WK-I + 1) ,                           
                   := ＣＤＣＫ変換後入力電文                                
                 WK-I :=  -1                                                
            END:                                                            
         END:                                                               
         IF: WK-I = 0                                                       
             ＷＫ−発券電文ＴＢＬ(1)  := ＣＤＣＫ変換後入力電文             
         END:                                                               
       EXIT:                                                                
  *                                                                         
   SPACE:0                                                                  
   NOTE:                                                                    
   終了チェック処理                                                         
   NEND:                                                                    
   PROC:P310-RTN                                                            
       ENTRY:                                                               
  * 各終了チェック部品用に世代別運用管理ファイルを読み込んだ                
  * 状態としておく                                                          
         ＷＫ−世代判定業務日付 := 退避ＫＨ受付日付                         
         CALL: SEDAI-RTN ; 世代区分判定処理                                 
         世代別運用管理Ｒ  ,                                                
           :=  Ｔ−ＳＵ世代別運用管理Ｒ(ＷＫ−世代区分)                     
  * 販売チャネル終了チェック                                                
         @ZCKSTSHC( CHANNEL = 退避ＫＨ販売チャネルコード ,                  
                    STATUS  = ＦＬＧ終了 ) ;                                
         IF: ＦＬＧ終了 NOT = 未受信    ;未受信(ｺｰﾄﾞ:0)                     
           ＷＫ−レコード状態 := 無効                                       
           ＷＫ−出力用販売チャネル ,                                       
                  := 退避ＫＨ販売チャネルコード                             
           CASE:  ＦＬＧ終了                                                
           OF:  受信済                      ;受信済(ｺｰﾄﾞ:1)                 
              @ZCTMSGOT(  MSGID = #RT206 ,                                  
                          PROGID = HRCAL010 ,                               
                          TEXT1 = 退避ＫＨ発信元ＩＤ ,                      
                          TEXT2 = ＷＫ−出力用販売チャネル ,                
                          TEXT3 = 退避ＫＨ電文通番 ) ;                      
           OF:  該当なし                    ;該当なし(ｺｰﾄﾞ:9)               
              @ZCTMSGOT(  MSGID = #RT226 ,                                  
                          PROGID = HRCAL010 ,                               
                          TEXT1 = 退避ＫＨ発信元ＩＤ ,                      
                          TEXT2 = ＷＫ−出力用販売チャネル ,                
                          TEXT3 = 退避ＫＨ電文通番 ) ;                      
           END:                                                             
           CALL: TRNS-ERR-RTN  ; トランザクションエラー出力処理             
           RETURN:                                                          
         END:                                                               
  * ゲーム終了チェック（発券要求、発券取消要求の場合のみ）                  
           IF: 退避ＫＨ電文種別 = 発券要求  OR ,                            
               退避ＫＨ電文種別 = 発券取消要求                              
              CASE: 退避ＫＨ電文種別                                        
                OF: 発券要求                                                
                 ＷＫ−退避ゲームタイプ ,                                   
                   := Ｔ１００ゲームタイプ(CNT)                             
                 ＷＫ−退避ブロックコード ,                                 
                   := Ｔ１００ブロックコード(CNT)                           
                 ＷＫ−退避開始回号   := Ｔ１００開始回号(CNT)              
                OF: 発券取消要求                                            
                 ＷＫ−退避ゲームタイプ ,                                   
                   := Ｔ１２０ゲームタイプ(CNT)                             
                 ＷＫ−退避ブロックコード ,                                 
                   := Ｔ１２０ブロックコード(CNT)                           
                 ＷＫ−退避開始回号   := Ｔ１２０開始回号(CNT)              
              END:                                                          
              @ZCKSTSGM( GTYPE  = ＷＫ−退避ゲームタイプ ,                  
                         BCODE  = ＷＫ−退避ブロックコード ,                
                         KAIGOU = ＷＫ−退避開始回号 ,                      
                         STATUS = ＦＬＧ終了 ) ;                            
              IF:  ＦＬＧ終了 NOT = 発売中    ;発売中(ｺｰﾄﾞ:0)               
                ＷＫ−レコード状態 := 無効                                  
                ＷＫ−出力用ブロックコード ,                                
                  := ＷＫ−退避ブロックコード                               
                @ZCTMSGOT(  MSGID = #RT207 ,                                
                            PROGID = HRCAL010 ,                             
                            TEXT1 = 退避ＫＨ発信元ＩＤ ,                    
                            TEXT2 = 退避ＫＨ電文通番 ,                      
                            TEXT3 = ＷＫ−退避ゲームタイプ ,                
                            TEXT4 = ＷＫ−出力用ブロックコード ,            
                            TEXT5 = ＷＫ−退避開始回号 ) ;                  
            CALL: TRNS-ERR-RTN  ; トランザクションエラー出力処理            
            END:                                                            
         END:                                                               
       EXIT:                                                                
  *                                                                         
   SPACE:0                                                                  
   NOTE:                                                                    
     発券レコード編集処理                                                   
   NEND:                                                                    
   PROC:P320-RTN                                                            
       ENTRY:                                                               
  * 前回処理した発券要求電文と受付日付、ゲームタイプ、                      
  * ブロックコードが異なる場合のみ、ゲーム種別、単価等を取得                
         IF: ＷＫ−日付 NOT = ＷＫ１受付日付(CNT)  OR ,                     
             ＷＫ−ゲームタイプ NOT = ,                                     
               Ｔ１００ゲームタイプ(CNT)  OR ,                              
             ＷＫ−ブロックコード NOT = Ｔ１００ブロックコード(CNT)         
            ＷＫ−日付            :=  ＷＫ１受付日付(CNT)                   
            ＷＫ−ゲームタイプ    :=  Ｔ１００ゲームタイプ(CNT)             
            ＷＫ−ブロックコード  :=  Ｔ１００ブロックコード(CNT)           
            CALL:IDX-GMTYSET-RTN                                            
              ; ゲームタイプテーブル添字セット処理                          
            CALL:GMKS-SET-RTN                                               
              ; ゲーム計数レコードセット処理                                
         END:                                                               
  * 共通編集処理                                                            
         CALL:P321-RTN  ; 発券レコード共通編集処理                          
  * 裏面番号２退避                                                          
         ＷＫ−連番ＣＤ分解      := Ｔ１００裏面番号２(CNT)                 
  * ロトコンビフラグセット                                                  
         IF: ＴＲＮＳゲーム種別 = ロト  AND ,                               
             Ｔ１０５申込タイプ(CNT 1) NOT = 2                              
            ＦＬＧロトコンビ  :=  ＯＮ                                      
         ELSE:                                                              
            ＦＬＧロトコンビ  :=  ＯＦＦ                                    
         END:                                                               
  * くじ券タイプセット                                                      
         IF: ＴＲＮＳ販売チャネルコード NOT = 発券端末                      
            ＦＬＧくじ券タイプ := 単独くじ券                                
         ELSE:                                                              
            IF: Ｔ１０５パネル数(CNT) > 1                                   
               ＦＬＧくじ券タイプ := 単独くじ券                             
            ELSE:                                                           
               IF: ＦＬＧロトコンビ = ＯＮ                                  
                  ＦＬＧくじ券タイプ := 単独くじ券                          
               ELSE:                                                        
                 ＦＬＧくじ券タイプ := 継続くじ券                           
               END:                                                         
            END:                                                            
         END:                                                               
  * カウンタ初期化                                                          
         ＣＮＴ−回号            := ZERO                                    
           ; 回号数をカウントする                                           
         ＣＮＴ−当初継続回号数  := ZERO                                    
           ; 当初継続回号数をカウントする                                   
         ＣＮＴ−識別            := ZERO                                    
           ; 識別コード単位の分割数をカウントする                           
  * 回号セット                                                              
         ＷＫ−回号              := Ｔ１００開始回号(CNT) - 1               
           ; 処理中の回号を格納する                                         
  * 継続回号数分、繰り返し                                                  
         WHILE:ＣＮＴ−回号 < Ｔ１００継続回号数(CNT)                       
  * カウンタ加算                                                            
           ＷＫ−回号              :=  ＷＫ−回号 + 1                       
           ＣＮＴ−回号            :=  ＣＮＴ−回号 + 1                     
           ＣＮＴ−当初継続回号数  :=  ＣＮＴ−当初継続回号数 + 1           
  ** 分割条件@ **                                                          
  * ＦＬＧくじ券タイプが”単独くじ券”の場合、                              
  * 継続回号数分、くじ券を分割                                              
           IF: ＦＬＧくじ券タイプ = 単独くじ券                              
              ＦＬＧパネル分割  :=  １−５パネル編集時                      
              CALL:P322-RTN  ; 発券レコード個別編集処理                     
  ** 分割条件A **                                                          
  * 分割条件@に加え、パネル数が６パネル以上の場合                          
              IF: Ｔ１０５パネル数(CNT) > 5                                 
                 ＦＬＧパネル分割  :=  ６−７パネル編集時                   
                 CALL:P322-RTN  ; 発券レコード個別編集処理                  
              END:                                                          
           ELSE:                                                            
  ** 分割条件B **                                                          
  * ＦＬＧくじ券タイプが”継続くじ券”の場合、                              
  * 以下のいずれかの条件成立時にくじ券を分割                                
  *　・当初継続回号数が５となった場合                                       
  *　・継続回号数の最終回号に対する処理の場合                               
  *　・各回号の単価が異なる場合                                             
              ＦＬＧパネル分割  :=  １−５パネル編集時                      
              IF: ＣＮＴ−当初継続回号数 = 5  OR ,                          
                  ＣＮＴ−回号 = Ｔ１００継続回号数(CNT)                    
                 CALL:P322-RTN  ; 発券レコード個別編集処理                  
                 ＣＮＴ−当初継続回号数 := 0                                
              ELSE:                                                         
  * IDX-KAIGOU の値が ２１ となると配列範囲外が発生する                     
  * ただし、IDX-KAIGOU が ２１となった場合は、上記の条件が                  
  * 必ず成立するため、配列範囲外は発生しない                                
                 IDX-KAIGOU := ＷＫ−回号 - 退避ＧＫ先頭回号 + 1            
                 IF: 退避ＧＫ単価(IDX-KAIGOU) NOT = ,                       
                     退避ＧＫ単価(IDX-KAIGOU + 1)                           
                    CALL:P322-RTN  ; 発券レコード個別編集処理               
                    ＣＮＴ−当初継続回号数 := 0                             
                 END:                                                       
              END:                                                          
           END:                                                             
         END:                                                               
       EXIT:                                                                
   SPACE:0                                                                  
   NOTE:                                                                    
   発券以外レコード編集処理                                                 
   NEND:                                                                    
   PROC:P330-RTN                                                            
       ENTRY:                                                               
  * 共通編集                                                                
         ＴＲＮＳ取引日付            :=  ＷＫ２日付(CNT)                    
         ＴＲＮＳ取引時刻            :=  ＷＫ２時刻(CNT)                    
         ＴＲＮＳ受付日付            :=  ＷＫ２受付日付(CNT)                
         ＴＲＮＳ受付時刻            :=  ＷＫ２受付時刻(CNT)                
         ＴＲＮＳ売場コード          :=  ＷＫ２発信元ＩＤ(CNT)              
         ＴＲＮＳ販売員ＩＤ          :=  ＷＫ２販売員ＩＤ(CNT)              
         ＴＲＮＳ機種区分            :=  ＷＫ２機種区分(CNT)                
         ＴＲＮＳ販売チャネルコード  ,                                      
           :=  ＷＫ２販売チャネルコード(CNT)                                
         ＴＲＮＳ電文通番            :=  ＷＫ２電文通番(CNT)                
         CASE:  ＷＫ２入力方式１(CNT)                                       
         OF:  B"1"                                                          
              ＴＲＮＳ入力方式１      :=  "1"                               
         OF:  B"0"                                                          
              ＴＲＮＳ入力方式１      :=  "0"                               
         END:                                                               
         CASE:  ＷＫ２入力方式２(CNT)                                       
         OF:  B"1"                                                          
              ＴＲＮＳ入力方式２      :=  "1"                               
         OF:  B"0"                                                          
              ＴＲＮＳ入力方式２      :=  "0"                               
         END:                                                               
         ＴＲＮＳセンター状態    :=  ＷＫ−センター状態                     
         ＴＲＮＳレコード状態    :=  ＷＫ−レコード状態                     
  * 個別編集                                                                
         CASE: ＷＫ２電文種別(CNT)                                          
  *** 発券取消 ***                                                          
         OF: 発券取消要求                                                   
            CALL:P331-RTN  ;  発券取消レコード編集                          
  *** 支払 ***                                                              
         OF: 支払要求                                                       
            CALL:P332-RTN  ;  支払レコード編集                              
  *** 代替券発行 ***                                                        
         OF: 代替券発行要求                                                 
            CALL:P333-RTN  ;  代替券レコード編集                            
  *** 支払取消 ***                                                          
         OF: 支払取消要求                                                   
            CALL:P334-RTN  ;  支払取消レコード編集                          
         END:                                                               
  * トランザクションレコード退避                                            
         Ｔ−ＴＲレコード件数 :=  Ｔ−ＴＲレコード件数  +  1                
         Ｔ−ＴＲトランザクションＲ(Ｔ−ＴＲレコード件数) ,                 
           :=  トランザクションＲ                                           
  * 電文有無フラグ更新（P400,P500,P700-RTNにて参照)                         
         ＷＫ−世代判定業務日付 := ＴＲＮＳ受付日付                         
         CALL: SEDAI-RTN ; 世代区分判定処理                                 
         ＷＫ−識別コード中 :=  ＴＲＮＳ識別コード中                        
  *                                                                         
         ＦＬＧ世代別電文有無(ＷＫ−世代区分)          :=  ＯＮ             
         ＦＬＧＦＥＰ別電文有無(ＷＫ−識別ＦＥＰ番号)  :=  ＯＮ             
         ＦＬＧ世別Ｆ別Ｃ別電文有無(ＷＫ−世代区分 ,                        
                       ＷＫ−識別ＦＥＰ番号 ,                               
                         ＴＲＮＳ販売チャネルコード)   :=  ＯＮ             
       EXIT:                                                                
  *                                                                         
   SPACE:0                                                                  
   NOTE:                                                                    
     障害取消レコード編集                                                   
   NEND:                                                                    
   PROC:P340-RTN                                                            
       ENTRY:                                                               
  * 障害取消レコード編集                                                    
         ＴＲＮＳレコードＩＤ        := 障害取消ＩＤ                        
         ＴＲＮＳ取引日付            :=  ＷＫ１日付(CNT)                    
         ＴＲＮＳ取引時刻            :=  ＷＫ１時刻(CNT)                    
         ＴＲＮＳ受付日付            :=  ＷＫ１受付日付(CNT)                
         ＴＲＮＳ受付時刻            :=  ＷＫ１受付時刻(CNT)                
         ＴＲＮＳ売場コード          :=  ＷＫ１発信元ＩＤ(CNT)              
         ＴＲＮＳ販売員ＩＤ          :=  ＷＫ１販売員ＩＤ(CNT)              
         ＴＲＮＳ機種区分            :=  ＷＫ１機種区分(CNT)                
         ＴＲＮＳ販売チャネルコード  ,                                      
           :=  ＷＫ１販売チャネルコード(CNT)                                
         ＴＲＮＳ電文通番            :=  ＷＫ１電文通番(CNT)                
         CASE:  ＷＫ１入力方式１(CNT)                                       
         OF:  B"1"                                                          
              ＴＲＮＳ入力方式１      :=  "1"                               
         OF:  B"0"                                                          
              ＴＲＮＳ入力方式１      :=  "0"                               
         END:                                                               
         CASE:  ＷＫ１入力方式２(CNT)                                       
         OF:  B"1"                                                          
              ＴＲＮＳ入力方式２      :=  "1"                               
         OF:  B"0"                                                          
              ＴＲＮＳ入力方式２      :=  "0"                               
         END:                                                               
  *                                                                         
         ＴＲＮＳセンター状態    :=  ＷＫ−センター状態                     
         ＴＲＮＳレコード状態    :=  ＷＫ−レコード状態                     
  * 取消区分、識別コード、旧識別コード、識別コード区分                      
         CASE: ＷＫ１電文種別(CNT)                                          
           OF: 発券障害取消要求                                             
              IF: Ｔ９００障害識別コード数(CNT) = ZERO                      
                 ＴＲＮＳ取消区分 := 電文通番取消                           
                 ＷＫ−変換前識別コード ,                                   
                   :=  Ｔ９００障害識別コード(CNT 1)                        
              ELSE:                                                         
                 ＴＲＮＳ取消区分 := 識別コード取消                         
                 IDX-CODE := Ｔ９００障害識別コード数(CNT) + 1              
                 ＷＫ−変換前識別コード ,                                   
                   := Ｔ９００障害識別コード(CNT IDX-CODE)                  
              END:                                                          
           OF: 発券端末サーバ障害取消要求                                   
              ＴＲＮＳ取消区分 := 識別コード取消                            
              IDX-CODE := Ｆ９００障害識別コード数(CNT) + 1                 
              ＷＫ−変換前識別コード ,                                      
                := Ｆ９００障害識別コード(CNT IDX-CODE)                     
         END:                                                               
  * 識別コード体系変換                                                      
         CALL: ZMSSRLCV-RTN  ; 識別コード変換処理                           
         ＴＲＮＳ識別コード  := ＷＫ−変換後識別コード                      
         IF: ＷＫ−変換前識別コード下 NOT = ZERO                            
            ＴＲＮＳ識別コード区分 :=  ２４桁                               
         ELSE:                                                              
            ＴＲＮＳ識別コード区分 :=  １６桁                               
            ＴＲＮＳ旧識別コード上 :=  ＷＫ−変換前識別コード上             
            ＴＲＮＳ旧識別コード下 :=  ＷＫ−変換前識別コード中             
         END:                                                               
  * トランザクションレコード退避                                            
         Ｔ−ＴＲレコード件数 :=  Ｔ−ＴＲレコード件数  +  1                
         Ｔ−ＴＲトランザクションＲ(Ｔ−ＴＲレコード件数) ,                 
           :=  トランザクションＲ                                           
  * 電文有無フラグ更新（P400,P500,P700-RTNにて参照)                         
         ＷＫ−世代判定業務日付 := ＴＲＮＳ受付日付                         
         CALL: SEDAI-RTN ; 世代区分判定処理                                 
         ＷＫ−識別コード中 :=  ＴＲＮＳ識別コード中                        
  *                                                                         
         ＦＬＧ世代別電文有無(ＷＫ−世代区分)          :=  ＯＮ             
         ＦＬＧＦＥＰ別電文有無(ＷＫ−識別ＦＥＰ番号)  :=  ＯＮ             
         ＦＬＧ世別Ｆ別Ｃ別電文有無(ＷＫ−世代区分 ,                        
                       ＷＫ−識別ＦＥＰ番号 ,                               
                         ＴＲＮＳ販売チャネルコード)   :=  ＯＮ             
       EXIT:                                                                
  *                                                                         
   SPACE:0                                                                  
   NOTE:                                                                    
   ＦＥＰ別有効表出力処理                                                   
   NEND:                                                                    
   PROC:P410-RTN                                                            
       ENTRY:                                                               
  * ファイルポインタセット                                                  
         @ZFLPTRST( FILE     = YT ,                                         
                    MODE     = 2 ,                                          
                    FEPNO    = CNT-FEP ,                                    
                    FILEPTR  = YUKOPTR ,                                    
                    RTNCD    = ＷＫ−ＲＴＮＣＤ ) ;                         
         IF:  ＷＫ−ＲＴＮＣＤ NOT = "00" AND "01"                          
           @ZCTABORT( MSGID  = #RT203 ,                                     
                      PROGID = HRCAL010 ,                                   
                      CNT    = 10 ,                                         
                      TEXT1  = ＷＫ−ＲＴＮＣＤ ) ;                         
         END:                                                               
         SET  DYUKOPTR TO YUKOPTR                                           
                                                                            
  * トランザクションレコード件数分、繰り返し                                
         CNT := 1                                                           
         WHILE: CNT <= Ｔ−ＴＲレコード件数                                 
           ＷＫ−識別コード中  :=  Ｔ−ＴＲ識別コード中(CNT)                
           IF: ＷＫ−識別ＦＥＰ番号   = CNT-FEP                             
              IF: (Ｔ−ＴＲレコードＩＤ(CNT)  = 発券ＩＤ    AND ,           
                   Ｔ−ＴＲレコード状態(CNT)  = 有効)     OR ,              
                  (Ｔ−ＴＲレコードＩＤ(CNT)  = 代替券ＩＤ  AND ,           
                   Ｔ−ＴＲレコード状態(CNT)  = 有効)                       
  * トランザクションＲのレコード長 > 有効Ｒのレコード長　のため             
  * 桁落ちが発生する。そのため、有効表の予備エリアは初期化しておく。        
                 有効Ｒ  :=  Ｔ−ＴＲトランザクションＲ(CNT)                
                 ＹＵＫＯ予備  :=  SPACE                                    
                 WRITE  有効Ｒ  INVALID KEY CONTINUE                        
                 CASE: ＳＴＳコード                                         
                 OF: ZERO                                                   
                    CONTINUE.                                               
                 OF: "22"  ; DUPKEY                                         
  * ２センター同期により同一の電文を重複して受信                            
                    Ｔ−ＴＲレコード状態(CNT) := 無効                       
  * 重複電文については、P600-RTN にて発券申込処理をＣＡＬＬさせない         
  * ように、発券電文ＴＢＬ上の重複電文登録フラグを ＯＮ としておく          
                    IF: Ｔ−ＴＲレコードＩＤ(CNT) = 発券ＩＤ                
                       ＷＫ−添字 := Ｔ−ＴＲ発券電文ＴＣＮＴ(CNT)          
                       ＷＫ１重複電文登録フラグ(ＷＫ−添字) := ＯＮ         
                    END:                                                    
                 OTHER:                                                     
                    ＷＫ−識別コード上 := ＹＵＫＯ識別コード上              
                    ＷＫ−識別コード中 := ＹＵＫＯ識別コード中              
                    ＷＫ−識別コード下 := ＹＵＫＯ識別コード下              
                    @ZCTABORT( MSGID  = #RT215 ,                            
                               PROGID = HRCAL010 ,                          
                               CNT    = 11 ,                                
                               TEXT1  = "ﾕｳｺｳﾋｮｳ" ,                         
                               TEXT2  = CNT-FEP ,                           
                               TEXT3  = "-" ,                               
                               TEXT4  = "WRITE" ,                           
                               TEXT5  = ＷＫ−識別コード上 ,                
                               TEXT6  = ＷＫ−識別コード中 ,                
                               TEXT7  = ＷＫ−識別コード下 ,                
                               TEXT8  = ＳＴＳコード ,                      
                               TEXT9  = ＳＴＳ詳細  ) ;                     
                 END:                                                       
              END:                                                          
           END:                                                             
           CNT := CNT + 1                                                   
         END:                                                               
       EXIT:                                                                
  *                                                                         
   SPACE:0                                                                  
   NOTE:                                                                    
   世代・ＦＥＰ・販売チャネル別トランザクションファイル出力処理             
   NEND:                                                                    
   PROC:P510-RTN                                                            
       ENTRY:                                                               
  * トランザクションレコード件数分、繰り返し                                
         CNT := 1                                                           
         ＴＲＢＣレコード件数 := 0                                          
         WHILE: CNT <= Ｔ−ＴＲレコード件数                                 
           ＷＫ−識別コード中  :=  Ｔ−ＴＲ識別コード中(CNT)                
           IF: Ｔ−ＴＲ受付日付(CNT)  ,                                     
                 = Ｔ−ＳＵ業務日付(IDX-SEDAI)   AND ,                      
               ＷＫ−識別ＦＥＰ番号   = CNT-FEP  AND ,                      
               Ｔ−ＴＲ販売チャネルコード(CNT) = CNT-CHANNEL                
              ＴＲＢＣレコード件数 := ＴＲＢＣレコード件数 + 1              
              ＴＲＢＣトランザクションＲ(ＴＲＢＣレコード件数) ,            
                := Ｔ−ＴＲトランザクションＲ(CNT)                          
           END:                                                             
           CNT := CNT + 1                                                   
         END:                                                               
  * トランザクションファイル出力パラメータセット                            
         ＴＲＢＣ世代区分           := IDX-SEDAI                            
         ＴＲＢＣＦＥＰＮＯ         := CNT-FEP                              
         ＴＲＢＣ販売チャネルコード := CNT-CHANNEL                          
   ; システムヘッダの送受信端末名の退避情報をセット                         
         ＴＲＢＣＦＥＰ識別子       := ＷＫ−ＦＥＰ番号                     
         ＴＲＢＣパス番号           := ＷＫ−パス番号                       
   ; 共通ヘッダ（発券端末サーバ編集）の退避情報をセット                     
         ＴＲＢＣパス別電文日付     := ＷＫ−パス別電文日付                 
         ＴＲＢＣパス別電文通番     := ＷＫ−パス別電文通番                 
  * トランザクションファイル出力処理                                        
         ECALL: HSAAL110 (VISUCA , VISFPTR ,                                
                                    トランザクション出力ＰＲＭ)             
         IF: ＴＲＢＣＲＴＮＣＤ NOT = ZERO                                  
           @ZCTABORT( MSGID  = #RT208 ,                                     
                      PROGID = HRCAL010 ,                                   
                      CNT    = 12 ) ;                                       
         END:                                                               
       EXIT:                                                                
  *                                                                         
   SPACE:0                                                                  
   NOTE:                                                                    
     世代別ゲーム計数一括更新処理                                           
   NEND:                                                                    
   PROC:P710-RTN                                                            
       ENTRY:                                                               
  * ファイルポインタ、レコード件数セット                                    
         IF: IDX-SEDAI = 世代Ａ                                             
            SET  FGMKSPTR  TO  FGMKSPTRA                                    
            ＷＫ−ＧＫレコード件数 := Ｔ−Ｇ１レコード件数                  
         ELSE:                                                              
            SET  FGMKSPTR  TO  FGMKSPTRB                                    
            ＷＫ−ＧＫレコード件数 := Ｔ−Ｇ２レコード件数                  
         END:                                                               
  * ゲーム計数一括更新レコードの格納件数分、繰り返し                        
         CNT := 1                                                           
         WHILE: CNT <= ＷＫ−ＧＫレコード件数                               
            IF: IDX-SEDAI = 世代Ａ                                          
               ゲーム計数Ｒ := Ｔ−Ｇ１ゲーム計数Ｒ(CNT)                    
            ELSE:                                                           
               ゲーム計数Ｒ := Ｔ−Ｇ２ゲーム計数Ｒ(CNT)                    
            END:                                                            
  * ゲーム計数ファイル更新                                                  
           REWRITE  ゲーム計数Ｒ  INVALID KEY CONTINUE                      
           IF:  ＳＴＳコード NOT = ZERO                                     
             ＷＫ−計数ゲームタイプ   := ＧＭＫＳゲームタイプ               
             ＷＫ−計数ブロックコード := ＧＭＫＳブロックコード             
             @ZCTABORT( MSGID  = #RT201 ,                                   
                        PROGID = HRCAL010 ,                                 
                        CNT    = 13 ,                                       
                        TEXT1  = "ｹﾞｰﾑｹｲｽｳﾌｧｲﾙ" ,                           
                        TEXT2  = ＷＫ−ＦＥＰ番号 ,                         
                        TEXT3  = IDX-SEDAI ,                                
                        TEXT4  = "REWRITE" ,                                
                        TEXT5  = ＷＫ−ゲーム計数キー ,                     
                        TEXT6  = ＳＴＳコード ,                             
                        TEXT7  = ＳＴＳ詳細 ) ;                             
           END:                                                             
           CNT := CNT + 1                                                   
         END:                                                               
       EXIT:                                                                
  *                                                                         
   SPACE:0                                                                  
   NOTE:                                                                    
     ゲーム別プール計数一括更新処理                                         
   NEND:                                                                    
   PROC:P810-RTN                                                            
       ENTRY:                                                               
  * プール計数一括更新パラメータセット（個別）                              
                                                                            
  * 前回処理したプール計数一括更新処理とゲームタイプが異なる場合            
  * のみ、ゲーム種別を取得                                                  
         IF: ＷＫ−ゲームタイプ NOT = Ｔ−ＰＬゲームタイプ(CNT)             
            ＷＫ−ゲームタイプ := Ｔ−ＰＬゲームタイプ(CNT)                 
            CALL:IDX-GMTYSET-RTN  ;ゲームタイプファイルカウンタセッ         
         END:                                                               
         ＰＬＢＣゲーム種別   := Ｔ−ＧＴゲーム種別(IDX-GMTY)               
   ;                                                                        
         ＰＬＢＣゲームタイプ    ,                                          
           := Ｔ−ＰＬゲームタイプ(CNT)                                     
         ＰＬＢＣブロックコード  ,                                          
           := Ｔ−ＰＬブロックコード(CNT)                                   
  * ゲーム計数一括更新テーブルより、先頭回号を取得                          
         ＷＫ−ゲームタイプ    :=  ＰＬＢＣゲームタイプ                     
         ＷＫ−ブロックコード  :=  ＰＬＢＣブロックコード                   
         ＷＫ−日付            :=  ＵＮＫ１業務日付                         
         CALL:GMKS-SET-RTN ; ゲーム計数レコードセット処理                   
         IF: 退避ＧＫゲームタイプ = ＰＬＢＣゲームタイプ  AND ,             
             退避ＧＫブロックコード = ＰＬＢＣブロックコード                
  * 現世代のゲーム計数テーブルに対象のゲーム計数レコードが展開              
  * されていた場合                                                          
            ＰＬＢＣ先頭回号 := 退避ＧＫ先頭回号                            
         ELSE:                                                              
  * 現世代でないゲーム計数テーブルに対象のゲーム計数レコードが              
  * 展開されていた場合                                                      
            IF: ＵＮＫ１世代区分 = 世代Ａ                                   
               ＷＫ−日付 := Ｔ−ＳＵ業務日付(世代Ｂ)                       
            ELSE:                                                           
               ＷＫ−日付 := Ｔ−ＳＵ業務日付(世代Ａ)                       
            END:                                                            
            CALL:GMKS-SET-RTN ; ゲーム計数レコードセット処理                
            ＰＬＢＣ先頭回号 := 退避ＧＫ先頭回号                            
         END:                                                               
  * プール計数ファイル一括更新処理                                          
         ＦＬＧプール更新   := ＯＦＦ                                       
         IF: ＷＫ−処理区分  =  通常                                        
           ＦＬＧプール更新 := ＯＮ                                         
         ELSE:                                                              
           IF: ＦＬＧプールＣＨＫ = ＯＦＦ                                  
             CALL: P811-RTN   ;プール計数一括更新チェック処理               
             ＦＬＧプールＣＨＫ := ＯＮ                                     
           END:                                                             
           CASE:                                                            
           OF: ＷＫ−履歴ゲームタイプ < Ｔ−ＰＬゲームタイプ(CNT)           
             ＦＬＧプール更新 := ＯＮ                                       
           OF: ＷＫ−履歴ゲームタイプ = Ｔ−ＰＬゲームタイプ(CNT)           
             IF: ＷＫ−履歴ブロックコード ,                                 
               < Ｔ−ＰＬブロックコード(CNT)                                
               ＦＬＧプール更新 := ＯＮ                                     
             END:                                                           
           END:                                                             
         END:                                                               
         IF: ＦＬＧプール更新 = ＯＮ                                        
           ECALL: HSAAL160 (VISUCA , VISFPTR ,                              
                                      プール計数一括更新ＰＲＭ)             
           IF: ＰＬＢＣＲＴＮＣＤ NOT = ZERO                                
             @ZCTABORT( MSGID  = #RT209 ,                                   
                        PROGID = HRCAL010 ,                                 
                        CNT    = 14 ,                                       
                        TEXT1  = ＰＬＢＣＲＴＮＣＤ );                      
           END:                                                             
           CALL: P812-RTN    ;トランザクション出力履歴ファイル更新          
           CALL: TRNSEND-RTN ;トランザクションエンド                        
         END:                                                               
       EXIT:                                                                
  *                                                                         
   SPACE:0                                                                  
   NOTE:                                                                    
     世代別ゲーム計数一括読込処理                                           
   NEND:                                                                    
   PROC:PB10-RTN                                                            
       ENTRY:                                                               
  * ファイルポインタ、レコード件数セット                                    
         IF: IDX-SEDAI = 世代Ａ                                             
            SET  FGMKSPTR  TO  FGMKSPTRA ; 更新用ファイルポインタ           
            ＷＫ−ＧＫレコード件数 := Ｔ−Ｇ１レコード件数                  
         ELSE:                                                              
            SET  FGMKSPTR  TO  FGMKSPTRB ; 更新用ファイルポインタ           
            ＷＫ−ＧＫレコード件数 := Ｔ−Ｇ２レコード件数                  
         END:                                                               
  * ゲーム計数一括更新レコードの格納件数分、繰り返し                        
         CNT := 1                                                           
         WHILE: CNT <= ＷＫ−ＧＫレコード件数                               
  *                                                                         
           IF: IDX-SEDAI = 世代Ａ                                           
              ＧＭＫＳゲームタイプ   := Ｔ−Ｇ１ゲームタイプ(CNT)           
              ＧＭＫＳブロックコード := Ｔ−Ｇ１ブロックコード(CNT)         
           ELSE:                                                            
              ＧＭＫＳゲームタイプ   := Ｔ−Ｇ２ゲームタイプ(CNT)           
              ＧＭＫＳブロックコード := Ｔ−Ｇ２ブロックコード(CNT)         
           END:                                                             
  * ゲーム計数ファイル更新                                                  
           READ  ゲーム計数ファイル  INVALID KEY CONTINUE                   
           IF:  ＳＴＳコード NOT = ZERO                                     
             ＷＫ−計数ゲームタイプ   := ＧＭＫＳゲームタイプ               
             ＷＫ−計数ブロックコード := ＧＭＫＳブロックコード             
             @ZCTABORT( MSGID  = #RT201 ,                                   
                        PROGID = HRCAL010 ,                                 
                        CNT    = 23 ,                                       
                        TEXT1  = "ｹﾞｰﾑｹｲｽｳﾌｧｲﾙ" ,                           
                        TEXT2  = ＷＫ−ＦＥＰ番号 ,                         
                        TEXT3  = IDX-SEDAI ,                                
                        TEXT4  = "READ" ,                                   
                        TEXT5  = ＷＫ−ゲーム計数キー ,                     
                        TEXT6  = ＳＴＳコード ,                             
                        TEXT7  = ＳＴＳ詳細 ) ;                             
           END:                                                             
  * ゲーム計数一括更新テーブルに再展開                                      
           IF: IDX-SEDAI = 世代Ａ                                           
              Ｔ−Ｇ１ゲーム計数Ｒ(CNT) := ゲーム計数Ｒ                     
           ELSE:                                                            
              Ｔ−Ｇ２ゲーム計数Ｒ(CNT) := ゲーム計数Ｒ                     
           END:                                                             
  *                                                                         
           CNT := CNT + 1                                                   
         END:                                                               
       EXIT:                                                                
  *                                                                         
   SPACE:0                                                                  
   NOTE:                                                                    
   手続き （レベル３）                                                      
   NEND:                                                                    
   NOTE:                                                                    
     発券レコード共通編集処理                                               
   NEND:                                                                    
   PROC:P321-RTN                                                            
       ENTRY:                                                               
  * 共通編集                                                                
         ＴＲＮＳレコードＩＤ        :=  発券ＩＤ                           
         ＴＲＮＳ取引日付            :=  ＷＫ１日付(CNT)                    
         ＴＲＮＳ取引時刻            :=  ＷＫ１時刻(CNT)                    
         ＴＲＮＳ受付日付            :=  ＷＫ１受付日付(CNT)                
         ＴＲＮＳ受付時刻            :=  ＷＫ１受付時刻(CNT)                
         ＴＲＮＳ売場コード          :=  ＷＫ１発信元ＩＤ(CNT)              
         ＴＲＮＳ販売員ＩＤ          :=  ＷＫ１販売員ＩＤ(CNT)              
         ＴＲＮＳ機種区分            :=  ＷＫ１機種区分(CNT)                
         ＴＲＮＳ販売チャネルコード  ,                                      
           :=  ＷＫ１販売チャネルコード(CNT)                                
         ＴＲＮＳ電文通番            :=  ＷＫ１電文通番(CNT)                
         CASE:  ＷＫ１入力方式１(CNT)                                       
         OF:  B"1"                                                          
              ＴＲＮＳ入力方式１      :=  "1"                               
         OF:  B"0"                                                          
              ＴＲＮＳ入力方式１      :=  "0"                               
         END:                                                               
         CASE:  ＷＫ１入力方式２(CNT)                                       
         OF:  B"1"                                                          
              ＴＲＮＳ入力方式２      :=  "1"                               
         OF:  B"0"                                                          
              ＴＲＮＳ入力方式２      :=  "0"                               
         END:                                                               
  *                                                                         
         ＴＲＮＳセンター状態    :=  ＷＫ−センター状態                     
         ＴＲＮＳレコード状態    :=  ＷＫ−レコード状態                     
  *                                                                         
         ＴＲＮＳゲーム種別      :=  Ｔ−ＧＴゲーム種別(IDX-GMTY)           
  *                                                                         
         ＴＲＮＳゲームタイプ    :=  Ｔ１００ゲームタイプ(CNT)              
         ＴＲＮＳブロックコード  :=  Ｔ１００ブロックコード(CNT)            
         ＴＲＮＳ口数            :=  Ｔ１００申込口数(CNT)                  
         ＴＲＮＳ障害取消通番    :=  Ｔ１００障害取消通番(CNT)              
         ＴＲＮＳ統計情報        :=  Ｔ１００統計情報(CNT)                  
         ＴＲＮＳロール番号      :=  Ｔ１００裏面番号１(CNT)                
  *                                                                         
         ＴＲＮＳ出力枚数        :=  Ｔ１０４識別コード数(CNT)              
       EXIT:                                                                
  *                                                                         
   SPACE:0                                                                  
   NOTE:                                                                    
     発券レコード個別編集処理                                               
   NEND:                                                                    
   PROC:P322-RTN                                                            
       ENTRY:                                                               
  * 識別コードの分割数カウンタ加算                                          
         ＣＮＴ−識別  :=  ＣＮＴ−識別 + 1                                 
  * 開始回号、当初継続回号数、実質継続回号数                                
         IF: ＦＬＧくじ券タイプ = 単独くじ券                                
            ＴＲＮＳ開始回号        :=  ＷＫ−回号                          
            ＴＲＮＳ当初継続回号数  :=  1                                   
         ELSE:   ; 継続くじ券                                               
            ＴＲＮＳ開始回号 ,                                              
              :=  ＷＫ−回号 - ＣＮＴ−当初継続回号数 + 1                   
            ＴＲＮＳ当初継続回号数  :=  ＣＮＴ−当初継続回号数              
         END:                                                               
         ＴＲＮＳ実質継続回号数  :=  ＴＲＮＳ当初継続回号数                 
  * 出力番号、連番、連番チェックディジット                                  
         ＴＲＮＳ出力番号  :=  ＣＮＴ−識別                                 
         IF: ＴＲＮＳ販売チャネルコード = 発券端末                          
            ＴＲＮＳ連番 ,                                                  
              :=  ＷＫ−チケット連番 + ＣＮＴ−識別 - 1                     
            ＷＫ−ＣＫＤロール番号 := ＴＲＮＳロール番号                    
            ＷＫ−ＣＫＤ連番       := ＴＲＮＳ連番                          
            DIVIDE  ＷＫ−ＣＫＤ計算９  BY  9  GIVING  ＷＫ−商             
                                        REMAINDER  ＷＫ−ＣＫＤ             
            IF: ＷＫ−ＣＫＤ = ZERO                                         
              ＴＲＮＳ連番チェックＤ := ＷＫ−ＣＫＤ                        
            ELSE:                                                           
              ＴＲＮＳ連番チェックＤ := 9 - ＷＫ−ＣＫＤ                    
            END:                                                            
         END:                                                               
  * パネル数、申込数字、クイックピック、申込タイプ                          
         IF: ＦＬＧパネル分割 = １−５パネル編集時                          
            IF: Ｔ１０５パネル数(CNT) > 5                                   
               ＴＲＮＳパネル数  :=  5                                      
            ELSE:                                                           
               ＴＲＮＳパネル数  :=  Ｔ１０５パネル数(CNT)                  
            END:                                                            
            CNT-PANEL := 1                                                  
            WHILE: CNT-PANEL  <= ＴＲＮＳパネル数                           
              ＴＲＮＳ申込数字(CNT-PANEL) ,                                 
                :=  Ｔ１０５申込数字(CNT CNT-PANEL)                         
              ＴＲＮＳクイックピック区分(CNT-PANEL) ,                       
                :=  Ｔ１０５クイックピック(CNT CNT-PANEL)                   
              ＴＲＮＳ申込タイプ(CNT-PANEL) ,                               
                :=  Ｔ１０５申込タイプ(CNT CNT-PANEL)                       
              CNT-PANEL  :=  CNT-PANEL + 1                                  
            END:                                                            
         ELSE:  ; ６−７パネル編集時                                        
            ＴＲＮＳパネル数  :=  Ｔ１０５パネル数(CNT) - 5                 
  * １−５パネル編集時の申込明細の内容を初期化                              
            INITIALIZE  ＴＲＮＳ申込情報.                                   
            CNT-PANEL := 1                                                  
            WHILE:CNT-PANEL  <= ＴＲＮＳパネル数                            
              ＴＲＮＳ申込数字(CNT-PANEL) ,                                 
                := Ｔ１０５申込数字(CNT CNT-PANEL + 5)                      
              ＴＲＮＳクイックピック区分(CNT-PANEL) ,                       
                := Ｔ１０５クイックピック(CNT CNT-PANEL + 5)                
              ＴＲＮＳ申込タイプ(CNT-PANEL) ,                               
                := Ｔ１０５申込タイプ(CNT CNT-PANEL + 5)                    
              CNT-PANEL  :=  CNT-PANEL + 1                                  
            END:                                                            
         END:                                                               
  * 識別コード、旧識別コード、識別コード区分                                
  * 識別コード体系変換                                                      
         ＷＫ−変換前識別コード ,                                           
           :=  Ｔ１０４識別コード(CNT ＣＮＴ−識別)                         
         CALL: ZMSSRLCV-RTN  ; 識別コード変換処理                           
         ＴＲＮＳ識別コード  := ＷＫ−変換後識別コード                      
         IF: ＷＫ−変換前識別コード下 NOT = ZERO                            
            ＴＲＮＳ識別コード区分 :=  ２４桁                               
         ELSE:                                                              
            ＴＲＮＳ識別コード区分 :=  １６桁                               
            ＴＲＮＳ旧識別コード上 :=  ＷＫ−変換前識別コード上             
            ＴＲＮＳ旧識別コード下 :=  ＷＫ−変換前識別コード中             
         END:                                                               
  * セキュリティコード                                                      
         ＴＲＮＳセキュリティコード ,                                       
           := Ｔ１０３ハッシュ値(CNT ＣＮＴ−識別)                          
  * 分子、分母、金額                                                        
         IDX-KAIGOU := ＷＫ−回号 - 退避ＧＫ先頭回号 + 1                    
         ＴＲＮＳ分子      :=  退避ＧＫ分子数(IDX-KAIGOU)                   
         ＴＲＮＳ分母      :=  退避ＧＫ分母数(IDX-KAIGOU)                   
         IF: ＦＬＧロトコンビ  = ＯＮ                                       
            @ZSNCNBMP(BUNSI  =  ＴＲＮＳ分子 ,                              
                      BUNBO  =  ＴＲＮＳ分母 ,                              
                      RTYPE  =  ＴＲＮＳ申込タイプ(1) ,                     
                      RNUMS  =  ＷＫ−申込通り数 );                         
            ＴＲＮＳ金額  :=  ＷＫ−申込通り数 ,                            
              * 退避ＧＫ単価(IDX-KAIGOU)                                    
         ELSE:  ; ロトコンビ以外                                            
            ＴＲＮＳ金額  :=  ＴＲＮＳパネル数 * ＴＲＮＳ口数 ,             
                                * ＴＲＮＳ当初継続回号数                    
                                   * 退避ＧＫ単価(IDX-KAIGOU)               
         END:                                                               
  * 分割識別コード（６パネル以上のチケットの場合のみセット）                
         IF: Ｔ１０５パネル数(CNT) > 5                                      
            IF: ＦＬＧパネル分割 = １−５パネル編集時                       
  * 識別コード体系変換                                                      
               ＷＫ−変換前識別コード ,                                     
                 :=  Ｔ１０４識別コード(CNT ＣＮＴ−識別 + 1)               
               CALL: ZMSSRLCV-RTN  ; 識別コード変換処理                     
               ＴＲＮＳ分割識別コード  := ＷＫ−変換後識別コード            
            ELSE: ; ６−７パネル編集時                                      
  * 識別コード体系変換                                                      
               ＷＫ−変換前識別コード ,                                     
                 :=  Ｔ１０４識別コード(CNT ＣＮＴ−識別 - 1)               
               CALL: ZMSSRLCV-RTN  ; 識別コード変換処理                     
               ＴＲＮＳ分割識別コード  := ＷＫ−変換後識別コード            
            END:                                                            
         END:                                                               
  * トランザクションレコード退避                                            
         Ｔ−ＴＲレコード件数 :=  Ｔ−ＴＲレコード件数  +  1                
         Ｔ−ＴＲトランザクションＲ(Ｔ−ＴＲレコード件数) ,                 
           :=  トランザクションＲ                                           
  * トランザクションテーブルと発券電文テーブルのリンクをとるため            
  * 発券電文の発券電文テーブル内の格納位置をセットしておく                  
         Ｔ−ＴＲ発券電文ＴＣＮＴ(Ｔ−ＴＲレコード件数) := CNT              
  * 電文有無フラグ更新（P400,P500,P700-RTNにて参照)                         
         ＷＫ−世代判定業務日付 := ＴＲＮＳ受付日付                         
         CALL: SEDAI-RTN ; 世代区分判定処理                                 
         ＷＫ−識別コード中 :=  ＴＲＮＳ識別コード中                        
  *                                                                         
         ＦＬＧ世代別電文有無(ＷＫ−世代区分)          :=  ＯＮ             
         ＦＬＧＦＥＰ別電文有無(ＷＫ−識別ＦＥＰ番号)  :=  ＯＮ             
         ＦＬＧ世別Ｆ別Ｃ別電文有無(ＷＫ−世代区分 ,                        
                       ＷＫ−識別ＦＥＰ番号 ,                               
                         ＴＲＮＳ販売チャネルコード)   :=  ＯＮ             
  * ＷＫ１発券金額加算                                                      
  *   電文単位の発券金額を累計する。                                        
  *   P600-RTNにて発券申込のパラメータにセット                              
         ＷＫ１発券金額(CNT) ,                                              
           :=  ＷＫ１発券金額(CNT) + ＴＲＮＳ金額                           
       EXIT:                                                                
  *                                                                         
   SPACE:0                                                                  
   NOTE:                                                                    
     発券取消レコード編集処理                                               
   NEND:                                                                    
   PROC:P331-RTN                                                            
       ENTRY:                                                               
  *                                                                         
         ＴＲＮＳレコードＩＤ      := 発券取消ＩＤ                          
         ＴＲＮＳゲームタイプ      := Ｔ１２０ゲームタイプ(CNT)             
         ＴＲＮＳブロックコード    := Ｔ１２０ブロックコード(CNT)           
         ＴＲＮＳ開始回号          := Ｔ１２０開始回号(CNT)                 
         ＴＲＮＳ当初継続回号数    := Ｔ１２０継続回号数(CNT)               
         ＴＲＮＳ実質継続回号数    := Ｔ１２０継続回号数(CNT)               
         ＴＲＮＳ金額              := Ｔ１２０発券取消金額(CNT)             
         ＴＲＮＳ取消区分          :=  0     ;通常取消                      
  * 識別コード                                                              
         ＷＫ−変換前識別コード ,                                           
           := Ｔ１２０発券取消識別コード(CNT)                               
         CALL: ZMSSRLCV-RTN  ; 識別コード変換処理                           
         ＴＲＮＳ識別コード  := ＷＫ−変換後識別コード                      
  * 発券識別コード、旧識別コード、識別コード区分                            
         ＷＫ−変換前識別コード  := Ｔ１２０識別コード(CNT)                 
         CALL: ZMSSRLCV-RTN  ; 識別コード変換処理                           
         ＴＲＮＳ発券識別コード  := ＷＫ−変換後識別コード                  
         IF: ＷＫ−変換前識別コード下 NOT = ZERO                            
            ＴＲＮＳ識別コード区分 :=  ２４桁                               
         ELSE:                                                              
            ＴＲＮＳ識別コード区分 :=  １６桁                               
            ＴＲＮＳ旧識別コード上 :=  ＷＫ−変換前識別コード上             
            ＴＲＮＳ旧識別コード下 :=  ＷＫ−変換前識別コード中             
         END:                                                               
       EXIT:                                                                
  *                                                                         
   SPACE:0                                                                  
   NOTE:                                                                    
     支払レコード編集処理                                                   
   NEND:                                                                    
   PROC:P332-RTN                                                            
       ENTRY:                                                               
  * ゲーム種別                                                              
  * 前回処理した要求電文とゲームタイプが異なる場合のみ、                    
  * ゲーム種別を取得                                                        
         IF: ＷＫ−ゲームタイプ NOT = Ｔ２１０ゲームタイプ(CNT)             
            ＷＫ−ゲームタイプ    :=  Ｔ２１０ゲームタイプ(CNT)             
            CALL:IDX-GMTYSET-RTN                                            
              ; ゲームタイプテーブル添字セット処理                          
         END:                                                               
         ＴＲＮＳゲーム種別      :=  Ｔ−ＧＴゲーム種別(IDX-GMTY)           
  *                                                                         
         IF:  Ｔ２１０支払フラグ(CNT)  =  期限後支払                        
              ＴＲＮＳレコードＩＤ    :=  期限後支払ＩＤ                    
         ELSE:                                                              
              ＴＲＮＳレコードＩＤ    :=  支払ＩＤ                          
         END:                                                               
  *                                                                         
         ＴＲＮＳゲームタイプ      := Ｔ２１０ゲームタイプ(CNT)             
         ＴＲＮＳブロックコード    := Ｔ２１０ブロックコード(CNT)           
         ＴＲＮＳ口数              := Ｔ２１０申込口数(CNT)                 
         ＴＲＮＳ開始回号          := Ｔ２１０回号(CNT 1)                   
         ＴＲＮＳロール番号        := Ｔ２１０裏面番号１(CNT)               
  *                                                                         
         ＷＫ−連番ＣＤ分解        := Ｔ２１０裏面番号２(CNT)               
         ＴＲＮＳ連番              := ＷＫ−チケット連番                    
         ＷＫ−ＣＫＤロール番号    := ＴＲＮＳロール番号                    
         ＷＫ−ＣＫＤ連番          := ＴＲＮＳ連番                          
         DIVIDE  ＷＫ−ＣＫＤ計算９  BY  9  GIVING  ＷＫ−商                
                                     REMAINDER  ＷＫ−ＣＫＤ                
         IF: ＷＫ−ＣＫＤ = ZERO                                            
           ＴＲＮＳ連番チェックＤ  := ＷＫ−ＣＫＤ                          
         ELSE:                                                              
           ＴＲＮＳ連番チェックＤ  := 9 - ＷＫ−ＣＫＤ                      
         END:                                                               
  * 識別コード                                                              
         ＷＫ−変換前識別コード ,                                           
           := Ｔ２１０支払識別コード(CNT)                                   
         CALL: ZMSSRLCV-RTN  ; 識別コード変換処理                           
         ＴＲＮＳ識別コード  := ＷＫ−変換後識別コード                      
  * 発券識別コード、旧識別コード、識別コード区分                            
         ＷＫ−変換前識別コード  := Ｔ２１０識別コード(CNT)                 
         CALL: ZMSSRLCV-RTN  ; 識別コード変換処理                           
         ＴＲＮＳ発券識別コード  := ＷＫ−変換後識別コード                  
         IF: ＷＫ−変換前識別コード下 NOT = ZERO                            
            ＴＲＮＳ識別コード区分 :=  ２４桁                               
         ELSE:                                                              
            ＴＲＮＳ識別コード区分 :=  １６桁                               
            ＴＲＮＳ旧識別コード上 :=  ＷＫ−変換前識別コード上             
            ＴＲＮＳ旧識別コード下 :=  ＷＫ−変換前識別コード中             
         END:                                                               
  * 金額                                                                    
  * Ｔ２１０支払金額の属性 X(14) をＷＫ−金額 9(14) へ変換後、セット        
         ＷＫ−金額９              := Ｔ２１０支払金額(CNT)                 
         ＴＲＮＳ金額              := ＷＫ−金額９                          
  * 当せん等級、コンビ当せん等級、当初継続回号数、パネル数                  
  * （バッチ処理の売上集計処理(HBHUN370)にて、支払レコードより              
  *   支払関連の集計を行う為に、以下の項目に値をセットする）                
         IF: Ｔ２１０当せん口数(CNT 1) NOT = 0                              
  * ロトコンビの場合                                                        
            ＴＲＮＳ当初継続回号数    := 1                                  
            ＴＲＮＳパネル数          := 1                                  
            CNT-PANEL := 1                                                  
            WHILE:CNT-PANEL  <= Ｔ２１０当せん数(CNT)                       
              ＷＫ−等級Ｘ  :=  Ｔ２１０等級(CNT CNT-PANEL)                 
              CALL:TOUKYU-RTN  ;  当せん等級算出処理                        
              ＴＲＮＳコンビ当せん口数(ＷＫ−等級９) ,                      
                 := Ｔ２１０当せん口数(CNT CNT-PANEL)                       
              IF: CNT-PANEL = Ｔ２１０当せん数(CNT)                         
                 ＴＲＮＳコンビ最下位当等級 := ＷＫ−等級９                 
              END:                                                          
              CNT-PANEL := CNT-PANEL + 1                                    
            END:                                                            
  * ロトコンビ以外の場合                                                    
         ELSE:                                                              
            ＴＲＮＳ当初継続回号数    := 1                                  
            ＴＲＮＳパネル数          := Ｔ２１０当せん数(CNT)              
            CNT-PANEL := 1                                                  
            WHILE:CNT-PANEL  <= Ｔ２１０当せん数(CNT)                       
              ＷＫ−等級Ｘ  :=  Ｔ２１０等級(CNT CNT-PANEL)                 
              CALL:TOUKYU-RTN  ;  当せん等級算出処理                        
              IF: Ｔ２１０回号(CNT CNT-PANEL) = Ｔ２１０回号(CNT 1)         
  * 単独くじ券、継続くじ券の１番目の当せん明細に対する処理の場合            
  * または、単独くじ券の２番目以降の当せん明細に対する処理の場合            
  * （複数パネル当せん）                                                    
                 ＴＲＮＳ当せん等級(CNT-PANEL)  :=  ＷＫ−等級９            
              ELSE:                                                         
  * 継続くじ券の２番目以降の当せん明細に対する処理の場合                    
  * （継続申込複数当せん）                                                  
                 ＷＫ−格納位置 := Ｔ２１０回号(CNT CNT-PANEL) ,            
                   - Ｔ２１０回号(CNT 1) + 1                                
                 ＴＲＮＳ当せん等級(ＷＫ−格納位置) ,                       
                   :=  ＷＫ−等級９                                         
                 ＴＲＮＳ当初継続回号数    := ＷＫ−格納位置                
                 ＴＲＮＳパネル数          := 1                             
              END:                                                          
              CNT-PANEL := CNT-PANEL + 1                                    
            END:                                                            
         END:                                                               
  * 取消支払情報                                                            
         ＴＲＮＳ取消支払売場コード   :=  ＷＫ２発信元ＩＤ(CNT)             
         ＴＲＮＳ取消支払販売員ＩＤ   :=  ＷＫ２販売員ＩＤ(CNT)             
         ＴＲＮＳ取消支払取引日付     :=  ＷＫ２日付(CNT)                   
         ＴＲＮＳ取消支払取引時刻     :=  ＷＫ２時刻(CNT)                   
         ＴＲＮＳ取消支払受付日付     :=  ＷＫ２受付日付(CNT)               
         ＴＲＮＳ取消支払受付時刻     :=  ＷＫ２受付時刻(CNT)               
         ＴＲＮＳ取消支払ＦＥＰ番号   :=  ＷＫ−ＦＥＰ番号                  
         ＴＲＮＳ取消支払パス通番     :=  ＷＫ−パス番号                    
         ＴＲＮＳ取消支払Ｃ状態       :=  ＷＫ−センター状態                
       EXIT:                                                                
  *                                                                         
   SPACE:0                                                                  
   NOTE:                                                                    
     代替券レコード編集処理                                                 
   NEND:                                                                    
   PROC:P333-RTN                                                            
       ENTRY:                                                               
  * ゲーム種別                                                              
  * 前回処理した要求電文とゲームタイプが異なる場合のみ、                    
  * ゲーム種別を取得                                                        
         IF: ＷＫ−ゲームタイプ NOT = Ｔ２２１ゲームタイプ(CNT)             
            ＷＫ−ゲームタイプ    :=  Ｔ２２１ゲームタイプ(CNT)             
            CALL:IDX-GMTYSET-RTN                                            
              ; ゲームタイプテーブル添字セット処理                          
         END:                                                               
         ＴＲＮＳゲーム種別      :=  Ｔ−ＧＴゲーム種別(IDX-GMTY)           
  *                                                                         
         ＴＲＮＳレコードＩＤ    := 代替券ＩＤ                              
         ＴＲＮＳ出力番号        := 1                                       
         ＴＲＮＳ出力枚数        := 1                                       
         ＴＲＮＳパネル数        := 1                                       
  *                                                                         
         ＴＲＮＳゲームタイプ     := Ｔ２２１ゲームタイプ(CNT)              
         ＴＲＮＳブロックコード   := Ｔ２２１ブロックコード(CNT)            
         ＴＲＮＳ開始回号         := Ｔ２２１未抽せん開始回号(CNT)          
         ＴＲＮＳ当初継続回号数   := Ｔ２２１未抽せん回号数(CNT)            
         ＴＲＮＳ実質継続回号数   := Ｔ２２１未抽せん回号数(CNT)            
         ＴＲＮＳ口数             := Ｔ２２１申込口数(CNT)                  
         ＴＲＮＳセキュリティコード  := Ｔ２２１ハッシュ値(CNT)             
         ＴＲＮＳ障害取消通番     := Ｔ２２１障害取消通番(CNT)              
         ＴＲＮＳロール番号       := Ｔ２２１裏面番号１(CNT)                
  *                                                                         
         ＷＫ−連番ＣＤ分解      := Ｔ２２１裏面番号２(CNT)                 
         ＴＲＮＳ連番            := ＷＫ−チケット連番                      
         ＷＫ−ＣＫＤロール番号  := ＴＲＮＳロール番号                      
         ＷＫ−ＣＫＤ連番        := ＴＲＮＳ連番                            
         DIVIDE  ＷＫ−ＣＫＤ計算９  BY  9  GIVING  ＷＫ−商                
                                     REMAINDER  ＷＫ−ＣＫＤ                
         IF: ＷＫ−ＣＫＤ = ZERO                                            
           ＴＲＮＳ連番チェックＤ := ＷＫ−ＣＫＤ                           
         ELSE:                                                              
           ＴＲＮＳ連番チェックＤ := 9 - ＷＫ−ＣＫＤ                       
         END:                                                               
  * 識別コード、旧識別コード、識別コード区分                                
         ＷＫ−変換前識別コード ,                                           
           := Ｔ２２１代替券識別コード(CNT)                                 
         CALL: ZMSSRLCV-RTN  ; 識別コード変換処理                           
         ＴＲＮＳ識別コード  := ＷＫ−変換後識別コード                      
         IF: ＷＫ−変換前識別コード下 NOT = ZERO                            
            ＴＲＮＳ識別コード区分 :=  ２４桁                               
         ELSE:                                                              
            ＴＲＮＳ識別コード区分 :=  １６桁                               
            ＴＲＮＳ旧識別コード上 :=  ＷＫ−変換前識別コード上             
            ＴＲＮＳ旧識別コード下 :=  ＷＫ−変換前識別コード中             
         END:                                                               
  * 発券識別コード                                                          
         IF: Ｔ２２１前識別コード(CNT)  NOT =  LOW-VALUE                    
            ＷＫ−変換前識別コード  := Ｔ２２１前識別コード(CNT)            
            CALL: ZMSSRLCV-RTN  ; 識別コード変換処理                        
            ＴＲＮＳ発券識別コード  := ＷＫ−変換後識別コード               
         END:                                                               
  * 申込数字、クイックピック、申込タイプ                                    
         ＴＲＮＳ申込数字(1)    := Ｔ２２１申込数字(CNT)                    
         ＴＲＮＳクイックピック区分(1) ,                                    
           := Ｔ２２１クイックピック(CNT)                                   
         ＴＲＮＳ申込タイプ(1)  := Ｔ２２１申込タイプ(CNT)                  
       EXIT:                                                                
  *                                                                         
   SPACE:0                                                                  
   NOTE:                                                                    
     支払取消レコード編集                                                   
   NEND:                                                                    
   PROC:P334-RTN                                                            
       ENTRY:                                                               
  * 支払取消レコード編集                                                    
         ＴＲＮＳレコードＩＤ      := 支払取消ＩＤ                          
         ＴＲＮＳゲームタイプ      := Ｔ２４０ゲームタイプ(CNT)             
         ＴＲＮＳブロックコード    := Ｔ２４０ブロックコード(CNT)           
         ＴＲＮＳ取消区分          :=  0           ;通常                    
  * 識別コード                                                              
         ＷＫ−変換前識別コード ,                                           
           := Ｔ２４０支払取消識別コード(CNT)                               
         CALL: ZMSSRLCV-RTN  ; 識別コード変換処理                           
         ＴＲＮＳ識別コード  := ＷＫ−変換後識別コード                      
  * 発券識別コード、旧識別コード、識別コード区分                            
         ＷＫ−変換前識別コード  := Ｔ２４０識別コード(CNT)                 
         CALL: ZMSSRLCV-RTN  ; 識別コード変換処理                           
         ＴＲＮＳ発券識別コード  := ＷＫ−変換後識別コード                  
         IF: ＷＫ−変換前識別コード下 NOT = ZERO                            
            ＴＲＮＳ識別コード区分 :=  ２４桁                               
         ELSE:                                                              
            ＴＲＮＳ識別コード区分 :=  １６桁                               
            ＴＲＮＳ旧識別コード上 :=  ＷＫ−変換前識別コード上             
            ＴＲＮＳ旧識別コード下 :=  ＷＫ−変換前識別コード中             
         END:                                                               
  * 代替識別コード                                                          
         IF: Ｔ２４０代替券識別コード(CNT)  NOT =  LOW-VALUE                
            ＷＫ−変換前識別コード ,                                        
              := Ｔ２４０代替券識別コード(CNT)                              
            CALL: ZMSSRLCV-RTN  ; 識別コード変換処理                        
            ＴＲＮＳ代替識別コード  := ＷＫ−変換後識別コード               
         END:                                                               
       EXIT:                                                                
  *                                                                         
   SPACE:0                                                                  
   NOTE:                                                                    
   プール計数一括更新チェック処理                                           
   NEND:                                                                    
   PROC:P811-RTN                                                            
       ENTRY:                                                               
  * 前回のプール計数ファイル更新情報を取得し                                
  * 未更新分のプール計数ファイルを更新する。                                
         IDX-SEDAI := 1                                                     
         WHILE: IDX-SEDAI <= 2                                              
           CNT-FEP := 1                                                     
           WHILE: CNT-FEP <= ＰＡＴＨＦＥＰ台数                             
             CNT-CHANNEL := 1                                               
             WHILE: CNT-CHANNEL <= ＣＨＡＮ販売チャネル数                     
               IF: ＦＬＧ世別Ｆ別Ｃ別電文有無 ,                             
                   (IDX-SEDAI CNT-FEP CNT-CHANNEL) = ＯＮ                     
  ;トランザクション出力履歴ファイル読込処理                                 
                  CALL: TRSYRI-READ-RTN                                     
                  ＷＫ−履歴ゲームタイプ   := ,                             
                    ＴＲＳＲゲームタイプ ,                                  
                     (IDX-SEDAI ＷＫ−ＦＥＰ番号 ＷＫ−パス番号)            
                  ＷＫ−履歴ブロックコード := ,                             
                    ＴＲＳＲブロックコード ,                                
                     (IDX-SEDAI ＷＫ−ＦＥＰ番号 ＷＫ−パス番号)            
                  RETURN:                                                   
               END:                                                         
               CNT-CHANNEL := CNT-CHANNEL + 1                               
             END:                                                           
             CNT-FEP := CNT-FEP + 1                                         
           END:                                                             
           IDX-SEDAI := IDX-SEDAI + 1                                       
         END:                                                               
       EXIT:                                                                
  *                                                                         
   SPACE:0                                                                  
   NOTE:                                                                    
   トランザクション出力履歴ファイル更新処理                                 
   NEND:                                                                    
   PROC:P812-RTN                                                            
       ENTRY:                                                               
  * トランザクション出力履歴ファイルに                                      
  * プール計数ファイルの更新情報をを登録する。                              
         IDX-SEDAI := 1                                                     
         WHILE: IDX-SEDAI <= 2                                              
           CNT-FEP := 1                                                     
           WHILE: CNT-FEP <= ＰＡＴＨＦＥＰ台数                             
             CNT-CHANNEL := 1                                               
             WHILE: CNT-CHANNEL <= ＣＨＡＮ販売チャネル数                     
               IF: ＦＬＧ世別Ｆ別Ｃ別電文有無 ,                             
                   (IDX-SEDAI CNT-FEP CNT-CHANNEL) = ＯＮ                     
  ;トランザクション出力履歴ファイル読込処理                                 
                 CALL: TRSYRI-READ-RTN                                      
                 ＴＲＳＲゲームタイプ ,                                     
                   (IDX-SEDAI ＷＫ−ＦＥＰ番号 ＷＫ−パス番号) ,            
                     := Ｔ−ＰＬゲームタイプ(CNT)                           
                 ＴＲＳＲブロックコード ,                                   
                   (IDX-SEDAI ＷＫ−ＦＥＰ番号 ＷＫ−パス番号) ,            
                     := Ｔ−ＰＬブロックコード(CNT)                         
  ;トランザクション出力履歴ファイル更新処理                                 
                 CALL: TRSYRI-REWRITE-RTN                                   
               END:                                                         
               CNT-CHANNEL := CNT-CHANNEL + 1                               
             END:                                                           
             CNT-FEP := CNT-FEP + 1                                         
           END:                                                             
           IDX-SEDAI := IDX-SEDAI + 1                                       
         END:                                                               
       EXIT:                                                                
  *                                                                         
   SPACE:0                                                                  
   NOTE:                                                                    
   共通ルーチン                                                             
   NEND:                                                                    
   NOTE:                                                                    
   トランザクションエンド                                                   
   NEND:                                                                    
   PROC:TRNSEND-RTN                                                         
       ENTRY:                                                               
         TRNS-ENDKEY               := ZERO                                  
         TRNS-FUNCTION             := "TRNS"                                
         ECALL: A_VIS_CBL (VISUCA  TRNS-ENDKEY )                            
         IF:  TRNS-FSTATUS  NOT = "00" AND "01"                             
           @ZCTABORT( MSGID  = #RT236 ,                                     
                      PROGID = HRCAL010 ,                                   
                      CNT    = 18 ,                                         
                      TEXT1  = TRNS-FSTATUS ) ;                             
         END:                                                               
       EXIT:                                                                
  *                                                                         
  *                                                                         
   NOTE:                                                                    
   識別コード変換処理                                                       
   NEND:                                                                    
   PROC:ZMSSRLCV-RTN                                                        
       ENTRY:                                                               
  * ２４桁の識別コードの場合、識別コード変換は不要                          
         IF: ＷＫ−変換前識別コード下 NOT = ZERO                              
            ＷＫ−変換後識別コード := ＷＫ−変換前識別コード                
         ELSE:                                                              
  * １６桁の識別コードの場合、１６桁→２４桁へ識別コード変換                  
            IF: ＦＬＧ識別変換ＰＴＲセット  =  ＯＦＦ                           
  * 本サブルーチンを始めてコールした際、パラメータのポインタをセット        
               SET PTR_SBCDBEFORE TO ,                                      
                    ADDRESS OF ＷＫ−１６桁識別コード                       
               SET PTR_SBCDAFTER  TO ,                                      
                    ADDRESS OF ＷＫ−２４桁識別コード                       
               ＦＬＧ識別変換ＰＴＲセット  :=  ＯＮ                         
            END:                                                            
  *                                                                         
            ＷＫ−１６桁識別コード上 := ＷＫ−変換前識別コード上            
            ＷＫ−１６桁識別コード下 := ＷＫ−変換前識別コード中            
  * 識別コード変換部品呼出                                                  
            @ZMSSRLCV(MODE = 2 ,                                            
                      SBCDBEFORE  = PTR_SBCDBEFORE  ,                       
                      SBCDAFTER   = PTR_SBCDAFTER  ) ;                      
            ＷＫ−変換後識別コード上 := ＷＫ−２４桁識別コード上            
            ＷＫ−変換後識別コード中 := ＷＫ−２４桁識別コード中            
            ＷＫ−変換後識別コード下 := ＷＫ−２４桁識別コード下            
         END:                                                               
       EXIT:                                                                
  *                                                                         
   SPACE:0                                                                  
   NOTE:                                                                    
   ゲームタイプテーブル添字セット処理                                       
   NEND:                                                                    
   PROC:IDX-GMTYSET-RTN                                                     
       ENTRY:                                                               
         IDX-GMTY   := 0                                                    
         ＦＬＧ一致 := ＯＦＦ                                               
         WHILE: IDX-GMTY <= Ｔ−ＧＴレコード件数  AND  ,                    
                ＦＬＧ一致 = ＯＦＦ                                         
           IDX-GMTY := IDX-GMTY + 1                                         
           IF: Ｔ−ＧＴゲームタイプ(IDX-GMTY) = ＷＫ−ゲームタイプ          
             ＦＬＧ一致 := ＯＮ                                             
           END:                                                             
         END:                                                               
       EXIT:                                                                
  *                                                                         
   SPACE:0                                                                  
   NOTE:                                                                    
   ゲームタイプファイル読込処理                                             
   NEND:                                                                    
   PROC:GMTY-READ-RTN                                                       
       ENTRY:                                                               
  * ゲームタイプファイル読込                                                
         ＧＭＴＹゲームタイプ  :=  ＣＤＣＫ変換後入力電文(49:2)             
         READ ゲームタイプファイル                                          
           INVALID KEY CONTINUE.                                            
         CASE: ＳＴＳコード                                                 
         OF: ZERO       ;正常                                               
         OTHER:         ;その他                                             
           @ZCTABORT( MSGID  = #RT201 ,                                     
                      PROGID = HRCAL010 ,                                   
                      CNT    = 21       ,                                   
                      TEXT1  = "ｹﾞｰﾑﾀｲﾌﾟF" ,                                
                      TEXT2  = "-" ,                                        
                      TEXT3  = "-" ,                                        
                      TEXT4  = "READ" ,                                     
                      TEXT5  = ＧＭＴＹゲームタイプ ,                       
                      TEXT6  = ＳＴＳコード ,                               
                      TEXT7  = ＳＴＳ詳細 );                                
         END:                                                               
  * ゲームタイプテーブルセット処理                                          
         Ｔ−ＧＴレコード件数 := 1                                          
         Ｔ−ＧＴゲームタイプＲ(1) := ゲームタイプＲ                        
       EXIT:                                                                
  *                                                                         
   SPACE:0                                                                  
   NOTE:                                                                    
   ゲーム計数レコードセット処理                                             
   NEND:                                                                    
   PROC:GMKS-SET-RTN                                                        
       ENTRY:                                                               
  * 世代区分セット                                                          
         IF: ＷＫ−日付 = Ｔ−ＳＵ業務日付(1)                               
            IDX-GMKS   := 0                                                 
            ＦＬＧ一致 := ＯＦＦ                                            
            WHILE: IDX-GMKS <= Ｔ−Ｇ１レコード件数  AND  ,                 
                   ＦＬＧ一致 = ＯＦＦ                                      
              IDX-GMKS := IDX-GMKS + 1                                      
              IF: Ｔ−Ｇ１ゲームタイプ(IDX-GMKS) ,                          
                    = ＷＫ−ゲームタイプ  AND ,                             
                  Ｔ−Ｇ１ブロックコード(IDX-GMKS) ,                        
                    = ＷＫ−ブロックコード                                  
                ＦＬＧ一致 := ＯＮ                                          
              END:                                                          
            END:                                                            
            退避ＧＫゲーム計数Ｒ := Ｔ−Ｇ１ゲーム計数Ｒ(IDX-GMKS)          
         ELSE:                                                              
            IDX-GMKS   := 0                                                 
            ＦＬＧ一致 := ＯＦＦ                                            
            WHILE: IDX-GMKS <= Ｔ−Ｇ２レコード件数  AND  ,                 
                   ＦＬＧ一致 = ＯＦＦ                                      
              IDX-GMKS := IDX-GMKS + 1                                      
              IF: Ｔ−Ｇ２ゲームタイプ(IDX-GMKS) ,                          
                    = ＷＫ−ゲームタイプ  AND ,                             
                  Ｔ−Ｇ２ブロックコード(IDX-GMKS) ,                        
                    = ＷＫ−ブロックコード                                  
                ＦＬＧ一致 := ＯＮ                                          
              END:                                                          
            END:                                                            
            退避ＧＫゲーム計数Ｒ := Ｔ−Ｇ２ゲーム計数Ｒ(IDX-GMKS)          
         END:                                                               
       EXIT:                                                                
  *                                                                         
   SPACE:0                                                                  
   NOTE:                                                                    
   ゲーム計数レコード読込処理                                               
   NEND:                                                                    
   PROC:GMKS-READ-RTN                                                       
       ENTRY:                                                               
  * ゲーム計数ファイル読込処理                                              
         ＷＫ−世代判定業務日付 := ＣＤＣＫ受付日付                         
         CALL: SEDAI-RTN  ; 世代区分判定処理                                
  *                                                                         
         CASE: ＷＫ−世代区分                                               
         OF: 世代Ａ                                                         
           SET  FGMKSPTR  TO  FGMKSPTRA                                     
         OF: 世代Ｂ                                                         
           SET  FGMKSPTR  TO  FGMKSPTRB                                     
         END:                                                               
         ＧＭＫＳゲームタイプ    :=  ＣＤＣＫ変換後入力電文(49:2)           
         ＷＫ−ブロックコードＸ  :=  ＣＤＣＫ変換後入力電文(51:2)           
         ＧＭＫＳブロックコード  :=  ＷＫ−ブロックコード９                 
         READ ゲーム計数ファイル                                            
           INVALID KEY CONTINUE.                                            
         CASE: ＳＴＳコード                                                 
         OF: ZERO       ;正常                                               
         OTHER:         ;その他                                             
           ＷＫ−計数ゲームタイプ   := ＧＭＫＳゲームタイプ                 
           ＷＫ−計数ブロックコード := ＧＭＫＳブロックコード               
           @ZCTABORT( MSGID  = #RT201 ,                                     
                      PROGID = HRCAL010 ,                                   
                      CNT    = 22       ,                                   
                      TEXT1  = "ｹﾞｰﾑｹｲｽｳF" ,                                
                      TEXT2  = "-" ,                                        
                      TEXT3  = ＷＫ−世代区分 ,                             
                      TEXT4  = "READ" ,                                     
                      TEXT5  = ＷＫ−ゲーム計数キー ,                       
                      TEXT6  = ＳＴＳコード ,                               
                      TEXT7  = ＳＴＳ詳細 );                                
             ＣＤＣＫＲＴＮＣＤ := "99"                                     
             RETURN:S                                                       
         END:                                                               
  * ゲーム計数テーブルセット処理                                            
         CASE: ＷＫ−世代区分                                               
         OF: 世代Ａ                                                         
           Ｔ−Ｇ１レコード件数     := 1                                    
           Ｔ−Ｇ１ゲーム計数Ｒ(1)  := ゲーム計数Ｒ                         
         OF: 世代Ｂ                                                         
           Ｔ−Ｇ２レコード件数     := 1                                    
           Ｔ−Ｇ２ゲーム計数Ｒ(1)  :=  ゲーム計数Ｒ                        
         END:                                                               
       EXIT:                                                                
  *                                                                         
   SPACE:0                                                                  
   NOTE:                                                                    
   世代区分判定処理                                                         
   NEND:                                                                    
   PROC:SEDAI-RTN                                                           
       ENTRY:                                                               
         CASE: ＷＫ−世代判定業務日付                                       
          OF: Ｔ−ＳＵ業務日付(1)                                           
            ＷＫ−世代区分  := 世代Ａ                                       
          OF: Ｔ−ＳＵ業務日付(2)                                           
            ＷＫ−世代区分  := 世代Ｂ                                       
         END:                                                               
       EXIT:                                                                
  *                                                                         
   SPACE:0                                                                  
   NOTE:                                                                    
   当せん等級算出処理                                                       
   NEND:                                                                    
   PROC:TOUKYU-RTN                                                          
       ENTRY:                                                               
         CASE: ＴＲＮＳゲーム種別                                           
         OF: ナンバーズ                                                     
           CASE: ＷＫ−等級ＢＩＴ                                           
           OF: ストレート                                                   
             ＷＫ−等級９    := 1                                           
           OF: ボックス                                                     
             ＷＫ−等級９    := 2                                           
           OF: Ｓ／Ｂストレート                                             
             ＷＫ−等級９    := 3                                           
           OF: Ｓ／Ｂボックス                                               
             ＷＫ−等級９    := 4                                           
           OF: Ｆペア                                                       
             ＷＫ−等級９    := 5                                           
           OF: Ｂペア                                                       
             ＷＫ−等級９    := 6                                           
           OF: チャンス／ピタリ                                             
             ＷＫ−等級９    := 7                                           
           OF: チャンス／一字違                                             
             ＷＫ−等級９    := 8                                           
           END:                                                             
         OF: ロト                                                           
           CASE: ＷＫ−等級ＢＩＴ                                           
           OF: １等                                                         
             ＷＫ−等級９    := 1                                           
           OF: ２等                                                         
             ＷＫ−等級９    := 2                                           
           OF: ３等                                                         
             ＷＫ−等級９    := 3                                           
           OF: ４等                                                         
             ＷＫ−等級９    := 4                                           
           OF: ５等                                                         
             ＷＫ−等級９    := 5                                           
           OF: ６等                                                         
             ＷＫ−等級９    := 6                                           
           OF: ７等                                                         
             ＷＫ−等級９    := 7                                           
           OF: ８等                                                         
             ＷＫ−等級９    := 8                                           
           OF: ９等                                                         
             ＷＫ−等級９    := 9                                           
           END:                                                             
         END:                                                               
       EXIT:                                                                
  *                                                                         
   SPACE:0                                                                  
   NOTE:                                                                    
   トランザクションエラーファイル出力処理                                   
   NEND:                                                                    
   PROC:TRNS-ERR-RTN                                                        
       ENTRY:                                                               
  * ファイルポインタセット                                                  
         ＷＫ−世代判定業務日付 := 退避ＫＨ受付日付                         
         CALL: SEDAI-RTN ; 世代区分判定処理                                 
         IF: ＷＫ−世代区分 = 世代Ａ                                        
           SET  FTRERPTR  TO  FTRERPTRA                                     
         ELSE: ; 世代Ｂ                                                     
           SET  FTRERPTR  TO  FTRERPTRB                                     
         END:                                                               
  * トランザクションエラーファイル読み込み（管理レコード）                  
         ＴＲＥＲ相対キー := 1                                              
         READ  トランザクションＥＲＦ  INVALID KEY CONTINUE                 
         IF:  ＳＴＳコード NOT = ZERO                                       
           @ZCTABORT( MSGID  = #RT201 ,                                     
                      PROGID = HRCAL010 ,                                   
                      CNT    = 15 ,                                         
                      TEXT1  = "ﾄﾗﾝｻﾞｸｼｮﾝｴﾗｰF" ,                            
                      TEXT2  = "-" ,                                        
                      TEXT3  = ＷＫ−世代区分 ,                             
                      TEXT4  = "READ" ,                                     
                      TEXT5  = ＴＲＥＲ相対キー ,                           
                      TEXT6  = ＳＴＳコード ,                               
                      TEXT7  = ＳＴＳ詳細 ) ;                               
         END:                                                               
  * トランザクションエラーファイル項目セット（管理レコード）                
         ＴＲＥＲカレント相対キー := ,                                      
                       ＴＲＥＲカレント相対キー + 1                         
         ＷＫ−相対番号 := ＴＲＥＲカレント相対キー                         
  * トランザクションエラーファイル更新（管理レコード）                      
         REWRITE  ＴＲＥＲ管理Ｒ  INVALID KEY CONTINUE                      
         IF:  ＳＴＳコード NOT = ZERO                                       
           @ZCTABORT( MSGID  = #RT201 ,                                     
                      PROGID = HRCAL010 ,                                   
                      CNT    = 16 ,                                         
                      TEXT1  = "ﾄﾗﾝｻﾞｸｼｮﾝｴﾗｰF" ,                            
                      TEXT2  = "-" ,                                        
                      TEXT3  = ＷＫ−世代区分 ,                             
                      TEXT4  = "REWRITE" ,                                  
                      TEXT5  = ＴＲＥＲ相対キー ,                           
                      TEXT6  = ＳＴＳコード ,                               
                      TEXT7  = ＳＴＳ詳細 ) ;                               
         END:                                                               
  * トランザクションエラーファイル項目セット（明細レコード）                
         INITIALIZE  ＴＲＥＲ明細Ｒ１.                                      
         ＴＲＥＲデータ種別    := 電文                                      
         ＴＲＥＲ処理状態      := 未処理 ;未処理(ｺｰﾄﾞ:00)                   
         ＴＲＥＲ送受信端末名  := ＷＫ−変換前送受信端末名                  
         ＴＲＥＲセンター状態  := ＷＫ−変換前センター状態                  
         IF: 退避ＫＨ電文種別 = 発券要求  OR ,                              
             退避ＫＨ電文種別 = 発券障害取消要求  OR ,                      
             退避ＫＨ電文種別 = 発券端末サーバ障害取消要求                  
            ＴＲＥＲ電文  :=  ＷＫ−発券電文ＴＢＬ(CNT)                     
         ELSE:                                                              
            ＴＲＥＲ電文  :=  ＷＫ−発券以外電文ＴＢＬ(CNT)                 
         END:                                                               
  * トランザクションエラーファイル出力（明細レコード）                      
         ＴＲＥＲ相対キー := ＷＫ−相対番号                                 
         WRITE  ＴＲＥＲ明細Ｒ１  INVALID KEY CONTINUE                      
         IF:  ＳＴＳコード NOT = ZERO                                       
           @ZCTABORT( MSGID  = #RT201 ,                                     
                      PROGID = HRCAL010 ,                                   
                      CNT    = 17 ,                                         
                      TEXT1  = "ﾄﾗﾝｻﾞｸｼｮﾝｴﾗｰF" ,                            
                      TEXT2  = "-" ,                                        
                      TEXT3  = ＷＫ−世代区分 ,                             
                      TEXT4  = "WRITE" ,                                    
                      TEXT5  = ＴＲＥＲ相対キー ,                           
                      TEXT6  = ＳＴＳコード ,                               
                      TEXT7  = ＳＴＳ詳細 ) ;                               
         END:                                                               
       EXIT:                                                                
  *                                                                         
   SPACE:0                                                                  
   NOTE:                                                                    
   トランザクション出力履歴ファイル読込処理                                 
   NEND:                                                                    
   PROC:TRSYRI-READ-RTN                                                     
       ENTRY:                                                               
         ＴＲＳＲＦＥＰ番号          :=  CNT-FEP                            
         ＴＲＳＲ販売チャネルコード  :=  CNT-CHANNEL                        
         READ  トランザクション出力履歴Ｆ                                   
                                       INVALID  CONTINUE.                   
         IF:  ＳＴＳコード  NOT =  ZERO                                     
            @ZCTABORT( MSGID   =  #RT201                                    
            ,          PROGID  =  HRCAL010                                  
            ,          CNT     =  19                                        
            ,          TEXT1   =  "TRNSｼｭﾂﾘｮｸﾘﾚｷF"                          
            ,          TEXT2   =  "-"                                       
            ,          TEXT3   =  "-"                                       
            ,          TEXT4   =  "READ"                                    
            ,          TEXT5   =  ＴＲＳＲキー項目                          
            ,          TEXT6   =  ＳＴＳコード                              
            ,          TEXT7   =  ＳＴＳ詳細             );                 
         END:                                                               
       EXIT:                                                                
  *                                                                         
   SPACE:0                                                                  
   NOTE:                                                                    
   トランザクション出力履歴ファイル更新処理                                 
   NEND:                                                                    
   PROC:TRSYRI-REWRITE-RTN                                                  
       ENTRY:                                                               
         REWRITE  トランザクション出力履歴Ｒ                                
                                       INVALID  CONTINUE.                   
         IF:  ＳＴＳコード  NOT =  ZERO                                     
            @ZCTABORT( MSGID   =  #RT201                                    
            ,          PROGID  =  HRCAL010                                  
            ,          CNT     =  20                                        
            ,          TEXT1   =  "TRNSｼｭﾂﾘｮｸﾘﾚｷF"                          
            ,          TEXT2   =  "-"                                       
            ,          TEXT3   =  "-"                                       
            ,          TEXT4   =  "REWRITE"                                 
            ,          TEXT5   =  ＴＲＳＲキー項目                          
            ,          TEXT6   =  ＳＴＳコード                              
            ,          TEXT7   =  ＳＴＳ詳細             );                 
         END:                                                               
       EXIT:                                                                
   NOTE:                                                                    
                                                                            
   プログラム名称       遅延型処理メイン                                    
                                                                            
   機能説明　　　       トランザクションファイルにレコード                  
                        を作成し、機能毎に各プログラムへの                  
   　　　　　　　       振り分けを行う。                                    
                                                                            
   作成　　　　　          04-03-31  (R01.00)  高尾　哲矢                   
                                                                            
   更新履歴　　　          YY-MM-DD  (R99.99)                               
                                                                            
   NEND:                                                                    
   ID:                     HRCAL010                                         
   DATE-WRITTEN.                                                            
   DATE-COMPILED.                                                           
   ED:                                                                      
   CS:                                                                      
   SOURCE-COMPUTER.        ACOS.                                            
   OBJECT-COMPUTER.        ACOS.                                            
   SPACE:0                                                                  
   IOS:                                                                     
   FILE-CONTROL.                                                            
       SELECT  BASED  運用管理ファイル                                      
                           ASSIGN TO FUNYKPTR                               
                           ORGANIZATION IS VSAS RELATIVE                    
                           ACCESS MODE  IS DYNAMIC                          
                           RELATIVE  KEY   ＵＮＹＫ相対キー                 
                           FILE STATUS  IS ＳＴＳコード                     
                                           ＳＴＳ詳細.                      
       SELECT  BASED  世代別運用管理ファイル                                
                           ASSIGN TO FSEUKPTR                               
                           ORGANIZATION IS VSAS RELATIVE                    
                           ACCESS MODE  IS DYNAMIC                          
                           RELATIVE  KEY   ＳＥＵＫ相対キー                 
                           FILE STATUS  IS ＳＴＳコード                     
                                           ＳＴＳ詳細.                      
       SELECT  BASED  パス別受信管理ファイル                                
                           ASSIGN TO FPSJSPTR                               
                           ORGANIZATION IS VSAS RELATIVE                    
                           ACCESS MODE  IS DYNAMIC                          
                           RELATIVE  KEY   ＰＳＪＳ相対キー                 
                           FILE STATUS  IS ＳＴＳコード                     
                                           ＳＴＳ詳細.                      
       SELECT  BASED  有効表                                                
                           ASSIGN TO DYUKOPTR-RDB                           
                           ORGANIZATION IS INDEXED                          
                           ACCESS MODE  IS DYNAMIC                          
                           RECORD KEY   IS ＹＵＫＯ識別コード               
                           FILE STATUS  IS ＳＴＳコード                     
                                           ＳＴＳ詳細.                      
       SELECT  BASED  ゲーム計数ファイル                                    
                           ASSIGN TO FGMKSPTR                               
                           ORGANIZATION IS VSAS INDEXED                     
                           ACCESS MODE  IS DYNAMIC                          
                           RECORD KEY   IS ＧＭＫＳキー項目                 
                           FILE STATUS  IS ＳＴＳコード                     
                                           ＳＴＳ詳細.                      
       SELECT  BASED  トランザクションＥＲＦ                                
                           ASSIGN TO FTRERPTR                               
                           ORGANIZATION IS VSAS RELATIVE                    
                           ACCESS MODE  IS DYNAMIC                          
                           RELATIVE  KEY   ＴＲＥＲ相対キー                 
                           FILE STATUS  IS ＳＴＳコード                     
                                           ＳＴＳ詳細.                      
       SELECT  BASED  トランザクション出力履歴Ｆ                              
                           ASSIGN TO FTRSRPTR                               
                           ORGANIZATION IS VSAS INDEXED                     
                           ACCESS MODE  IS DYNAMIC                          
                           RECORD  KEY  IS ＴＲＳＲキー項目                 
                           FILE  STATUS IS ＳＴＳコード                     
                                           ＳＴＳ詳細.                      
       SELECT  BASED  ゲームタイプファイル                                  
                           ASSIGN TO FGMTYPTR                               
                           ORGANIZATION IS VSAS INDEXED                     
                           ACCESS MODE  IS DYNAMIC                          
                           RECORD  KEY  IS ＧＭＴＹゲームタイプ             
                           FILE  STATUS IS ＳＴＳコード                     
                                           ＳＴＳ詳細.                      
   DD:                                                                      
   FS:                                                                      
  *                                                                         
   FD  運用管理ファイル                                                     
       LABEL RECORD STANDARD.                                               
   01  運用管理Ｒ１.                                                        
       COPY:CFUNK1                                                          
  * 運用管理Ｆのレコード長をあわせるため、運用管理Ｆの第２レコード          
  * （最大レコード長）のコピー句を定義                                      
   01  運用管理Ｒ２.                                                        
       COPY:CFUNK2                                                          
  *                                                                         
   FD  世代別運用管理ファイル                                               
       LABEL RECORD STANDARD.                                               
   01  世代別運用管理Ｒ.                                                    
       COPY:CFSUK1                                                          
  *                                                                         
   FD  パス別受信管理ファイル                                               
       LABEL RECORD STANDARD.                                               
   01  パス別受信管理Ｒ.                                                    
       COPY:CFPSJS                                                          
  *                                                                         
   FD  有効表                                                               
       LABEL  RECORD  STANDARD.                                             
   01  有効Ｒ.                                                              
       COPY:CFYUKO                                                          
  *                                                                         
   FD  ゲーム計数ファイル                                                   
       LABEL  RECORD  STANDARD.                                             
   01  ゲーム計数Ｒ.                                                        
       COPY:CFGMKS                                                          
  *                                                                         
   FD  トランザクションＥＲＦ                                               
       LABEL  RECORD  STANDARD.                                             
   01  ＴＲＥＲ管理Ｒ.                                                      
     03  ＴＲＥＲカレント相対キー                                           
                                 COMP-2.                                    
     03  ＴＲＥＲ予備１          PIC  X(2044).                              
   01  ＴＲＥＲ明細Ｒ１.                                                    
     03  ＴＲＥＲデータ種別      PIC  X(01).                                
     03  ＴＲＥＲ処理状態        PIC  X(02).                                
     03  ＴＲＥＲ送受信端末名    PIC  X(06).                                
     03  ＴＲＥＲセンター状態    PIC  X(01).                                
     03  ＴＲＥＲ電文            PIC  X(1456).                              
     03   FILLER                 PIC  X(582).                               
  *                                                                         
   FD  トランザクション出力履歴Ｆ                                           
       LABEL RECORD STANDARD.                                               
   01  トランザクション出力履歴Ｒ.                                          
   COPY: CFTRSR                                                             
  *                                                                         
   FD  ゲームタイプファイル                                                 
       LABEL RECORD STANDARD.                                               
   01  ゲームタイプＲ.                                                      
   COPY: CFGMTY                                                             
  *                                                                         
   NOTE:                                                                    
     データ部（コンスタント）                                               
   NEND:                                                                    
   CNS:                                                                     
   01  リターンコード.                                                      
     03  正常終了          COMP-1   VALUE  000.                             
     03  重送              COMP-1   VALUE  214.                             
     03  欠送              COMP-1   VALUE  215.                             
  *                                                                         
   01  レコードＩＤ.                                                        
     03   発券ＩＤ         PIC 9(01)   VALUE  1.                            
     03   発券取消ＩＤ     PIC 9(01)   VALUE  2.                            
     03   支払ＩＤ         PIC 9(01)   VALUE  4.                            
     03   支払取消ＩＤ     PIC 9(01)   VALUE  5.                            
     03   期限後支払ＩＤ   PIC 9(01)   VALUE  6.                            
     03   代替券ＩＤ       PIC 9(01)   VALUE  7.                            
     03   障害取消ＩＤ     PIC 9(01)   VALUE  8.                            
  *                                                                         
   01  電文種別.                                                            
     03  発券要求                    PIC  X(04) VALUE  "T100".              
     03  発券取消要求                PIC  X(04) VALUE  "T120".              
     03  支払要求                    PIC  X(04) VALUE  "T210".              
     03  代替券発行要求              PIC  X(04) VALUE  "T220".              
     03  支払取消要求                PIC  X(04) VALUE  "T240".              
     03  発券障害取消要求            PIC  X(04) VALUE  "T900".              
  *                                                                         
     03  トランザクション転送要求    PIC  X(04) VALUE  "F100".              
     03  ヘルスチェック              PIC  X(04) VALUE  "F190".              
     03  コネクション情報通知        PIC  X(04) VALUE  "F840".              
     03  発券端末サーバ障害取消要求  PIC  X(04) VALUE  "F900".              
  *                                                                         
     03  トランザクション転送応答Ｊ  PIC  X(04) VALUE ""46313031"".         
     03  コネクション情報通知受付Ｊ  PIC  X(04) VALUE ""46383431"".         
   ; ＳＪＩＳコード                                                         
  *                                                                         
   01 ページ属性.                                                           
     03  通常電文           PIC  X(01) VALUE  ""30"".                       
     03  最終電文           PIC  X(01) VALUE  ""31"".                       
   ; ＳＪＩＳコード                                                         
  *                                                                         
   01  識別コード区分.                                                      
     03  １６桁             PIC  X(01) VALUE  "0".                          
     03  ２４桁             PIC  X(01) VALUE  "1".                          
  *                                                                         
   01 処理区分.                                                             
     03  通常               PIC  X(01) VALUE  "0".                          
     03  再処理             PIC  X(01) VALUE  "1".                          
  *                                                                         
   01 世代.                                                                 
     03  世代Ａ             PIC  9(01) VALUE   1.                           
     03  世代Ｂ             PIC  9(01) VALUE   2.                           
  *                                                                         
   01 フラグ.                                                               
     03  ＯＦＦ             PIC  9(01) VALUE   0.                           
     03  ＯＮ               PIC  9(01) VALUE   1.                           
  *                                                                         
   01 販売チャネル状態.                                                     
     03  未受信             PIC  X(01) VALUE  "0".                          
     03  受信済             PIC  X(01) VALUE  "1".                          
     03  該当なし           PIC  X(01) VALUE  "9".                          
  *                                                                         
   01 ゲーム状態.                                                           
     03  発売中             PIC  X(01) VALUE  "0".                          
     03  発売終了           PIC  X(01) VALUE  "1".                          
  *                                                                         
   01 終了チェック状態.                                                     
     03  未終了             PIC  X(01) VALUE  "0".                          
     03  終了済             PIC  X(01) VALUE  "1".                          
  *                                                                         
   01 販売チャネルコード.                                                   
     03  発券端末           PIC  9(02) VALUE   1.                           
  *                                                                         
   01 支払フラグ.                                                           
     03  期限後支払         PIC  X(01) VALUE  "1".                          
  *                                                                         
   01 レコード状態.                                                         
     03  有効               PIC  X(01) VALUE  "0".                          
     03  無効               PIC  X(01) VALUE  "1".                          
  *                                                                         
   01 サーバ状態.                                                           
     03  稼動               PIC  X(01) VALUE  "1".                          
     03  待機               PIC  X(01) VALUE  "2".                          
     03  停止               PIC  X(01) VALUE  "3".                          
  *                                                                         
   01 トランザクションエラー関連.                                           
     03  電文               PIC  X(01) VALUE  "1".                          
     03  未処理             PIC  X(02) VALUE  "00".                         
  *                                                                         
   01 ゲーム種別.                                                           
     03  ナンバーズ         PIC  9(01) VALUE   1.                           
     03  ロト               PIC  9(01) VALUE   2.                           
  *                                                                         
   01 センター番号.                                                         
     03  第１センター       PIC  9(01) VALUE   1.                           
  *                                                                         
   01 くじ券タイプ.                                                         
     03  単独くじ券           PIC  9(01) VALUE   1.                         
     03  継続くじ券           PIC  9(01) VALUE   2.                         
  *                                                                         
   01 パネル分割.                                                           
     03  １−５パネル編集時   PIC  9(01) VALUE   1.                         
     03  ６−７パネル編集時   PIC  9(01) VALUE   2.                         
  *                                                                         
   01 障害取消方式区分.                                                     
     03  電文通番取消         PIC  X(01) VALUE  "1".                        
     03  識別コード取消       PIC  X(01) VALUE  "2".                        
  *                                                                         
   01 ナンバーズ等級.                                                       
     03  ストレート PIC 1(16) USAGE IS BIT                                  
                                    VALUE B"1000000000000000".              
     03  ボックス   PIC 1(16) USAGE IS BIT                                  
                                    VALUE B"0100000000000000".              
     03  Ｓ／Ｂストレート PIC 1(16) USAGE IS BIT                            
                                    VALUE B"0010000000000000".              
     03  Ｓ／Ｂボックス PIC 1(16) USAGE IS BIT                              
                                    VALUE B"0001000000000000".              
     03  Ｆペア     PIC 1(16) USAGE IS BIT                                  
                                    VALUE B"0000100000000000".              
     03  Ｂペア     PIC 1(16) USAGE IS BIT                                  
                                    VALUE B"0000010000000000".              
     03  チャンス／ピタリ PIC 1(16) USAGE IS BIT                            
                                    VALUE B"0000001000000000".              
     03  チャンス／一字違 PIC 1(16) USAGE IS BIT                            
                                    VALUE B"0000000100000000".              
  *                                                                         
   01  ロト等級.                                                            
     03  １等  PIC 1(16) USAGE IS BIT VALUE B"1000000000000000".            
     03  ２等  PIC 1(16) USAGE IS BIT VALUE B"0100000000000000".            
     03  ３等  PIC 1(16) USAGE IS BIT VALUE B"0010000000000000".            
     03  ４等  PIC 1(16) USAGE IS BIT VALUE B"0001000000000000".            
     03  ５等  PIC 1(16) USAGE IS BIT VALUE B"0000100000000000".            
     03  ６等  PIC 1(16) USAGE IS BIT VALUE B"0000010000000000".            
     03  ７等  PIC 1(16) USAGE IS BIT VALUE B"0000001000000000".            
     03  ８等  PIC 1(16) USAGE IS BIT VALUE B"0000000100000000".            
     03  ９等  PIC 1(16) USAGE IS BIT VALUE B"0000000010000000".            
  *                                                                         
   01  初期化.                                                              
     03  ＴＲＮＳ初期化.                                                    
       05  ＴＲレコード共通.                                                
         07  レコードＩＤ        PIC 9(1)        VALUE  0.                  
         07  識別コード.                                                    
           09  識別コード上      USAGE COMP-2    VALUE  0.                  
           09  識別コード中      USAGE COMP-2    VALUE  0.                  
           09  識別コード下      USAGE COMP-2    VALUE  0.                  
         07  取引日付            USAGE COMP-2    VALUE  0.                  
         07  取引時刻            USAGE COMP-2    VALUE  0.                  
         07  受付日付            USAGE COMP-2    VALUE  0.                  
         07  受付時刻            USAGE COMP-2    VALUE  0.                  
         07  売場コード          PIC X(6)        VALUE  "      ".           
         07  販売員ＩＤ          PIC X(1)        VALUE  " ".                
         07  機種区分            PIC X(2)        VALUE  "  ".               
         07  販売チャネルコード  PIC 9(2)        VALUE  0.                  
         07  ロール番号          PIC 9(7) USAGE COMP-3  VALUE  0.           
         07  連番                PIC 9(4) USAGE COMP-3  VALUE  0.           
         07  連番チェックＤ      PIC 9(1)        VALUE  0.                  
         07  補正ロール番号      PIC 9(7) USAGE COMP-3  VALUE  0.           
         07  補正連番            PIC 9(4) USAGE COMP-3  VALUE  0.           
         07  補正連番チェックＤ  PIC 9(1)        VALUE  0.                  
         07  電文通番            USAGE COMP-2    VALUE  0.                  
         07  出力番号            USAGE COMP-1    VALUE  0.                  
         07  出力枚数            USAGE COMP-1    VALUE  0.                  
         07  金額                PIC 9(13) USAGE COMP-3  VALUE  0.          
         07  入力方式１          PIC X(1)        VALUE  " ".                
         07  入力方式２          PIC X(1)        VALUE  " ".                
  * セキュリティコードは、LOW-VALUE で初期化                                
         07  セキュリティコード  PIC X(20)       VALUE  LOW-VALUE.          
       05  発券共通.                                                        
         07  ゲームＩＤ.                                                    
           09  ゲームタイプ      PIC 9(2)        VALUE  0.                  
           09  ブロックコード    USAGE COMP-1    VALUE  0.                  
           09  開始回号          USAGE COMP-1    VALUE  0.                  
         07  当初継続回号数      PIC 9(1)        VALUE  0.                  
         07  実質継続回号数      PIC 9(1)        VALUE  0.                  
         07  パネル数            PIC 9(1)        VALUE  0.                  
         07  口数                USAGE COMP-1    VALUE  0.                  
         07  ゲーム種別          PIC 9(1)        VALUE  0.                  
         07  分子                PIC 9(2)        VALUE  0.                  
         07  分母                PIC 9(2)        VALUE  0.                  
       05  関連識別ＣＤＬ情報.                                              
         07  発券識別コード.                                                
           09  発券識別コード上  USAGE COMP-2    VALUE  0.                  
           09  発券識別コード中  USAGE COMP-2    VALUE  0.                  
           09  発券識別コード下  USAGE COMP-2    VALUE  0.                  
         07  取消識別コード.                                                
           09  取消識別コード上  USAGE COMP-2    VALUE  0.                  
           09  取消識別コード中  USAGE COMP-2    VALUE  0.                  
           09  取消識別コード下  USAGE COMP-2    VALUE  0.                  
         07  支払識別コード.                                                
           09  支払識別コード上  USAGE COMP-2    VALUE  0.                  
           09  支払識別コード中  USAGE COMP-2    VALUE  0.                  
           09  支払識別コード下  USAGE COMP-2    VALUE  0.                  
         07  代替識別コード.                                                
           09  代替識別コード上  USAGE COMP-2    VALUE  0.                  
           09  代替識別コード中  USAGE COMP-2    VALUE  0.                  
           09  代替識別コード下  USAGE COMP-2    VALUE  0.                  
         07  取消区分            PIC 9(1)        VALUE  0.                  
         07  取消解除カウンタ    PIC 9(1)        VALUE  0.                  
         07  支払取消カウンタ    PIC 9(1)        VALUE  0.                  
         07  特殊取引アドレス    USAGE COMP-2    VALUE  0.                  
         07  特殊取引世代区分    PIC 9(1)        VALUE  0.                  
       05  取消支払情報.                                                    
         07  取消支払売場コード  PIC X(6)        VALUE  "      ".           
         07  取消支払販売員ＩＤ  PIC X(1)        VALUE  " ".                
         07  取消支払取引日付    USAGE COMP-2    VALUE  0.                  
         07  取消支払取引時刻    USAGE COMP-2    VALUE  0.                  
         07  取消支払受付日付    USAGE COMP-2    VALUE  0.                  
         07  取消支払受付時刻    USAGE COMP-2    VALUE  0.                  
         07  取消支払ＦＥＰ番号  PIC 9(2)        VALUE  0.                  
         07  取消支払パス通番    PIC 9(1)        VALUE  0.                  
         07  取消支払Ｃ状態      PIC X(1)        VALUE  " ".                
         07  支払金額            PIC 9(13) USAGE COMP-3  VALUE  0.          
         07  持込認定日          USAGE COMP-2    VALUE  0.                  
         07  回収日              USAGE COMP-2    VALUE  0.                  
       05  申込情報.                                                        
         07  申込明細                                                       
               OCCURS 5 TIMES.                                              
           09  申込数字          PIC 9(15) USAGE COMP-3  VALUE  0.          
           09  クイックピック区分  PIC 9(1)      VALUE  0.                  
           09  申込タイプ          PIC 9(1)      VALUE  0.                  
  * 当せん情報の各判定区分、フラグは、ZERO で初期化                         
       05  当せん情報.                                                      
         07  当せん明細                                                     
               OCCURS 5 TIMES.                                              
           09  当せん等級          PIC 9(2)      VALUE  0.                  
           09  当せん判定区分      PIC X(1)      VALUE  "0".                
           09  支払フラグ          PIC X(1)      VALUE  "0".                
       05  コンビ当せん情報.                                                
         07  コンビ最下位当等級    PIC 9(2)      VALUE  0.                  
         07  コンビ当せん明細                                               
               OCCURS 11 TIMES.                                             
           09  コンビ当せん口数    USAGE COMP-1  VALUE  0.                  
           09  コンビ当判定区分    PIC X(1)      VALUE  "0".                
         07  コンビ支払フラグ      PIC X(1)      VALUE  "0".                
       05  代替券発行情報.                                                  
         07  未抽せん回号数        PIC 9(1)      VALUE  0.                  
         07  特殊代替通算日        USAGE COMP-1  VALUE  0.                  
         07  特殊代替発行時刻      USAGE COMP-2  VALUE  0.                  
       05  レコード状態            PIC X(1)      VALUE  " ".                
       05  センター状態            PIC X(1)      VALUE  " ".                
  * 当せんチェック、事故券登録フラグは、ZERO で初期化                       
       05  当チェックフラグ        PIC X(1)      VALUE  "0".                
       05  事故券登録フラグ        PIC X(1)      VALUE  "0".                
       05  識別コード体系情報.                                              
         07  識別コード区分        PIC X(1)      VALUE  " ".                
         07  旧識別コード.                                                  
           09  旧識別コード上      USAGE COMP-2  VALUE  0.                  
           09  旧識別コード下      USAGE COMP-2  VALUE  0.                  
       05  障害取消通番            USAGE COMP-2  VALUE  0.                  
       05  直前取引情報.                                                    
         07  直前取引ＦＥＰ番号    PIC 9(2)      VALUE  0.                  
         07  直前取引Ｒ番号        PIC X(4)      VALUE  "    ".             
       05  統計情報.                                                        
         07  購入者通番            USAGE COMP-1  VALUE  0.                  
         07  取引通番              USAGE COMP-1  VALUE  0.                  
         07  申込カード種別        USAGE COMP-1  VALUE  0.                  
       05  分割識別コード.                                                  
         07  分割識別コード上      USAGE COMP-2  VALUE  0.                  
         07  分割識別コード中      USAGE COMP-2  VALUE  0.                  
         07  分割識別コード下      USAGE COMP-2  VALUE  0.                  
       05  予備                    PIC X(07)     VALUE  "       ".          
  *                                                                         
   SPACE:0                                                                  
   NOTE:                                                                    
     データ部（作業場所節）                                                 
   NEND:                                                                    
   AS:                                                                      
   01    ワークエリア.                                                      
  *** POINTER ***                                                           
     03  DYUKOPTR                       USAGE POINTER.                      
     03  FGMKSPTR                       USAGE POINTER.                      
     03  FTRERPTR                       USAGE POINTER.                      
     03  YUKOPTR                        USAGE POINTER.                      
  *** リターンコード ***                                                    
     03  ＳＴＳコード                   PIC  X(02).                         
     03  ＳＴＳ詳細                     PIC  9(05).                         
     03  ＷＫ−ＲＴＮＣＤ               PIC  X(02).                         
  *** 相対キー ***                                                          
     03  ＵＮＹＫ相対キー               PIC  9(02).                         
     03  ＳＥＵＫ相対キー               PIC  9(02).                         
     03  ＰＳＪＳ相対キー               PIC  9(02).                         
     03  ＴＲＥＲ相対キー               PIC  9(05).                         
  *** 添字 ***                                                              
     03  IDX-GMTY                       COMP-1.                             
     03  IDX-GMKS                       COMP-1.                             
     03  IDX-SEDAI                      PIC 9(01).                          
     03  IDX-KAIGOU                     COMP-1.                             
     03  IDX-CODE                       COMP-1.                             
  *** カウンタ ***                                                          
     03  CNT                            USAGE  COMP-1.                      
     03  CNT-FEP                        PIC 9(02).                          
     03  CNT-CHANNEL                    PIC 9(02).                          
     03  CNT-PANEL                      PIC 9(02).                          
     03  ＣＮＴ−回号                   COMP-1.                             
     03  ＣＮＴ−当初継続回号数         PIC 9(01).                          
     03  ＣＮＴ−識別                   COMP-1.                             
  *** フラグ ***                                                            
     03  ＦＬＧパネル分割            PIC 9(01).                             
     03  ＦＬＧロトコンビ            PIC 9(01).                             
     03  ＦＬＧくじ券タイプ          PIC 9(01).                             
     03  ＦＬＧ一致                  PIC 9(01).                             
     03  ＦＬＧ終了                  PIC X(01).                             
     03  電文有無フラグ.                                                    
       05  世代別１                   OCCURS  2.                            
         07  ＦＬＧ世代別電文有無            PIC 9(01).                     
       05  ＦＥＰ別１                 OCCURS  20.                           
         07  ＦＬＧＦＥＰ別電文有無          PIC 9(01).                     
       05  世代別２                   OCCURS  2.                            
         07  ＦＥＰ別２                 OCCURS  20.                         
           09  販売チャネルコード別       OCCURS  10.                       
             11  ＦＬＧ世別Ｆ別Ｃ別電文有無  PIC 9(01).                     
     03  ＦＬＧプールＣＨＫ          PIC 9(01).                             
     03  ＦＬＧプール更新            PIC 9(01).                             
  *** 識別コード編集 ***                                                    
     03  ＷＫ−識別コード.                                                  
       05  ＷＫ−識別コード上           PIC  9(08).                         
       05  ＷＫ−識別コード中           PIC  9(08).                         
       05  ＷＫ−識別コード下           PIC  9(08).                         
     03  ＷＫ−識別コードＲ           REDEFINES  ＷＫ−識別コード.          
       05  ＷＫ−識別ゲームタイプ       PIC  9(02).                         
       05  ＷＫ−識別ブロックタイプ     PIC  9(03).                         
       05  ＷＫ−ＦＩＬＬＥＲ           PIC  9(03).                         
       05  ＷＫ−識別西暦下１桁         PIC  9(01).                         
       05  ＷＫ−識別通算日             PIC  9(03).                         
       05  ＷＫ−識別チェックコード     PIC  9(01).                         
       05  ＷＫ−識別チェックデジット   PIC  9(01).                         
       05  ＷＫ−識別ＦＥＰ番号         PIC  9(02).                         
       05  ＷＫ−識別ＦＥＰ内一連番号   PIC  9(08).                         
  *** コンソールメッセージ置換テキスト ***                                  
     03  ＷＫ−ゲーム計数キー.                                              
       05  ＷＫ−計数ゲームタイプ       PIC  9(02).                         
       05  ＷＫ−計数ブロックコード     PIC  9(04).                         
       05  ＷＫ−出力用ブロックコード   PIC  9(03).                         
       05  ＷＫ−出力用販売チャネル     PIC  9(02).                         
       05  ＷＫ−出力用電文日付         PIC  9(08).                         
       05  ＷＫ−出力用電文通番         PIC  9(10).                         
  *** 識別コード変換用 ***                                                  
     03  ＦＬＧ識別変換ＰＴＲセット     PIC  9(01).                         
     03  ＷＫ−変換前識別コード.                                              
       05  ＷＫ−変換前識別コード上     USAGE  COMP-2.                      
       05  ＷＫ−変換前識別コード中     USAGE  COMP-2.                      
       05  ＷＫ−変換前識別コード下     USAGE  COMP-2.                      
     03  ＷＫ−変換後識別コード.                                              
       05  ＷＫ−変換後識別コード上     USAGE  COMP-2.                      
       05  ＷＫ−変換後識別コード中     USAGE  COMP-2.                      
       05  ＷＫ−変換後識別コード下     USAGE  COMP-2.                      
     03  ＷＫ−１６桁識別コード.                                              
       05  ＷＫ−１６桁識別コード上     PIC  9(08).                         
       05  ＷＫ−１６桁識別コード下     PIC  9(08).                         
     03  ＷＫ−２４桁識別コード.                                              
       05  ＷＫ−２４桁識別コード上     PIC  9(08).                         
       05  ＷＫ−２４桁識別コード中     PIC  9(08).                         
       05  ＷＫ−２４桁識別コード下     PIC  9(08).                         
     03  PTR_SBCDBEFORE                 USAGE POINTER.                      
     03  PTR_SBCDAFTER                  USAGE POINTER.                      
  *** コード変換用、送受信端末名編集 ***                                    
     03  ＷＫ−コード変換前項目.                                            
       05  ＷＫ−変換前送受信端末名     PIC  X(06).                         
       05  ＷＫ−変換前センター状態     PIC  X(01).                         
       05  ＷＫ−変換前電文種別         PIC  X(04).                         
     03  ＷＫ−コード変換後項目.                                            
       05  ＷＫ−送受信端末名.                                              
           07  ＷＫ−端末名１           PIC  X(05).                         
           07  ＷＫ−端末名２           PIC  X(01).                         
       05  ＷＫ−送受信端末名Ｒ  REDEFINES  ＷＫ−送受信端末名.             
           07  ＷＫ−サブシステム識別   PIC  X(01).                         
           07  ＷＫ−ＦＥＰ番号         PIC  9(02).                         
           07  ＷＫ−パス種別           PIC  X(01).                         
           07  ＷＫ−パス番号           PIC  9(02).                         
       05  ＷＫ−センター状態           PIC  X(01).                         
       05  ＷＫ−電文種別               PIC  X(04).                         
     03  ＷＫ−送受信端末名２.                                              
       05  ＷＫ−サブシステム識別２     PIC  X(01).                         
       05  ＷＫ−ＦＥＰ番号２           PIC  9(02).                         
       05  ＷＫ−パス種別２             PIC  X(01).                         
       05  ＷＫ−パス番号２             PIC  9(02).                         
  *** 出力電文編集 ***                                                      
     03  ＷＫ−出力電文項目.                                                
       05  ＷＫ−業務リターンコード     COMP-1.                             
       05  ＷＫ−欠送電文日付           COMP-2.                             
       05  ＷＫ−欠送電文通番           COMP-2.                             
  *** 連番編集 ***                                                          
     03  ＷＫ−連番ＣＤ分解           PIC  9(05).                           
     03  ＷＫ−連番ＣＤ分解Ｒ REDEFINES ＷＫ−連番ＣＤ分解.                 
       05  ＷＫ−チケット連番         PIC  9(04).                           
       05  ＷＫ−ＣＤ                 PIC  9(01).                           
  *** 等級編集 ***                                                          
     03  ＷＫ−等級Ｘ                PIC X(02).                             
     03  ＷＫ−等級Ｒ         REDEFINES  ＷＫ−等級Ｘ.                      
       05  ＷＫ−等級ＢＩＴ          PIC 1(16) USAGE BIT.                   
     03  ＷＫ−等級９                PIC 9(02).                             
  *** ゲームタイプ、ゲーム計数一括更新テーブル用 ***                        
     03  ＷＫ−日付                  COMP-2.                                
     03  ＷＫ−ゲームタイプ          PIC 9(02).                             
     03  ＷＫ−ブロックコード        COMP-1.                                
  *** 世代区分判定用 ***                                                    
     03  ＷＫ−世代区分              PIC 9(01).                             
     03  ＷＫ−世代判定業務日付      COMP-2.                                
  *** VMUCA分解用 ***                                                       
     03  WK-TERM.                                                           
       05  WK-TERMHDR      PIC  X(02).  ; 送信元の判定に使用                
       05  WK-TERMDAT      PIC  X(04).                                      
  *** 連番チェックディジット                                                
     03  ＷＫ−ＣＫＤ計算Ｘ.                                                
       05  ＷＫ−ＣＫＤロール番号    PIC 9(07).                             
       05  ＷＫ−ＣＫＤ連番          PIC 9(04).                             
     03  ＷＫ−ＣＫＤ計算９          REDEFINES ＷＫ−ＣＫＤ計算Ｘ           
                                     PIC 9(11).                             
     03  ＷＫ−ＣＫＤ                PIC 9(01).                             
     03  ＷＫ−商                    PIC 9(11).                             
  *** その他 ***                                                            
     03  ＷＫ−ブロック              PIC 9(02).                             
     03  ＷＫ−バイト数              PIC 9(04).                             
     03  ＷＫ−金額９                PIC 9(14).                             
     03  ＷＫ−サーバ状態            PIC X(01).                             
     03  ＷＫ−レコード状態          PIC X(01).                             
     03  ＷＫ−処理区分              PIC X(01).                             
     03  ＷＫ−退避ゲームタイプ      PIC 9(02).                             
     03  ＷＫ−退避ブロックコード    COMP-1.                                
     03  ＷＫ−退避開始回号          COMP-1.                                
     03  ＷＫ−回号                  PIC  9(04).                            
     03  ＷＫ−格納位置              PIC  9(01).                            
     03  ＷＫ−相対番号              COMP-2.                                
     03  ＷＫ−申込通り数            COMP-2.                                
     03  ＷＫ−ＴＲＮＳ件数          COMP-1.                                
     03  ＷＫ−発券電文ＣＮＴ        COMP-1.                                
     03  ＷＫ−発券以外電文ＣＮＴ    COMP-1.                                
     03  ＷＫ−発券レコード件数      COMP-1.                                
     03  ＷＫ−ＧＫレコード件数      COMP-1.                                
     03  ＷＫ−添字                  COMP-1.                                
     03  ＷＫ−パス別電文日付        COMP-2.                                
     03  ＷＫ−パス別電文通番        COMP-2.                                
     03  WK-I                        COMP-1.                                
     03  ＷＫ−履歴ゲームタイプ      PIC 9(02).                             
     03  ＷＫ−履歴ブロックコード    COMP-1.                                
     03 ＷＫ−ブロックコードＸ       PIC X(02).                             
     03 ＷＫ−ブロックコードＲ   REDEFINES  ＷＫ−ブロックコードＸ.         
       05 ＷＫ−ブロックコード９     USAGE COMP-1.                          
  *                                                                         
   NOTE:                                                                    
     パラメータ                                                             
   NEND:                                                                    
  *                                                                         
  * 発券申込パラメータ                                                      
  *                                                                         
   01  発券申込ＰＲＭ.                                                      
     03  ＰＲＭ１世代区分          PIC  9(01).                              
     03  ＰＲＭ１ＧＡＭＥＰＴＲ    POINTER.                                 
     03  ＰＲＭ１処理区分          PIC  X(01).                              
  *                                                                         
  * 障害取消パラメータ                                                      
  *                                                                         
   01  障害取消ＰＲＭ.                                                      
     03  ＰＲＭ２世代区分          PIC  9(01).                              
     03  ＰＲＭ２同期区分          PIC  X(01).                              
     03  ＰＲＭ２終了チェック状態  PIC  X(01).                              
     03  ＰＲＭ２処理日付          COMP-2.                                  
     03  ＰＲＭ２処理通番          COMP-2.                                  
     03  ＰＲＭ２障害取消要求電文  PIC  X(580).                             
                             ; 共通ヘッダ長+発券障害取消要求電文長          
  *                                                                         
  * 発券取消、当せん金支払、代替券発行、支払取消パラメータ                  
  *                                                                         
   01  発券以外ＰＲＭ.                                                      
     03  ＰＲＭ３トランザクションＲ.                                        
     COPY:CFTRNS    (//ＴＲＮＳ// BY //ＰＲＭ３//)                          
     03  ＰＲＭ３世代区分        PIC  9(01).                                
     03  ＰＲＭ３処理区分        PIC  X(01).                                
     03  ＰＲＭ３サーバ状態      PIC  X(01).                                
  *                                                                         
  * 遅延型電文チェック／コード変換パラメータ                                
  *                                                                         
   01  遅延型電文チェックＰＲＭ.                                            
     02  ＣＤＣＫ世代区分          PIC 9(1).                                
     02  ＣＤＣＫ業務日付情報      OCCURS 2 TIMES.                          
       03  ＣＤＣＫ業務日付        PIC 9(08).                               
     02  ＣＤＣＫＧＡＭＥ１ＰＴＲ  POINTER.                                 
     02  ＣＤＣＫＧＡＭＥ２ＰＴＲ  POINTER.                                 
     02  ＣＤＣＫ送受信端末名      PIC X(06).                               
     02  ＣＤＣＫセンター状態      PIC X(01).                               
     02  ＣＤＣＫ入力電文          PIC X(1456).                             
     02  ＣＤＣＫ変換後入力電文.                                            
       COPY:CRT001             (//Ｔ００１// BY //ＣＤＣＫ//)               
      03  ＣＤＣＫ個別データ       PIC X(1394).                             
     02  ＣＤＣＫＲＴＮＣＤ        PIC X(02).                               
  *                                                                         
  * トランザクション出力パラメータ                                          
  *                                                                         
   01  トランザクション出力ＰＲＭ.                                          
       COPY:CLTRBC                                                          
     03  ＴＲＢＣトランザクションＴ  OCCURS  480.                           
      04 ＴＲＢＣトランザクションＲ.                                        
       COPY:CFTRNS           (//ＴＲＮＳ// BY //ＴＰＲＭ//)                 
  *                                                                         
  * プール計数一括更新パラメータ                                            
  *                                                                         
   01  プール計数一括更新ＰＲＭ.                                            
       COPY:CLPLBC                                                          
  *                                                                         
   NOTE:                                                                    
     トランザクションファイル                                               
   NEND:                                                                    
   01  トランザクションファイル.                                            
     03  トランザクションＲ.                                                
       COPY: CFTRNS                                                         
  *                                                                         
   NOTE:                                                                    
     退避エリア                                                             
   NEND:                                                                    
  *                                                                         
   01  退避用ゲーム計数ファイル.                                            
    02  退避ＧＫゲーム計数Ｒ.                                               
        COPY:CFGMKS             (//ＧＭＫＳ// BY //退避ＧＫ//)              
  *                                                                         
   01  共通ヘッダ退避.                                                      
       COPY:CRT001              (//Ｔ００１// BY //退避ＫＨ//)              
                                                                            
  *                                                                         
   NOTE:                                                                    
   発券端末入力電文ＴＢＬ                                                   
   NEND:                                                                    
  *                                                                         
   01  発券電文ＴＢＬ.                                                      
    02  ＷＫ−発券電文ＴＢＬ   OCCURS   127.                                
       COPY:CRT001             (//Ｔ００１// BY //ＷＫ１//)                 
     03  ＷＫ１個別データ          PIC X(1394).                             
  * ＷＫ１個別データのバイト数 = 発券要求電文のバイト数                     
  *  (T100:34 + T101:72 + T103:804 + T104:484)                              
  *                                                                         
  ** 発券要求 **                                                            
     03  発券要求電文         REDEFINES  ＷＫ１個別データ.                  
         COPY:CRT100                                                        
      04  パネル情報.                                                       
          COPY:CRT105                                                       
      04  ハッシュ値情報.                                                   
          COPY:CRT103                                                       
      04  識別コード情報.                                                   
          COPY:CRT104                                                       
  ** 発券障害取消要求 **                                                    
     03  発券障害取消要求電文    REDEFINES  ＷＫ１個別データ.               
         COPY:CRT900                                                        
         05  FILLER      PIC X(862).                                        
  ** 発券端末サーバ障害取消要求 **                                          
     03  発券端末Ｓ障害取消要求電文  REDEFINES  ＷＫ１個別データ.           
         COPY:CRF900                                                        
         05  FILLER      PIC X(898).                                        
  *                                                                         
     03  ＷＫ１終了チェック状態    PIC X(01).                               
     03  ＷＫ１発券金額            PIC 9(13) USAGE COMP-3.                  
     03  ＷＫ１重複電文登録フラグ  PIC 9(01).                               
  *                                                                         
   01  発券以外電文ＴＢＬ.                                                  
    02  ＷＫ−発券以外電文ＴＢＬ   OCCURS   127.                            
       COPY:CRT001             (//Ｔ００１// BY //ＷＫ２//)                 
     03  ＷＫ２個別データ          PIC X(128).                              
  * ＷＫ２個別データのバイト数 = 支払要求電文のバイト数                     
  *  (T210:128Byte)                                                         
  ** 発券取消要求 **                                                        
     03  発券取消要求電文        REDEFINES  ＷＫ２個別データ.               
         COPY:CRT120                                                        
       05  FILLER      PIC X(88).                                           
  ** 支払要求 **                                                            
     03  支払要求電文            REDEFINES  ＷＫ２個別データ.               
           COPY:CRT210                                                      
  ** 代替券発行要求 **                                                      
     03  代替券発行要求電文      REDEFINES  ＷＫ２個別データ.               
         COPY:CRT221                                                        
         05  FILLER      PIC X(46).                                         
  ** 支払取消要求 **                                                        
     03  支払取消要求電文        REDEFINES  ＷＫ２個別データ.               
         COPY:CRT240                                                        
         05  FILLER      PIC X(84).                                         
  *                                                                         
   NOTE:                                                                    
     テーブル                                                               
   NEND:                                                                    
  *                                                                         
   01  世代別運用管理テーブル.                                              
    02  Ｔ−ＳＵ世代別運用管理Ｒ     OCCURS  2.                             
       COPY:CFSUK1            (//ＳＵＫ１// BY //Ｔ−ＳＵ//)                
  *                                                                         
   01  ゲーム計数一括更新ＴＢＬ１.                                          
     02 Ｔ−Ｇ１レコード件数       COMP-1.                                  
     02 Ｔ−Ｇ１ゲーム計数Ｒ       OCCURS  30.                              
       COPY:CFGMKS             (//ＧＭＫＳ// BY //Ｔ−Ｇ１//)               
  *                                                                         
   01  ゲーム計数一括更新ＴＢＬ２.                                          
     02 Ｔ−Ｇ２レコード件数       COMP-1.                                  
     02 Ｔ−Ｇ２ゲーム計数Ｒ       OCCURS  30.                              
       COPY:CFGMKS             (//ＧＭＫＳ// BY //Ｔ−Ｇ２//)               
  *                                                                         
   01  トランザクションテーブル.                                            
     03  Ｔ−ＴＲレコード件数        COMP-2.                                
     03  Ｔ−ＴＲトランザクションＲ  OCCURS  480.                           
         COPY:CFTRNS           (//ＴＲＮＳ// BY //Ｔ−ＴＲ//)               
     03  発券電文ＴＢＬＣＮＴ        OCCURS  480.                           
       05  Ｔ−ＴＲ発券電文ＴＣＮＴ    COMP-1.                              
  *                                                                         
   SPACE:0                                                                  
   NOTE:                                                                    
     データ部（ベースデータ節）                                             
   NEND:                                                                    
   BS:                                                                      
   NOTE:                                                                    
     入力電文  (ＴＷＡ 電文受信領域）                                       
   NEND:                                                                    
  *                                                                         
   01  入力電文                BASED  ON  受信電文ＰＴＲ.                   
       COPY:CRT000                                                          
       COPY:CRT001                                                          
       03  ＲＴＴＲＮＳ転送要求.                                            
         05  ＲＴトランザクション件数    COMP-1.                            
         05  ＲＴページ番号              COMP-1.                            
         05  ＲＴページ属性              PIC X(01).                         
         05  ＲＴ予備                    PIC X(55).                         
       03  FILLER                        PIC X(1328).                       
  *                                                                         
   01  発券端末入力電文            REDEFINES  入力電文.                     
       COPY:CRT001             (//Ｔ００１// BY //ＲＴＸＸ//)               
       03  個別データ          PIC X(1408).                                 
  *                                                                         
   SPACE:0                                                                  
   NOTE:                                                                    
     出力電文  (ＴＷＡ 電文送信領域）                                       
   NEND:                                                                    
  *                                                                         
   01  出力電文                  BASED ON   送信電文ＰＴＲ.                 
       COPY:CRT000             (//Ｔ０００// BY //ＳＴ００//)               
       COPY:CRT001             (//Ｔ００１// BY //ＳＴ０１//)               
       03  ＳＴ業務リターンコード      COMP-1.                              
       03  ＳＴＴＲＮＳ転送応答.                                            
         05  ＳＴ予備                    PIC X(02).                         
         05  ＳＴ欠送電文日付            COMP-2.                            
         05  ＳＴ欠送電文通番            COMP-2.                            
         05  ＳＴトランザクション件数    COMP-1.                            
  *                                                                         
   NOTE:                                                                    
     ＶＭＵＣＡ  (ＴＷＡ ＶＭＵＣＡ領域）                                   
   NEND:                                                                    
   01  ＶＭＵＣＡ　              BASED ON  ＶＭＵＣＡＰＴＲ.                
       COPY: CVMUCA                                                         
  *                                                                         
   NOTE:                                                                    
     個別インターフェース  （ＴＷＡ 個別Ｉ／Ｆ領域）                        
   NEND:                                                                    
  *                                                                         
   01  個別インターフェース領域     BASED ON   個別領域ＰＴＲ.              
  *                                                                         
  * ＷＫ−発券電文ＴＢＬ明細格納領域                                        
  *                                                                         
    02  個別ＩＦ発券電文ＴＢＬ       PIC X(1450).                           
  *                                                                         
  * プール計数一括更新テーブル格納領域                                      
  *                                                                         
    02  プール計数一括更新テーブル.                                         
     03  Ｔ−ＰＬ取引件数        COMP-1.                                    
     03  Ｔ−ＰＬ取引明細        OCCURS  127.                               
       05  Ｔ−ＰＬゲームタイプ         PIC 9(2).                           
       05  Ｔ−ＰＬブロックコード       USAGE COMP-1.                       
       05  Ｔ−ＰＬプール計数一括更新.                                      
         07  Ｔ−ＰＬ開始回号           USAGE COMP-1.                       
         07  Ｔ−ＰＬ回号数             PIC 9(2).                           
         07  Ｔ−ＰＬ口数               USAGE COMP-1.                       
         07  Ｔ−ＰＬパネル数           PIC 9(1).                           
         07  Ｔ−ＰＬパネル別情報       OCCURS 7 TIMES.                     
           09  Ｔ−ＰＬ申込数字         PIC 9(15) USAGE COMP-3.             
           09  Ｔ−ＰＬ申込タイプ       PIC 9(1).                           
  *                                                                         
  * ゲームタイプファイルテーブル格納領域                                    
  *                                                                         
    02  Ｔ−ＧＴレコード件数         COMP-1.                                
    02  Ｔ−ＧＴゲームタイプＲ       OCCURS  99.                            
         COPY:CFGMTY            (//ＧＭＴＹ// BY //Ｔ−ＧＴ//)              
  *                                                                         
   NOTE:                                                                    
     メモリテーブル                                                         
   NEND:                                                                    
  *                                                                         
   01  販売チャネル管理テーブル   BASED ON 販売チャネルＰＴＲ.              
       COPY:CTCHAN                                                          
  *                                                                         
   01  パス管理テーブル           BASED ON パス管理ＰＴＲ.                  
       COPY:CTPATH                                                          
  *                                                                         
   SPACE:0                                                                  
   NOTE:                                                                    
     データ部（連絡節）                                                     
   NEND:                                                                    
   LS:                                                                      
       COPY: VISUCA                                                         
   01  VISFPTR.                                                             
       COPY: CLHFP2                                                         
   SPACE:0                                                                  
   PD:(VISUCA , VISFPTR )                                                   
   NOTE:                                                                    
                                                                            
   手続き （レベル０）                                                      
                                                                            
   NEND:                                                                    
   PROC:MAIN-RTN                                                            
      ENTRY:                                                                
        CALL:S000-RTN              ;  初期処理                              
        CALL:P000-RTN              ;  主処理                                
      EXIT:S                                                                
   SPACE:0                                                                  
   NOTE:                                                                    
                                                                            
   手続き （レベル０）                                                      
                                                                            
   NEND:                                                                    
   NOTE:                                                                    
   初期処理                                                                 
   NEND:                                                                    
   PROC:S000-RTN                                                            
       ENTRY:                                                               
  * 再処理回数チェック                                                      
         IF: TRNS-SUBSEQ  = 1                                               
   ; サブトランザクション回数＝１の場合                                     
            ＷＫ−処理区分 := 通常                                          
         ELSE:                                                              
   ; サブトランザクション回数＝２回以上の場合                               
            ＷＫ−処理区分 := 再処理                                        
         END:                                                               
  * ＴＷＡポインタセット                                                    
         @ZCTTWPTR(RECVPTR = 受信電文ＰＴＲ ,                               
                   SENDPTR = 送信電文ＰＴＲ ,                               
                   VMPTR   = ＶＭＵＣＡＰＴＲ ,                             
                   WKPTR   = 個別領域ＰＴＲ );                              
  * メモリポインタセット                                                    
   ; 販売チャネル管理テーブルポインタセット                                 
         @ZCTJWPTR(KBN = 2 ,                                                
                   PTR = 販売チャネルＰＴＲ );                              
   ; パス管理テーブルポインタセット                                         
         @ZCTJWPTR(KBN = 3 ,                                                
                   PTR = パス管理ＰＴＲ );                                  
  * 運用管理ファイル読込                                                    
         ＵＮＹＫ相対キー := 1                                              
         READ  運用管理ファイル  INVALID KEY CONTINUE                       
         IF: ＳＴＳコード NOT = ZERO                                        
           @ZCTABORT( MSGID  = #RT201 ,                                     
                      PROGID = HRCAL010 ,                                   
                      CNT    = 01 ,                                         
                      TEXT1  = "ｳﾝﾖｳｶﾝﾘF" ,                                 
                      TEXT2  = "-" ,                                        
                      TEXT3  = "-" ,                                        
                      TEXT4  = "READ" ,                                     
                      TEXT5  = ＵＮＹＫ相対キー ,                           
                      TEXT6  = ＳＴＳコード ,                               
                      TEXT7  = ＳＴＳ詳細 ) ;                               
         END:                                                               
  * 世代別運用管理ファイル読込                                              
  * 現世代レコード退避                                                      
         ＳＥＵＫ相対キー := ＵＮＫ１世代区分                               
         READ  世代別運用管理ファイル  INVALID KEY CONTINUE                 
         IF: ＳＴＳコード NOT = ZERO                                        
           @ZCTABORT( MSGID  = #RT201 ,                                     
                      PROGID = HRCAL010 ,                                   
                      CNT    = 02 ,                                         
                      TEXT1  = "ｾﾀﾞｲﾍﾞﾂｳﾝﾖｳｶﾝﾘF" ,                          
                      TEXT2  = "-" ,                                        
                      TEXT3  = "-" ,                                        
                      TEXT4  = "READ" ,                                     
                      TEXT5  = ＳＥＵＫ相対キー ,                           
                      TEXT6  = ＳＴＳコード ,                               
                      TEXT7  = ＳＴＳ詳細 ) ;                               
         END:                                                               
         Ｔ−ＳＵ世代別運用管理Ｒ(ＳＥＵＫ相対キー) ,                       
           := 世代別運用管理Ｒ                                              
  * 別世代レコード退避                                                      
         IF: ＵＮＫ１世代区分 = 世代Ａ                                      
            ＳＥＵＫ相対キー := 世代Ｂ                                      
         ELSE:                                                              
            ＳＥＵＫ相対キー := 世代Ａ                                      
         END:                                                               
         IF: ＵＮＫ１翌日情報作成バッチ = "0"                               
  * 翌日情報作成バッチ中でない場合、別世代の世代別運用管理Ｒを退避          
            READ  世代別運用管理ファイル  INVALID KEY CONTINUE              
            IF: ＳＴＳコード NOT = ZERO                                     
              @ZCTABORT( MSGID  = #RT201 ,                                  
                         PROGID = HRCAL010 ,                                
                         CNT    = 03 ,                                      
                         TEXT1  = "ｾﾀﾞｲﾍﾞﾂｳﾝﾖｳｶﾝﾘF" ,                       
                         TEXT2  = "-" ,                                     
                         TEXT3  = "-" ,                                     
                         TEXT4  = "READ" ,                                  
                         TEXT5  = ＳＥＵＫ相対キー ,                        
                         TEXT6  = ＳＴＳコード ,                            
                         TEXT7  = ＳＴＳ詳細 ) ;                            
            END:                                                            
            Ｔ−ＳＵ世代別運用管理Ｒ(ＳＥＵＫ相対キー) ,                    
              := 世代別運用管理Ｒ                                           
         ELSE:                                                              
  * 翌日情報作成バッチの場合、別世代の世代別運用管理Ｒ退避エリアを          
  * 初期化                                                                  
            INITIALIZE  Ｔ−ＳＵ世代別運用管理Ｒ(ＳＥＵＫ相対キー).         
         END:                                                               
  * 電文受信                                                                
         @ZMSVRECV(PTR   = 受信電文ＰＴＲ  ,                                
                   RTNCD = ＷＫ−ＲＴＮＣＤ  );                             
         CASE: ＷＫ−ＲＴＮＣＤ                                             
         OF: ZERO                                                           
            CONTINUE.                                                       
         OF: "90"                                                           
            RETURN:S                                                        
         OTHER:                                                             
            @ZCTABORT( MSGID  = #RT204 ,                                    
                       PROGID = HRCAL010 ,                                  
                       CNT    = 04 ,                                        
                       TEXT1  = ＷＫ−ＲＴＮＣＤ ) ;                        
         END:                                                               
  * サーバ状態退避                                                          
         IF: ＵＮＫ１自センター番号 = 第１センター                          
            ＷＫ−サーバ状態 := ＵＮＫ１第１基幹業務Ｓ状態                  
         ELSE:                                                              
            ＷＫ−サーバ状態 := ＵＮＫ１第２基幹業務Ｓ状態                  
         END:                                                               
  * サーバ状態チェック                                                      
         IF: ＷＫ−サーバ状態 = 停止                                        
            RETURN:S                                                        
         END:                                                               
  * システムヘッダ、共通ヘッダ情報コード変換、退避                          
         ＷＫ−変換前送受信端末名  :=  Ｔ０００送受信端末名                 
         ＷＫ−変換前センター状態  :=  Ｔ０００センター状態                 
         ＷＫ−変換前電文種別      :=  Ｔ００１電文種別                     
         @ZMSCVCD( MODE    = JISEBC ,                                       
                   TYPE    = ANK ,                                          
                   INDATA  = ＷＫ−コード変換前項目 ,                       
                   OUTDATA = ＷＫ−コード変換後項目 ,                       
                   LENG    =  11 ,                                          
                   RTNCD   =  ＷＫ−ＲＴＮＣＤ );                           
         IF: ＷＫ−ＲＴＮＣＤ NOT = ZERO                                    
           @ZCTABORT( MSGID  = #RT224 ,                                     
                      PROGID = HRCAL010 ,                                   
                      CNT    = 05 ,                                         
                      TEXT1  = ＷＫ−ＲＴＮＣＤ ) ;                         
         END:                                                               
  * ＷＫエリア初期化                                                        
         INITIALIZE  電文有無フラグ.                                        
         INITIALIZE  ＷＫ−出力電文項目.                                    
         INITIALIZE  ＷＫ−日付.                                            
         INITIALIZE  ＷＫ−ゲームタイプ.                                    
         INITIALIZE  ＷＫ−ブロックコード.                                  
         INITIALIZE  ＷＫ−業務リターンコード.                              
         INITIALIZE  ＦＬＧ識別変換ＰＴＲセット.                            
         INITIALIZE  Ｔ−ＰＬ取引件数.                                      
         INITIALIZE  Ｔ−ＧＴレコード件数.                                  
         INITIALIZE  ゲーム計数一括更新ＴＢＬ１.                            
         INITIALIZE  ゲーム計数一括更新ＴＢＬ２.                            
  * Ｔ０００送受信端末名内のパス番号はゼロオリジンのため、１加算            
         ＷＫ−パス番号 := ＷＫ−パス番号 + 1                               
  * トランザクションファイル出力処理のパラメータへセットする値を            
  * 退避しておく                                                            
         ＷＫ−パス別電文日付  :=  Ｔ００１受付日付                         
         ＷＫ−パス別電文通番  :=  Ｔ００１電文通番                         
       EXIT:                                                                
   SPACE:0                                                                  
   NOTE:                                                                    
   主処理                                                                   
   NEND:                                                                    
   PROC:P000-RTN                                                            
       ENTRY:                                                               
  * ＷＫ−処理区分が”通常”の場合のみパス別通番チェック処理を実施          
  * ＷＫ−処理区分が”再処理”の場合、既にパス別通番チェック処理は          
  * ”正常”として完了済でありパス別通番管理ファイルは更新済                
  * また、トランザクションエラーＦ復旧時もパス別通番チェック処理は          
  * 行わない                                                                
         WK-TERM  :=  VM-TERM                                               
  * VMUCA の VM-TERM より、遅延型処理の起動元を判定                         
         IF: ＷＫ−処理区分 = 通常  AND ,                                   
             WK-TERMHDR  =  "FD"                                            
            CALL:  P100-RTN     ;  パス別通番チェック処理                   
         END:                                                               
  * ヘルスチェック電文の場合、かつ、欠送以外の場合、処理終了                
         IF: ＷＫ−電文種別 = ヘルスチェック                                
            IF: ＷＫ−業務リターンコード = 正常終了 OR 重送                 
               RETURN:S                                                     
            END:                                                            
         END:                                                               
  *                                                                         
         IF: ＷＫ−電文種別 = トランザクション転送要求  AND ,               
             ＷＫ−業務リターンコード = 正常終了  AND ,                     
             ＲＴトランザクション件数 NOT = ZERO                            
            CALL:  P200-RTN     ;電文入替処理                               
            CALL:  P300-RTN     ;トランザクション編集処理                   
            CASE: ＷＫ−処理区分                                            
            OF: 通常                                                        
               CALL:  P400-RTN    ;有効表出力処理                           
               CALL:  P500-RTN    ;トランザクションファイル出力処理         
               CALL:  PB00-RTN    ;ゲーム計数一括読込処理                   
               CALL:  P600-RTN    ;発券電文個別処理                         
               CALL:  P700-RTN    ;ゲーム計数一括更新処理                   
               CALL:  TRNSEND-RTN ;トランザクションエンド                   
               CALL:  P800-RTN    ;プール計数一括更新処理                   
            OF: 再処理                                                      
               CALL:  PB00-RTN    ;ゲーム計数一括読込処理                   
               CALL:  P600-RTN    ;発券電文個別処理                         
               CALL:  P800-RTN    ;プール計数一括更新処理                   
            END:                                                            
            CALL:  P900-RTN    ;発券以外電文個別処理                        
         END:                                                               
  * 発券端末サーバからの遅延型電文受信時のみ                                
  * （トランザクションエラーＦ復旧時は電文送信は行わない）                  
         IF: WK-TERMHDR  =  "FD"                                            
            CALL:  PA00-RTN     ;  電文送信処理                             
         END:                                                               
       EXIT:                                                                
  *                                                                         
   SPACE:0                                                                  
   NOTE:                                                                    
   手続き （レベル１）                                                      
   NEND:                                                                    
  *                                                                         
   NOTE:                                                                    
   パス別通番チェック処理                                                   
   NEND:                                                                    
   PROC:P100-RTN                                                            
       ENTRY:                                                               
  * パス別受信管理ファイル読込                                              
         ＰＳＪＳ相対キー := ＷＫ−ＦＥＰ番号                               
         READ  パス別受信管理ファイル  INVALID KEY CONTINUE                 
         IF: ＳＴＳコード NOT = ZERO                                        
           @ZCTABORT( MSGID  = #RT201 ,                                     
                      PROGID = HRCAL010 ,                                   
                      CNT    = 06 ,                                         
                      TEXT1  = "ﾊﾟｽﾍﾞﾂｼﾞｭｼﾝｶﾝﾘF" ,                          
                      TEXT2  = "-" ,                                        
                      TEXT3  = "-" ,                                        
                      TEXT4  = "READ" ,                                     
                      TEXT5  = ＰＳＪＳ相対キー ,                           
                      TEXT6  = ＳＴＳコード ,                               
                      TEXT7  = ＳＴＳ詳細 ) ;                               
         END:                                                               
  * 電文種別に応じて、パス別通番チェック処理をＣＡＬＬ                      
         CASE: ＷＫ−電文種別                                               
           OF: トランザクション転送要求                                     
              CALL: P110-RTN ; パス別通番チェック（ＴＸ転送要求）           
           OF: ヘルスチェック                                               
              CALL: P120-RTN ; パス別通番チェック（ヘルスチェック）         
           OF: コネクション情報通知                                         
              ＷＫ−業務リターンコード := 正常終了                          
         END:                                                               
  * 重送、欠送以外の場合のみ、パス別受信管理レコードを更新                  
  * ※コネクション情報通知の場合は、更新しない                              
         IF: ＷＫ−電文種別 = トランザクション転送要求  OR ,                
                              ヘルスチェック                                
            IF: ＷＫ−業務リターンコード = 正常終了                         
               ＰＳＪＳ最新電文受付日付(ＷＫ−パス番号) ,                   
                 := Ｔ００１受付日付                                        
               ＰＳＪＳ最新電文受付時刻(ＷＫ−パス番号) ,                   
                 := Ｔ００１受付時刻                                        
  * パス別受信管理ファイル更新                                              
               REWRITE  パス別受信管理Ｒ  INVALID KEY CONTINUE              
               IF: ＳＴＳコード NOT = ZERO                                  
                 @ZCTABORT( MSGID  = #RT201 ,                               
                            PROGID = HRCAL010 ,                             
                            CNT    = 07 ,                                   
                            TEXT1  = "ﾊﾟｽﾍﾞﾂｼﾞｭｼﾝｶﾝﾘF" ,                    
                            TEXT2  = "-" ,                                  
                            TEXT3  = "-" ,                                  
                            TEXT4  = "REWRITE" ,                            
                            TEXT5  = ＰＳＪＳ相対キー ,                     
                            TEXT6  = ＳＴＳコード ,                         
                            TEXT7  = ＳＴＳ詳細 ) ;                         
               END:                                                         
            END:                                                            
         END:                                                               
       EXIT:                                                                
  *                                                                         
   SPACE:0                                                                  
   NOTE:                                                                    
   電文入替処理                                                             
   NEND:                                                                    
   PROC:P200-RTN                                                            
       ENTRY:                                                               
  * カウンタ初期化                                                          
         ＷＫ−発券電文ＣＮＴ      :=  ZERO                                 
         ＷＫ−発券以外電文ＣＮＴ  :=  ZERO                                 
  * トランザクション件数退避                                                
         ＷＫ−ＴＲＮＳ件数 := ＲＴトランザクション件数                     
  * 遅延型電文チェック／コード変換パラメータセット（共通部)                 
         ＣＤＣＫ世代区分          := ＵＮＫ１世代区分                      
         ＣＤＣＫ業務日付(1)       := Ｔ−ＳＵ業務日付(1)                   
         ＣＤＣＫ業務日付(2)       := Ｔ−ＳＵ業務日付(2)                   
         SET  ＣＤＣＫＧＡＭＥ１ＰＴＲ  TO  ADDRESS  OF  ,                  
                             ゲーム計数一括更新ＴＢＬ１                     
         SET  ＣＤＣＫＧＡＭＥ２ＰＴＲ  TO  ADDRESS  OF  ,                  
                             ゲーム計数一括更新ＴＢＬ２                     
         ＣＤＣＫ送受信端末名  := ＷＫ−変換前送受信端末名                  
         ＣＤＣＫセンター状態  := ＷＫ−変換前センター状態                  
  * 入力電文数 繰り返し処理                                                 
         CNT := 1                                                           
         WHILE: CNT <= ＷＫ−ＴＲＮＳ件数                                   
  * ブロッキング処理                                                        
            IF: CNT       = 1                                               
               SET 受信電文ＰＴＲ  UP BY 128                                
  * システムヘッダ(20byte) + 共通ヘッダ(20byte)                             
  *  + トランザクション件数等(60byte) = 128byte                             
            ELSE:                                                           
               ＷＫ−ブロック := (ＲＴＸＸ電文長 + 127) / 128               
  * 小数点以下切り捨て                                                      
               ＷＫ−バイト数 := ＷＫ−ブロック * 128                       
               SET 受信電文ＰＴＲ UP BY  ＷＫ−バイト数                     
            END:                                                            
  * 遅延型電文チェック／コード変換処理                                      
  * ※トランザクションエラー復旧時で変換後電文に対する再処理時は、          
  *   遅延型電文チェック／コード変換処理は行わない                          
            IF: WK-TERMHDR = "FD" ; 通常                                    
               ＣＤＣＫ入力電文  :=  発券端末入力電文                       
               ECALL: HSAAL230 (VISUCA , VISFPTR ,                          
                                          遅延型電文チェックＰＲＭ)         
            ELSE: ; トランザクションエラー復旧時                            
               IF: ＲＴＸＸ電文種別(1:1) = "T" OR "F"                       
  * 遅延型電文チェック／コード変換にて変換後の電文の場合                    
                  ＣＤＣＫ変換後入力電文 := 発券端末入力電文                
                  ＣＤＣＫＲＴＮＣＤ := ZERO                                
  * ゲームタイプファイル、ゲーム計数ファイル読込処理                        
                  CASE: ＲＴＸＸ電文種別                                    
                    OF: 発券要求                                            
                       CALL: GMTY-READ-RTN                                  
                       CALL: GMKS-READ-RTN                                  
                    OF: 発券取消要求    OR ,                                
                        支払要求        OR ,                                
                        代替券発行要求  OR ,                                
                        支払取消要求    OR ,                                
                        発券障害取消要求                                    
                       CALL: GMTY-READ-RTN                                  
                  END:                                                      
               ELSE:                                                        
  * 遅延型電文チェック／コード変換にて変換前の電文の場合                    
                  ＣＤＣＫ入力電文  :=  発券端末入力電文                    
                  ECALL: HSAAL230 (VISUCA , VISFPTR ,                       
                                          遅延型電文チェックＰＲＭ)         
               END:                                                         
            END:                                                            
  *                                                                         
            CASE: ＣＤＣＫＲＴＮＣＤ                                        
            OF: ZERO                                                        
  * 発券電文、障害取消電文とそれ以外にわけてテーブルに格納                  
   ; 発券要求、障害取消要求電文                                             
               IF: ＣＤＣＫ電文種別 = 発券要求 OR ,                         
                   ＣＤＣＫ電文種別 = 発券障害取消要求 OR ,                 
                   ＣＤＣＫ電文種別 = 発券端末サーバ障害取消要求            
                     CALL: P210-RTN  ;発券電文テーブルソート処理            
               ELSE:                                                        
   ; 発券取消、支払、代替券発行、支払取消要求電文                           
                 ＷＫ−発券以外電文ＣＮＴ ,                                 
                     := ＷＫ−発券以外電文ＣＮＴ +  1                       
                 ＷＫ−発券以外電文ＴＢＬ(ＷＫ−発券以外電文ＣＮＴ),        
                     :=  ＣＤＣＫ変換後入力電文                             
               END:                                                         
            OF: "90"  ; 電文不正                                            
  * ＣＤＣＫＲＴＮＣＤのリターンコードが"90"（電文不正）の場合、            
  * 次電文の処理へ移る                                                      
               CONTINUE.                                                    
            OTHER:                                                          
               @ZCTABORT( MSGID  = #RT220 ,                                 
                          PROGID = HRCAL010 ,                               
                          CNT  = 08 ) ;                                     
            END:                                                            
            CNT := CNT + 1                                                  
         END:                                                               
       EXIT:                                                                
  *                                                                         
   SPACE:0                                                                  
   NOTE:                                                                    
   トランザクション編集処理                                                 
   NEND:                                                                    
   PROC:P300-RTN                                                            
       ENTRY:                                                               
  * ゲームタイプ、ゲーム計数テーブルセット用ＷＫエリアを初期化              
         INITIALIZE  ＷＫ−日付.                                            
         INITIALIZE  ＷＫ−ゲームタイプ.                                    
         INITIALIZE  ＷＫ−ブロックコード.                                  
  *                                                                         
         Ｔ−ＴＲレコード件数    :=  0                                      
  * 発券レコード作成処理                                                    
         CNT := 1                                                           
         WHILE: CNT <= ＷＫ−発券電文ＣＮＴ                                 
  * 初期化                                                                  
           ＷＫ１重複電文登録フラグ(CNT) := ＯＦＦ                          
           ＷＫ１発券金額(CNT)           := ZERO                            
           ＷＫ−レコード状態            := 有効                            
  * 共通ヘッダ情報退避                                                      
           退避ＫＨ共通ヘッダ  :=  ＷＫ１共通ヘッダ(CNT)                    
  * 電文種別に応じて処理を振り分け                                          
           IF: ＷＫ１電文種別(CNT) = 発券要求                               
              トランザクションファイル  :=  ＴＲＮＳ初期化                  
              CALL: P310-RTN  ;終了チェック処理                             
              IF: ＷＫ−レコード状態 = 有効                                 
                 CALL: P320-RTN  ;発券レコード編集処理                      
              END:                                                          
           ELSE:   ; 障害取消要求                                           
              トランザクションファイル  :=  ＴＲＮＳ初期化                  
              CALL: P310-RTN  ;終了チェック処理                             
              IF: ＷＫ−レコード状態 = 有効                                 
                 CALL: P340-RTN  ;障害取消レコード編集処理                  
              END:                                                          
           END:                                                             
           IF: ＷＫ−レコード状態 = 有効                                    
              ＷＫ１終了チェック状態(CNT) :=  未終了                        
           ELSE:                                                            
  * 販売チャネル終了、またはゲーム終了済の場合                              
              ＷＫ１終了チェック状態(CNT) :=  終了済                        
           END:                                                             
           CNT := CNT + 1                                                   
         END:                                                               
  * 発券、障害取消のレコード件数をＷＫエリアに退避                          
         ＷＫ−発券レコード件数 := Ｔ−ＴＲレコード件数                     
  * ゲームタイプ、ゲーム計数テーブルセット用ＷＫエリアを初期化              
         INITIALIZE  ＷＫ−日付.                                            
         INITIALIZE  ＷＫ−ゲームタイプ.                                    
         INITIALIZE  ＷＫ−ブロックコード.                                  
  * 発券取消、支払、代替券、支払取消レコード作成処理                        
         CNT := 1                                                           
         WHILE: CNT <= ＷＫ−発券以外電文ＣＮＴ                             
  * 共通ヘッダ情報退避                                                      
           退避ＫＨ共通ヘッダ  :=  ＷＫ２共通ヘッダ(CNT)                    
  *                                                                         
           トランザクションファイル  :=  ＴＲＮＳ初期化                     
           ＷＫ−レコード状態 := 有効                                       
           CALL: P310-RTN  ;終了チェック処理                                
           IF: ＷＫ−レコード状態 = 有効                                    
              CALL: P330-RTN  ;発券以外レコード編集処理                     
           END:                                                             
           CNT := CNT + 1                                                   
         END:                                                               
       EXIT:                                                                
  *                                                                         
   SPACE:0                                                                  
   NOTE:                                                                    
   有効表出力処理                                                           
   NEND:                                                                    
   PROC:P400-RTN                                                            
       ENTRY:                                                               
  * アクセス規約により、ＦＥＰ番号の昇順にファイルを出力する                
         CNT-FEP := 1                                                       
         WHILE: CNT-FEP <= ＰＡＴＨＦＥＰ台数                               
           IF: ＦＬＧＦＥＰ別電文有無(CNT-FEP)  =  ＯＮ                     
              CALL: P410-RTN  ; ＦＥＰ別有効表出力処理                      
           END:                                                             
           CNT-FEP := CNT-FEP + 1                                           
         END:                                                               
       EXIT:                                                                
   SPACE:0                                                                  
   NOTE:                                                                    
   トランザクションファイル出力処理                                         
   NEND:                                                                    
   PROC:P500-RTN                                                            
       ENTRY:                                                               
  * アクセス規約により、世代区分、ＦＥＰ番号、販売チャネルコード            
  * の昇順にファイルを出力する                                              
         IDX-SEDAI := 1                                                     
         WHILE: IDX-SEDAI <= 2                                              
           CNT-FEP := 1                                                     
           WHILE: CNT-FEP <= ＰＡＴＨＦＥＰ台数                             
             CNT-CHANNEL := 1                                               
             WHILE: CNT-CHANNEL <= ＣＨＡＮ販売チャネル数                   
               IF: ＦＬＧ世別Ｆ別Ｃ別電文有無 ,                             
                   (IDX-SEDAI CNT-FEP CNT-CHANNEL) = ＯＮ                   
                  CALL: P510-RTN                                            
    ;世代・ＦＥＰ・販売チャネル別トランザクションファイル出力処理           
               END:                                                         
               CNT-CHANNEL := CNT-CHANNEL + 1                               
             END:                                                           
             CNT-FEP := CNT-FEP + 1                                         
           END:                                                             
           IDX-SEDAI := IDX-SEDAI + 1                                       
         END:                                                               
       EXIT:                                                                
  *                                                                         
   SPACE:0                                                                  
   NOTE:                                                                    
   発券電文個別処理                                                         
   NEND:                                                                    
   PROC:P600-RTN                                                            
       ENTRY:                                                               
  *                                                                         
  * 発券要求電文処理                                                        
  *                                                                         
  * ゲームタイプ、ゲーム計数テーブルセット用ＷＫエリアを初期化              
         INITIALIZE  ＷＫ−日付.                                            
         INITIALIZE  ＷＫ−ゲームタイプ.                                    
         INITIALIZE  ＷＫ−ブロックコード.                                  
  * 発券、障害取消要求電文数分、繰り返し                                    
         CNT := 1                                                           
         WHILE: CNT <= ＷＫ−発券電文ＣＮＴ                                 
           IF: ＷＫ１電文種別(CNT) = 発券要求  AND ,                        
               ＷＫ１終了チェック状態(CNT)   = 未終了 AND ,                 
               ＷＫ１重複電文登録フラグ(CNT) = ＯＦＦ                       
  * 前回処理した発券要求電文と受付日付、ゲームタイプ、                      
  * ブロックコードが異なる場合のみ、ゲーム種別、分子等を取得                
              IF: ＷＫ−日付 NOT = ＷＫ１受付日付(CNT)  OR ,                
                  ＷＫ−ゲームタイプ NOT = ,                                
                    Ｔ１００ゲームタイプ(CNT)  OR ,                         
                  ＷＫ−ブロックコード NOT = ,                              
                    Ｔ１００ブロックコード(CNT)                             
                 ＷＫ−日付           :=  ＷＫ１受付日付(CNT)               
                 ＷＫ−ゲームタイプ   := Ｔ１００ゲームタイプ(CNT)          
                 ＷＫ−ブロックコード ,                                     
                   := Ｔ１００ブロックコード(CNT)                           
                 CALL:IDX-GMTYSET-RTN                                       
                   ; ゲームタイプテーブル添字セット処理                     
                 CALL:GMKS-SET-RTN                                          
                   ; ゲーム計数レコードセット処理                           
              END:                                                          
  * 発券申込パラメータセット（個別）                                        
              ＷＫ−世代判定業務日付 := ＷＫ１受付日付(CNT)                 
              CALL: SEDAI-RTN ; 世代区分判定処理                            
              ＰＲＭ１世代区分 := ＷＫ−世代区分                            
              IF: ＰＲＭ１世代区分 = 世代Ａ                                 
                 SET  ＰＲＭ１ＧＡＭＥＰＴＲ ,                              
                   TO  ADDRESS  OF ゲーム計数一括更新ＴＢＬ１               
              ELSE:  ; 世代Ｂ                                               
                 SET  ＰＲＭ１ＧＡＭＥＰＴＲ ,                              
                   TO  ADDRESS  OF ゲーム計数一括更新ＴＢＬ２               
              END:                                                          
              ＰＲＭ１処理区分 := ＷＫ−処理区分                            
  * 個別Ｉ／Ｆ領域にＷＫ−発券電文ＴＢＬの内容をセット                      
  * （発券申込処理にて、同一領域を参照）                                    
              個別ＩＦ発券電文ＴＢＬ := ＷＫ−発券電文ＴＢＬ(CNT)           
  * 発券申込                                                                
              CASE: Ｔ−ＧＴゲーム種別(IDX-GMTY)                            
              OF:ナンバーズ                                                 
                 CASE: 退避ＧＫ分子数(1)                                    
                 OF: 3  ;ナンバーズ３                                       
                    ECALL: HRCHK011 (VISUCA , VISFPTR ,                     
                                               発券申込ＰＲＭ)              
                 OF: 4  ;ナンバーズ４                                       
                    ECALL: HRCHK021 (VISUCA , VISFPTR ,                     
                                               発券申込ＰＲＭ)              
                 END:                                                       
              OF: ロト                                                      
                 ECALL: HRCHK031 (VISUCA , VISFPTR ,                        
                                            発券申込ＰＲＭ)                 
              END:                                                          
           END:                                                             
           CNT := CNT + 1                                                   
         END:                                                               
  *                                                                         
  * 障害取消要求電文処理                                                    
  *                                                                         
         IF: ＷＫ−処理区分  =  通常                                        
  * 障害取消パラメータセット（共通）                                        
           ＰＲＭ２同期区分          := 通常                                
           ＰＲＭ２処理日付          := 0                                   
           ＰＲＭ２処理通番          := 0                                   
  * 発券、障害取消要求電文数分、繰り返し                                    
           CNT := 1                                                         
           WHILE: CNT <= ＷＫ−発券電文ＣＮＴ                               
             IF: ＷＫ１電文種別(CNT) = 発券障害取消要求  OR ,               
                 ＷＫ１電文種別(CNT) = 発券端末サーバ障害取消要求           
  * 終了チェック状態が未終了の場合のみ                                      
                IF: ＷＫ１終了チェック状態(CNT) = 未終了                    
  * 障害取消パラメータセット（個別）                                        
                   ＷＫ−世代判定業務日付 := ＷＫ１受付日付(CNT)            
                   CALL: SEDAI-RTN ; 世代区分判定処理                       
                   ＰＲＭ２世代区分 := ＷＫ−世代区分                       
                   ＰＲＭ２終了チェック状態 ,                               
                     := ＷＫ１終了チェック状態(CNT)                         
                   ＰＲＭ２障害取消要求電文 ,                               
                     := ＷＫ−発券電文ＴＢＬ(CNT)                           
  * 障害取消                                                                
                ECALL: HRCST011 (VISUCA , VISFPTR , 障害取消ＰＲＭ)         
                END:                                                        
             END:                                                           
             CNT := CNT + 1                                                 
           END:                                                             
         END:                                                               
       EXIT:                                                                
  *                                                                         
   SPACE:0                                                                  
   NOTE:                                                                    
     ゲーム計数一括更新処理                                                 
   NEND:                                                                    
   PROC:P700-RTN                                                            
       ENTRY:                                                               
  * アクセス規約により、世代区分の昇順にファイルを更新する                  
         IDX-SEDAI := 1                                                     
         WHILE: IDX-SEDAI <= 2                                              
           IF: ＦＬＧ世代別電文有無(IDX-SEDAI) = ＯＮ                       
              CALL: P710-RTN  ;世代別ゲーム計数一括更新処理                 
           END:                                                             
           IDX-SEDAI := IDX-SEDAI + 1                                       
         END:                                                               
       EXIT:                                                                
  *                                                                         
   SPACE:0                                                                  
   NOTE:                                                                    
     プール計数一括更新処理                                                 
   NEND:                                                                    
   PROC:P800-RTN                                                            
       ENTRY:                                                               
  * アクセス規約により、ゲームタイプ、ブロックコードの昇順に                
  * ファイルを更新する                                                      
  * 尚、プール計数一括更新テーブルは、発券申込処理にて、                    
  * ゲームタイプ、ブロックコードの昇順にソートされている                    
                                                                            
  * ゲームタイプ、ゲーム計数テーブルセット用ＷＫエリアを初期化              
         INITIALIZE  ＷＫ−日付.                                            
         INITIALIZE  ＷＫ−ゲームタイプ.                                    
         INITIALIZE  ＷＫ−ブロックコード.                                  
                                                                            
  * プール計数一括更新パラメータセット（共通）                              
         ＰＬＢＣ世代区分        := ＵＮＫ１世代区分                        
   ; システムヘッダの送受信端末名の退避情報をセット                         
         ＰＬＢＣＦＥＰ識別子    := ＷＫ−ＦＥＰ番号                        
         ＰＬＢＣパス番号        := ＷＫ−パス番号                          
   ; 共通ヘッダ（発券端末サーバ編集）の退避情報をセット                     
         ＰＬＢＣパス別電文日付  := ＷＫ−パス別電文日付                    
         ＰＬＢＣパス別電文通番  := ＷＫ−パス別電文通番                    
  *                                                                         
         CNT := 1                                                           
         ＰＬＢＣ取引件数  := 0                                             
         ＦＬＧプールＣＨＫ := ＯＦＦ                                       
         WHILE: CNT <= Ｔ−ＰＬ取引件数                                     
           ＰＬＢＣ取引件数 := ＰＬＢＣ取引件数 + 1                         
           ＰＬＢＣ一括更新テーブル(ＰＬＢＣ取引件数) ,                     
             :=  Ｔ−ＰＬプール計数一括更新(CNT)                            
           IF: (CNT = Ｔ−ＰＬ取引件数)                                     
  * プール計数一括更新テーブルの最終明細処理時                              
              CALL: P810-RTN  ;ゲーム別プール計数一括更新処理               
           ELSE:                                                            
              IF: (Ｔ−ＰＬゲームタイプ(CNT),                               
                     NOT = Ｔ−ＰＬゲームタイプ(CNT + 1)) OR ,              
                  (Ｔ−ＰＬブロックコード(CNT) ,                            
                    NOT = Ｔ−ＰＬブロックコード(CNT + 1))                  
  * プール計数一括更新テーブルの最終明細処理時以外の場合、かつ              
  * 現明細と次明細のゲームタイプ、またはブロックコードが異なる場合          
                 CALL: P810-RTN  ;ゲーム別プール計数一括更新処理            
                 ＰＬＢＣ取引件数 := 0                                      
              END:                                                          
           END:                                                             
           CNT := CNT + 1                                                   
         END:                                                               
       EXIT:                                                                
  *                                                                         
   SPACE:0                                                                  
   NOTE:                                                                    
     発券以外電文個別処理                                                   
   NEND:                                                                    
   PROC:P900-RTN                                                            
       ENTRY:                                                               
  * 発券以外パラメータセット（共通）                                        
         ＰＲＭ３処理区分    := ＷＫ−処理区分                              
         ＰＲＭ３サーバ状態  := ＷＫ−サーバ状態                            
  * 発券以外要求電文数分、繰り返し                                          
  *（P300-RTN にて発券、障害取消レコード件数をＷＫエリアに退避済）          
         CNT := ＷＫ−発券レコード件数 + 1                                  
         WHILE: CNT <= Ｔ−ＴＲレコード件数                                 
           IF: Ｔ−ＴＲレコード状態(CNT) = 有効                             
              ＰＲＭ３トランザクションＲ ,                                  
                := Ｔ−ＴＲトランザクションＲ(CNT)                          
  *                                                                         
              ＷＫ−世代判定業務日付 := ＰＲＭ３受付日付                    
              CALL: SEDAI-RTN ; 世代区分判定処理                            
              ＰＲＭ３世代区分 := ＷＫ−世代区分                            
  *                                                                         
              CASE: ＰＲＭ３レコードＩＤ                                    
  ** 発券取消 **                                                            
              OF: 発券取消ＩＤ                                              
                 ECALL: HRCHK111 (VISUCA , VISFPTR , 発券以外ＰＲＭ)        
  ** 当せん金支払 **                                                        
              OF: 支払ＩＤ OR 期限後支払ＩＤ                                
                 ECALL: HRCSH011 (VISUCA , VISFPTR , 発券以外ＰＲＭ)        
  ** 代替券発行 **                                                          
              OF: 代替券ＩＤ                                                
                 ECALL: HRCSH021 (VISUCA , VISFPTR , 発券以外ＰＲＭ)        
  ** 支払取消 **                                                            
              OF: 支払取消ＩＤ                                              
                 ECALL: HRCSH031 (VISUCA , VISFPTR , 発券以外ＰＲＭ)        
              END:                                                          
  * トランザクションエンド                                                  
              CALL:TRNSEND-RTN    ;  トランザクションエンド                 
           END:                                                             
           CNT := CNT + 1                                                   
         END:                                                               
       EXIT:                                                                
  *                                                                         
   SPACE:0                                                                  
   NOTE:                                                                    
     電文送信                                                               
   NEND:                                                                    
   PROC:PA00-RTN                                                            
       ENTRY:                                                               
  * 受信電文ＰＴＲのアドレスを入力電文の先頭位置へ再セット                  
         @ZCTTWPTR(RECVPTR = 受信電文ＰＴＲ ) ;                             
  * 入力電文のシステムヘッダ、共通ヘッダを出力電文へセット                  
         ＳＴ００システムヘッダ  :=  Ｔ０００システムヘッダ                 
         ＳＴ０１共通ヘッダ      :=  Ｔ００１共通ヘッダ                     
  *                                                                         
         CASE: ＷＫ−電文種別                                               
           OF: トランザクション転送要求                                     
              ＳＴ００電文長       :=  82                                   
              ＳＴ０１電文長       :=  62                                   
              ＳＴ０１電文種別     :=  トランザクション転送応答Ｊ           
   ; ＪＩＳコードで電文種別をセット                                         
              ＳＴ業務リターンコード   := ＷＫ−業務リターンコード          
              ＳＴ欠送電文日付 :=  ＷＫ−欠送電文日付                       
              ＳＴ欠送電文通番 :=  ＷＫ−欠送電文通番                       
              ＳＴトランザクション件数 ,                                    
                := ＲＴトランザクション件数                                 
           OF: ヘルスチェック                                               
              ＳＴ００電文長       :=  82                                   
              ＳＴ０１電文長       :=  62                                   
              ＳＴ０１電文種別     :=  トランザクション転送応答Ｊ           
   ; ＪＩＳコードで電文種別をセット                                         
  * ＳＴ０１電文通番には、処理済電文通番をセット                            
              ＳＴ０１電文通番     :=  ＷＫ−欠送電文通番 - 1               
              ＳＴ業務リターンコード  := ＷＫ−業務リターンコード           
              ＳＴ欠送電文日付 :=  ＷＫ−欠送電文日付                       
              ＳＴ欠送電文通番 :=  ＷＫ−欠送電文通番                       
              ＳＴトランザクション件数 := 0                                 
           OF: コネクション情報通知                                         
              ＳＴ００電文長       :=  70                                   
              ＳＴ０１電文長       :=  50                                   
              ＳＴ０１電文種別     :=  コネクション情報通知受付Ｊ           
   ; ＪＩＳコードで電文種別をセット                                         
              ＳＴ業務リターンコード   := 0                                 
         END:                                                               
         ＷＫ−送受信端末名        := VM-TERM                               
         ＷＫ−端末名２            := "V"                                   
  * 電文送信                                                                
         @ZMSVSEND(TYPE   = APT ,                                           
                   DOUHOU = NO ,                                            
                   MSGLEN = ＳＴ００電文長 ,                                
                   TERM   = ＷＫ−送受信端末名 ,                            
                   MARK   = SPACE ,                                         
                   PTR    = 送信電文ＰＴＲ ,                                
                   RTNCD  = ＷＫ−ＲＴＮＣＤ ) ;                            
         IF: ＷＫ−ＲＴＮＣＤ NOT = ZERO                                    
            IF: ＷＫ−ＲＴＮＣＤ = "14"  AND , ;ＶＩＳとＶＤが切断          
                ＷＫ−電文種別 = コネクション情報通知                       
  * ＶＩＳ起動直後に、ＶＩＳとＯＬＦのＶＤが未接続の場合、                  
  * 警告ＭＳＧを出力させるのみ（アボートさせない）                          
              @ZCTMSGOT( MSGID  = #RT205 ,                                  
                         PROGID = HRCAL010 ,                                
                         TEXT1  = ＷＫ−ＲＴＮＣＤ ) ;                      
            ELSE:                                                           
              @ZCTABORT( MSGID  = #RT205 ,                                  
                         PROGID = HRCAL010 ,                                
                         CNT    = 09 ,                                      
                         TEXT1  = ＷＫ−ＲＴＮＣＤ ) ;                      
           END:                                                             
         END:                                                               
       EXIT:                                                                
  *                                                                         
   SPACE:0                                                                  
   NOTE:                                                                    
     ゲーム計数一括読込処理                                                 
   NEND:                                                                    
   PROC:PB00-RTN                                                            
       ENTRY:                                                               
  * ゲーム計数一括更新テーブルには、HSAAL230 にて参照用のゲーム             
  * 計数ファイルより READ したレコードが展開されている                      
  * 本サブルーチンにて、更新用のゲーム計数ファイルより再度                  
  * ゲーム計数ファイルを読み込み、ゲーム計数一括更新テーブルへ              
  * レコードを再展開する                                                    
  * （ゲーム計数ファイルのアクセス規約による）                              
                                                                            
  * アクセス規約により、世代区分の昇順にファイルを読み込む                  
         IDX-SEDAI := 1                                                     
         WHILE: IDX-SEDAI <= 2                                              
           IF: ＦＬＧ世代別電文有無(IDX-SEDAI) = ＯＮ                       
              CALL: PB10-RTN  ;世代別ゲーム計数一括読込処理                 
           END:                                                             
           IDX-SEDAI := IDX-SEDAI + 1                                       
         END:                                                               
       EXIT:                                                                
  *                                                                         
   SPACE:0                                                                  
   NOTE:                                                                    
   手続き （レベル２）                                                      
   NEND:                                                                    
  *                                                                         
   NOTE:                                                                    
   パス別通番チェック処理（トランザクション転送要求）                       
   NEND:                                                                    
   PROC:P110-RTN                                                            
       ENTRY:                                                               
         IF: ＰＳＪＳ処理済電文日付(ＷＫ−パス番号) ,                       
                = Ｔ００１受付日付                                          
  * 処理済電文日付と受付日付が同一の場合                                    
            CASE:                                                           
              OF: ＰＳＪＳ処理済電文通番(ＷＫ−パス番号) + 1 ,              
                    = Ｔ００１電文通番                                      
                 IF: ＲＴページ属性  = 通常電文 ; 通常(ｺｰﾄﾞ:0)              
                    ＰＳＪＳ処理済電文通番(ＷＫ−パス番号) ,                
                      := Ｔ００１電文通番                                   
                 ELSE:                                                      
  * ページ属性 = 最終(最終電文)                                             
                    ＰＳＪＳ処理済前日日付(ＷＫ−パス番号) ,                
                     := Ｔ００１受付日付                                    
                    ＰＳＪＳ処理済前日最終通番(ＷＫ−パス番号) ,            
                     := Ｔ００１電文通番                                    
                    ＰＳＪＳ処理済電文日付(ＷＫ−パス番号) ,                
                     := ZERO                                                
                    ＰＳＪＳ処理済電文通番(ＷＫ−パス番号) ,                
                     := ZERO                                                
                 END:                                                       
                 ＷＫ−業務リターンコード := 正常終了                       
              OF: ＰＳＪＳ処理済電文通番(ＷＫ−パス番号) + 1 ,              
                    > Ｔ００１電文通番                                      
                 ＷＫ−業務リターンコード := 重送                           
  * Ｔ００１電文通番が１の場合のみ、警告メッセージを出力                    
                 IF: Ｔ００１電文通番 = 1                                   
                    ＷＫ−出力用電文日付 := ,                               
                      ＰＳＪＳ処理済電文日付(ＷＫ−パス番号)                
                    ＷＫ−出力用電文通番 := ,                               
                      ＰＳＪＳ処理済電文通番(ＷＫ−パス番号)                
                    ＷＫ−送受信端末名２ := ,                               
                      ＷＫ−送受信端末名                                    
                    ＷＫ−パス番号２ := ＷＫ−パス番号２ - 1                
                    @ZCTMSGOT( MSGID   =  #RT107 ,                          
                               PROGID  =  HRCAL010 ,                        
                               TEXT1   =  ＷＫ−送受信端末名２ ,            
                               TEXT2   =  ＷＫ−出力用電文日付 ,            
                               TEXT3   =  ＷＫ−出力用電文通番);            
                 END:                                                       
              OF: ＰＳＪＳ処理済電文通番(ＷＫ−パス番号) + 1 ,              
                    < Ｔ００１電文通番                                      
                 ＷＫ−業務リターンコード := 欠送                           
                 ＷＫ−欠送電文日付 := ,                                    
                   ＰＳＪＳ処理済電文日付(ＷＫ−パス番号)                   
                 ＷＫ−欠送電文通番 := ,                                    
                   ＰＳＪＳ処理済電文通番(ＷＫ−パス番号) + 1               
             END:                                                           
         ELSE:                                                              
  * 処理済電文日付と受付日付が異なる場合                                    
            CASE:                                                           
            OF: ＰＳＪＳ処理済前日日付(ＷＫ−パス番号) ,                    
                  = Ｔ００１受付日付                                        
  * @前日の電文を重複して受信した場合                                      
  * A業務日付切替時刻前に全販売チャネルが販売チャネル                      
  *   終了済となっている発券端末サーバの場合が、障害後に                    
  *   再起動され、当日送信済の最終電文を送信してきた場合                    
  *   （運行監視処理にて、パス別受信管理レコードは日替済）                  
                 IF: ＲＴページ属性  = 通常電文 ; 通常(ｺｰﾄﾞ:0)              
                    ＷＫ−業務リターンコード := 重送                        
                 ELSE:                                                      
  * ページ属性 = 最終(最終電文)                                             
  * @業務日付切替時刻前に全販売チャネルが販売チャネル                      
  *   終了済となっている発券端末サーバの場合が、業務日付                    
  *   切替時刻に、日替の最終電文を送信してきた場合                          
                    ＷＫ−業務リターンコード := 正常終了                    
                 END:                                                       
            OF: ＰＳＪＳ処理済電文日付(ＷＫ−パス番号) ,                    
                  = ZERO                                                    
  * 前日の最終電文受信直後の状態                                            
               IF: Ｔ００１電文通番 = 1                                     
                  IF: ＲＴページ属性 = 通常電文 ; 通常(ｺｰﾄﾞ:0)              
                     ＰＳＪＳ処理済電文日付(ＷＫ−パス番号) ,               
                       := Ｔ００１受付日付                                  
                     ＰＳＪＳ処理済電文通番(ＷＫ−パス番号) ,               
                       := Ｔ００１電文通番                                  
                  ELSE:                                                     
  * ページ属性 = 最終(最終電文)                                             
                     ＰＳＪＳ処理済前日日付(ＷＫ−パス番号) ,               
                      := Ｔ００１受付日付                                   
                     ＰＳＪＳ処理済前日最終通番(ＷＫ−パス番号) ,           
                      := Ｔ００１電文通番                                   
                     ＰＳＪＳ処理済電文日付(ＷＫ−パス番号) ,               
                      := ZERO                                               
                     ＰＳＪＳ処理済電文通番(ＷＫ−パス番号) ,               
                      := ZERO                                               
                  END:                                                      
                  ＷＫ−業務リターンコード := 正常終了                      
               ELSE:                                                        
  * Ｔ００１電文通番 > 1                                                    
                  IF: ＲＴページ属性 = 通常電文 ; 通常(ｺｰﾄﾞ:0)              
                     ＷＫ−業務リターンコード := 欠送                       
                     ＷＫ−欠送電文日付 := Ｔ００１受付日付                 
                     ＷＫ−欠送電文通番 := 1                                
                  ELSE:                                                     
  * ページ属性 = 最終(最終電文)                                             
  * @業務日付切替時刻前に全販売チャネルが販売チャネル                      
  *   終了済となっている発券端末サーバの場合が、業務日付                    
  *   切替時刻に、日替の最終電文を送信してきた場合                          
                     ＷＫ−業務リターンコード := 正常終了                   
                  END:                                                      
               END:                                                         
            OF: ＰＳＪＳ処理済電文日付(ＷＫ−パス番号) ,                    
                  NOT = ZERO                                                
  * 前日の最終電文が欠送した状態で当日の電文を受信した場合                  
               ＷＫ−業務リターンコード := 欠送                             
               ＷＫ−欠送電文日付 := ,                                      
                 ＰＳＪＳ処理済電文日付(ＷＫ−パス番号)                     
               ＷＫ−欠送電文通番 := ,                                      
                 ＰＳＪＳ処理済電文通番(ＷＫ−パス番号) + 1                 
  * 警告メッセージを出力                                                    
               ＷＫ−出力用電文日付 := ,                                    
                 ＰＳＪＳ処理済電文日付(ＷＫ−パス番号)                     
               ＷＫ−出力用電文通番 := ,                                    
                 ＰＳＪＳ処理済電文通番(ＷＫ−パス番号)                     
               ＷＫ−送受信端末名２ := ＷＫ−送受信端末名                   
               ＷＫ−パス番号２     := ＷＫ−パス番号２ - 1                 
               @ZCTMSGOT( MSGID   =  #RT108 ,                               
                          PROGID  =  HRCAL010 ,                             
                          TEXT1   =  ＷＫ−送受信端末名２ ,                 
                          TEXT2   =  ＷＫ−出力用電文日付 ,                 
                          TEXT3   =  ＷＫ−出力用電文通番);                 
            END:                                                            
         END:                                                               
       EXIT:                                                                
  *                                                                         
   SPACE:0                                                                  
   NOTE:                                                                    
   パス別通番チェック処理（ヘルスチェック電文）                             
   NEND:                                                                    
   PROC:P120-RTN                                                            
       ENTRY:                                                               
         IF: ＰＳＪＳ処理済電文日付(ＷＫ−パス番号) ,                       
                = Ｔ００１受付日付                                          
  * 処理済電文日付と受付日付が同一の場合                                    
            CASE:                                                           
              OF: ＰＳＪＳ処理済電文通番(ＷＫ−パス番号)  ,                 
                    = Ｔ００１電文通番                                      
                 ＷＫ−業務リターンコード := 正常終了                       
              OF: ＰＳＪＳ処理済電文通番(ＷＫ−パス番号)  ,                 
                    > Ｔ００１電文通番                                      
                 ＷＫ−業務リターンコード := 重送                           
              OF: ＰＳＪＳ処理済電文通番(ＷＫ−パス番号)  ,                 
                    < Ｔ００１電文通番                                      
                 ＷＫ−業務リターンコード := 欠送                           
                 ＷＫ−欠送電文日付 := ,                                    
                   ＰＳＪＳ処理済電文日付(ＷＫ−パス番号)                   
                 ＷＫ−欠送電文通番 := ,                                    
                   ＰＳＪＳ処理済電文通番(ＷＫ−パス番号) + 1               
             END:                                                           
         ELSE:                                                              
  * 処理済電文日付と受付日付が異なる場合                                    
            CASE:                                                           
            OF: ＰＳＪＳ処理済前日日付(ＷＫ−パス番号) ,                    
                  = Ｔ００１受付日付                                        
  * 前日の電文を重複して受信                                                
               ＷＫ−業務リターンコード := 重送                             
            OF: ＰＳＪＳ処理済電文日付(ＷＫ−パス番号) ,                    
                  = ZERO                                                    
  * ヘルスチェック電文の場合、本条件では通番チェック処理は行わない          
  * ・前日の最終電文受信直後の状態                                          
  * ・当日、電文を１件も受信していない状態                                  
  * ・販売チャネル終了済にてパス別受信管理レコード初期化後の状態            
               ＷＫ−業務リターンコード := 正常終了                         
            OF: ＰＳＪＳ処理済電文日付(ＷＫ−パス番号) ,                    
                  NOT = ZERO                                                
  * 前日の最終電文が欠送した状態で当日の電文を受信した場合                  
               ＷＫ−業務リターンコード := 欠送                             
               ＷＫ−欠送電文日付 := ,                                      
                 ＰＳＪＳ処理済電文日付(ＷＫ−パス番号)                     
               ＷＫ−欠送電文通番 := ,                                      
                 ＰＳＪＳ処理済電文通番(ＷＫ−パス番号) + 1                 
            END:                                                            
         END:                                                               
       EXIT:                                                                
  *                                                                         
   SPACE:0                                                                  
   NOTE:                                                                    
     発券電文テーブルソート処理                                             
   NEND:                                                                    
   PROC:P210-RTN                                                            
       ENTRY:                                                               
  ** 売場コードの昇順に発券電文をテーブルに格納 **                          
         WK-I                   :=   ＷＫ−発券電文ＣＮＴ                   
         ＷＫ−発券電文ＣＮＴ   :=   ＷＫ−発券電文ＣＮＴ +  1              
         WHILE: WK-I >= 1                                                   
             IF: ＷＫ１発信元ＩＤ(WK-I) > ＣＤＣＫ発信元ＩＤ                
                 ＷＫ−発券電文ＴＢＬ(WK-I + 1)  :=          ,              
                                   ＷＫ−発券電文ＴＢＬ(WK-I)               
                 WK-I :=  WK-I - 1                                          
             ELSE:                                                          
                 ＷＫ−発券電文ＴＢＬ(WK-I + 1) ,                           
                   := ＣＤＣＫ変換後入力電文                                
                 WK-I :=  -1                                                
            END:                                                            
         END:                                                               
         IF: WK-I = 0                                                       
             ＷＫ−発券電文ＴＢＬ(1)  := ＣＤＣＫ変換後入力電文             
         END:                                                               
       EXIT:                                                                
  *                                                                         
   SPACE:0                                                                  
   NOTE:                                                                    
   終了チェック処理                                                         
   NEND:                                                                    
   PROC:P310-RTN                                                            
       ENTRY:                                                               
  * 各終了チェック部品用に世代別運用管理ファイルを読み込んだ                
  * 状態としておく                                                          
         ＷＫ−世代判定業務日付 := 退避ＫＨ受付日付                         
         CALL: SEDAI-RTN ; 世代区分判定処理                                 
         世代別運用管理Ｒ  ,                                                
           :=  Ｔ−ＳＵ世代別運用管理Ｒ(ＷＫ−世代区分)                     
  * 販売チャネル終了チェック                                                
         @ZCKSTSHC( CHANNEL = 退避ＫＨ販売チャネルコード ,                  
                    STATUS  = ＦＬＧ終了 ) ;                                
         IF: ＦＬＧ終了 NOT = 未受信    ;未受信(ｺｰﾄﾞ:0)                     
           ＷＫ−レコード状態 := 無効                                       
           ＷＫ−出力用販売チャネル ,                                       
                  := 退避ＫＨ販売チャネルコード                             
           CASE:  ＦＬＧ終了                                                
           OF:  受信済                      ;受信済(ｺｰﾄﾞ:1)                 
              @ZCTMSGOT(  MSGID = #RT206 ,                                  
                          PROGID = HRCAL010 ,                               
                          TEXT1 = 退避ＫＨ発信元ＩＤ ,                      
                          TEXT2 = ＷＫ−出力用販売チャネル ,                
                          TEXT3 = 退避ＫＨ電文通番 ) ;                      
           OF:  該当なし                    ;該当なし(ｺｰﾄﾞ:9)               
              @ZCTMSGOT(  MSGID = #RT226 ,                                  
                          PROGID = HRCAL010 ,                               
                          TEXT1 = 退避ＫＨ発信元ＩＤ ,                      
                          TEXT2 = ＷＫ−出力用販売チャネル ,                
                          TEXT3 = 退避ＫＨ電文通番 ) ;                      
           END:                                                             
           CALL: TRNS-ERR-RTN  ; トランザクションエラー出力処理             
           RETURN:                                                          
         END:                                                               
  * ゲーム終了チェック（発券要求、発券取消要求の場合のみ）                  
           IF: 退避ＫＨ電文種別 = 発券要求  OR ,                            
               退避ＫＨ電文種別 = 発券取消要求                              
              CASE: 退避ＫＨ電文種別                                        
                OF: 発券要求                                                
                 ＷＫ−退避ゲームタイプ ,                                   
                   := Ｔ１００ゲームタイプ(CNT)                             
                 ＷＫ−退避ブロックコード ,                                 
                   := Ｔ１００ブロックコード(CNT)                           
                 ＷＫ−退避開始回号   := Ｔ１００開始回号(CNT)              
                OF: 発券取消要求                                            
                 ＷＫ−退避ゲームタイプ ,                                   
                   := Ｔ１２０ゲームタイプ(CNT)                             
                 ＷＫ−退避ブロックコード ,                                 
                   := Ｔ１２０ブロックコード(CNT)                           
                 ＷＫ−退避開始回号   := Ｔ１２０開始回号(CNT)              
              END:                                                          
              @ZCKSTSGM( GTYPE  = ＷＫ−退避ゲームタイプ ,                  
                         BCODE  = ＷＫ−退避ブロックコード ,                
                         KAIGOU = ＷＫ−退避開始回号 ,                      
                         STATUS = ＦＬＧ終了 ) ;                            
              IF:  ＦＬＧ終了 NOT = 発売中    ;発売中(ｺｰﾄﾞ:0)               
                ＷＫ−レコード状態 := 無効                                  
                ＷＫ−出力用ブロックコード ,                                
                  := ＷＫ−退避ブロックコード                               
                @ZCTMSGOT(  MSGID = #RT207 ,                                
                            PROGID = HRCAL010 ,                             
                            TEXT1 = 退避ＫＨ発信元ＩＤ ,                    
                            TEXT2 = 退避ＫＨ電文通番 ,                      
                            TEXT3 = ＷＫ−退避ゲームタイプ ,                
                            TEXT4 = ＷＫ−出力用ブロックコード ,            
                            TEXT5 = ＷＫ−退避開始回号 ) ;                  
            CALL: TRNS-ERR-RTN  ; トランザクションエラー出力処理            
            END:                                                            
         END:                                                               
       EXIT:                                                                
  *                                                                         
   SPACE:0                                                                  
   NOTE:                                                                    
     発券レコード編集処理                                                   
   NEND:                                                                    
   PROC:P320-RTN                                                            
       ENTRY:                                                               
  * 前回処理した発券要求電文と受付日付、ゲームタイプ、                      
  * ブロックコードが異なる場合のみ、ゲーム種別、単価等を取得                
         IF: ＷＫ−日付 NOT = ＷＫ１受付日付(CNT)  OR ,                     
             ＷＫ−ゲームタイプ NOT = ,                                     
               Ｔ１００ゲームタイプ(CNT)  OR ,                              
             ＷＫ−ブロックコード NOT = Ｔ１００ブロックコード(CNT)         
            ＷＫ−日付            :=  ＷＫ１受付日付(CNT)                   
            ＷＫ−ゲームタイプ    :=  Ｔ１００ゲームタイプ(CNT)             
            ＷＫ−ブロックコード  :=  Ｔ１００ブロックコード(CNT)           
            CALL:IDX-GMTYSET-RTN                                            
              ; ゲームタイプテーブル添字セット処理                          
            CALL:GMKS-SET-RTN                                               
              ; ゲーム計数レコードセット処理                                
         END:                                                               
  * 共通編集処理                                                            
         CALL:P321-RTN  ; 発券レコード共通編集処理                          
  * 裏面番号２退避                                                          
         ＷＫ−連番ＣＤ分解      := Ｔ１００裏面番号２(CNT)                 
  * ロトコンビフラグセット                                                  
         IF: ＴＲＮＳゲーム種別 = ロト  AND ,                               
             Ｔ１０５申込タイプ(CNT 1) NOT = 2                              
            ＦＬＧロトコンビ  :=  ＯＮ                                      
         ELSE:                                                              
            ＦＬＧロトコンビ  :=  ＯＦＦ                                    
         END:                                                               
  * くじ券タイプセット                                                      
         IF: ＴＲＮＳ販売チャネルコード NOT = 発券端末                      
            ＦＬＧくじ券タイプ := 単独くじ券                                
         ELSE:                                                              
            IF: Ｔ１０５パネル数(CNT) > 1                                   
               ＦＬＧくじ券タイプ := 単独くじ券                             
            ELSE:                                                           
               IF: ＦＬＧロトコンビ = ＯＮ                                  
                  ＦＬＧくじ券タイプ := 単独くじ券                          
               ELSE:                                                        
                 ＦＬＧくじ券タイプ := 継続くじ券                           
               END:                                                         
            END:                                                            
         END:                                                               
  * カウンタ初期化                                                          
         ＣＮＴ−回号            := ZERO                                    
           ; 回号数をカウントする                                           
         ＣＮＴ−当初継続回号数  := ZERO                                    
           ; 当初継続回号数をカウントする                                   
         ＣＮＴ−識別            := ZERO                                    
           ; 識別コード単位の分割数をカウントする                           
  * 回号セット                                                              
         ＷＫ−回号              := Ｔ１００開始回号(CNT) - 1               
           ; 処理中の回号を格納する                                         
  * 継続回号数分、繰り返し                                                  
         WHILE:ＣＮＴ−回号 < Ｔ１００継続回号数(CNT)                       
  * カウンタ加算                                                            
           ＷＫ−回号              :=  ＷＫ−回号 + 1                       
           ＣＮＴ−回号            :=  ＣＮＴ−回号 + 1                     
           ＣＮＴ−当初継続回号数  :=  ＣＮＴ−当初継続回号数 + 1           
  ** 分割条件@ **                                                          
  * ＦＬＧくじ券タイプが”単独くじ券”の場合、                              
  * 継続回号数分、くじ券を分割                                              
           IF: ＦＬＧくじ券タイプ = 単独くじ券                              
              ＦＬＧパネル分割  :=  １−５パネル編集時                      
              CALL:P322-RTN  ; 発券レコード個別編集処理                     
  ** 分割条件A **                                                          
  * 分割条件@に加え、パネル数が６パネル以上の場合                          
              IF: Ｔ１０５パネル数(CNT) > 5                                 
                 ＦＬＧパネル分割  :=  ６−７パネル編集時                   
                 CALL:P322-RTN  ; 発券レコード個別編集処理                  
              END:                                                          
           ELSE:                                                            
  ** 分割条件B **                                                          
  * ＦＬＧくじ券タイプが”継続くじ券”の場合、                              
  * 以下のいずれかの条件成立時にくじ券を分割                                
  *　・当初継続回号数が５となった場合                                       
  *　・継続回号数の最終回号に対する処理の場合                               
  *　・各回号の単価が異なる場合                                             
              ＦＬＧパネル分割  :=  １−５パネル編集時                      
              IF: ＣＮＴ−当初継続回号数 = 5  OR ,                          
                  ＣＮＴ−回号 = Ｔ１００継続回号数(CNT)                    
                 CALL:P322-RTN  ; 発券レコード個別編集処理                  
                 ＣＮＴ−当初継続回号数 := 0                                
              ELSE:                                                         
  * IDX-KAIGOU の値が ２１ となると配列範囲外が発生する                     
  * ただし、IDX-KAIGOU が ２１となった場合は、上記の条件が                  
  * 必ず成立するため、配列範囲外は発生しない                                
                 IDX-KAIGOU := ＷＫ−回号 - 退避ＧＫ先頭回号 + 1            
                 IF: 退避ＧＫ単価(IDX-KAIGOU) NOT = ,                       
                     退避ＧＫ単価(IDX-KAIGOU + 1)                           
                    CALL:P322-RTN  ; 発券レコード個別編集処理               
                    ＣＮＴ−当初継続回号数 := 0                             
                 END:                                                       
              END:                                                          
           END:                                                             
         END:                                                               
       EXIT:                                                                
   SPACE:0                                                                  
   NOTE:                                                                    
   発券以外レコード編集処理                                                 
   NEND:                                                                    
   PROC:P330-RTN                                                            
       ENTRY:                                                               
  * 共通編集                                                                
         ＴＲＮＳ取引日付            :=  ＷＫ２日付(CNT)                    
         ＴＲＮＳ取引時刻            :=  ＷＫ２時刻(CNT)                    
         ＴＲＮＳ受付日付            :=  ＷＫ２受付日付(CNT)                
         ＴＲＮＳ受付時刻            :=  ＷＫ２受付時刻(CNT)                
         ＴＲＮＳ売場コード          :=  ＷＫ２発信元ＩＤ(CNT)              
         ＴＲＮＳ販売員ＩＤ          :=  ＷＫ２販売員ＩＤ(CNT)              
         ＴＲＮＳ機種区分            :=  ＷＫ２機種区分(CNT)                
         ＴＲＮＳ販売チャネルコード  ,                                      
           :=  ＷＫ２販売チャネルコード(CNT)                                
         ＴＲＮＳ電文通番            :=  ＷＫ２電文通番(CNT)                
         CASE:  ＷＫ２入力方式１(CNT)                                       
         OF:  B"1"                                                          
              ＴＲＮＳ入力方式１      :=  "1"                               
         OF:  B"0"                                                          
              ＴＲＮＳ入力方式１      :=  "0"                               
         END:                                                               
         CASE:  ＷＫ２入力方式２(CNT)                                       
         OF:  B"1"                                                          
              ＴＲＮＳ入力方式２      :=  "1"                               
         OF:  B"0"                                                          
              ＴＲＮＳ入力方式２      :=  "0"                               
         END:                                                               
         ＴＲＮＳセンター状態    :=  ＷＫ−センター状態                     
         ＴＲＮＳレコード状態    :=  ＷＫ−レコード状態                     
  * 個別編集                                                                
         CASE: ＷＫ２電文種別(CNT)                                          
  *** 発券取消 ***                                                          
         OF: 発券取消要求                                                   
            CALL:P331-RTN  ;  発券取消レコード編集                          
  *** 支払 ***                                                              
         OF: 支払要求                                                       
            CALL:P332-RTN  ;  支払レコード編集                              
  *** 代替券発行 ***                                                        
         OF: 代替券発行要求                                                 
            CALL:P333-RTN  ;  代替券レコード編集                            
  *** 支払取消 ***                                                          
         OF: 支払取消要求                                                   
            CALL:P334-RTN  ;  支払取消レコード編集                          
         END:                                                               
  * トランザクションレコード退避                                            
         Ｔ−ＴＲレコード件数 :=  Ｔ−ＴＲレコード件数  +  1                
         Ｔ−ＴＲトランザクションＲ(Ｔ−ＴＲレコード件数) ,                 
           :=  トランザクションＲ                                           
  * 電文有無フラグ更新（P400,P500,P700-RTNにて参照)                         
         ＷＫ−世代判定業務日付 := ＴＲＮＳ受付日付                         
         CALL: SEDAI-RTN ; 世代区分判定処理                                 
         ＷＫ−識別コード中 :=  ＴＲＮＳ識別コード中                        
  *                                                                         
         ＦＬＧ世代別電文有無(ＷＫ−世代区分)          :=  ＯＮ             
         ＦＬＧＦＥＰ別電文有無(ＷＫ−識別ＦＥＰ番号)  :=  ＯＮ             
         ＦＬＧ世別Ｆ別Ｃ別電文有無(ＷＫ−世代区分 ,                        
                       ＷＫ−識別ＦＥＰ番号 ,                               
                         ＴＲＮＳ販売チャネルコード)   :=  ＯＮ             
       EXIT:                                                                
  *                                                                         
   SPACE:0                                                                  
   NOTE:                                                                    
     障害取消レコード編集                                                   
   NEND:                                                                    
   PROC:P340-RTN                                                            
       ENTRY:                                                               
  * 障害取消レコード編集                                                    
         ＴＲＮＳレコードＩＤ        := 障害取消ＩＤ                        
         ＴＲＮＳ取引日付            :=  ＷＫ１日付(CNT)                    
         ＴＲＮＳ取引時刻            :=  ＷＫ１時刻(CNT)                    
         ＴＲＮＳ受付日付            :=  ＷＫ１受付日付(CNT)                
         ＴＲＮＳ受付時刻            :=  ＷＫ１受付時刻(CNT)                
         ＴＲＮＳ売場コード          :=  ＷＫ１発信元ＩＤ(CNT)              
         ＴＲＮＳ販売員ＩＤ          :=  ＷＫ１販売員ＩＤ(CNT)              
         ＴＲＮＳ機種区分            :=  ＷＫ１機種区分(CNT)                
         ＴＲＮＳ販売チャネルコード  ,                                      
           :=  ＷＫ１販売チャネルコード(CNT)                                
         ＴＲＮＳ電文通番            :=  ＷＫ１電文通番(CNT)                
         CASE:  ＷＫ１入力方式１(CNT)                                       
         OF:  B"1"                                                          
              ＴＲＮＳ入力方式１      :=  "1"                               
         OF:  B"0"                                                          
              ＴＲＮＳ入力方式１      :=  "0"                               
         END:                                                               
         CASE:  ＷＫ１入力方式２(CNT)                                       
         OF:  B"1"                                                          
              ＴＲＮＳ入力方式２      :=  "1"                               
         OF:  B"0"                                                          
              ＴＲＮＳ入力方式２      :=  "0"                               
         END:                                                               
  *                                                                         
         ＴＲＮＳセンター状態    :=  ＷＫ−センター状態                     
         ＴＲＮＳレコード状態    :=  ＷＫ−レコード状態                     
  * 取消区分、識別コード、旧識別コード、識別コード区分                      
         CASE: ＷＫ１電文種別(CNT)                                          
           OF: 発券障害取消要求                                             
              IF: Ｔ９００障害識別コード数(CNT) = ZERO                      
                 ＴＲＮＳ取消区分 := 電文通番取消                           
                 ＷＫ−変換前識別コード ,                                   
                   :=  Ｔ９００障害識別コード(CNT 1)                        
              ELSE:                                                         
                 ＴＲＮＳ取消区分 := 識別コード取消                         
                 IDX-CODE := Ｔ９００障害識別コード数(CNT) + 1              
                 ＷＫ−変換前識別コード ,                                   
                   := Ｔ９００障害識別コード(CNT IDX-CODE)                  
              END:                                                          
           OF: 発券端末サーバ障害取消要求                                   
              ＴＲＮＳ取消区分 := 識別コード取消                            
              IDX-CODE := Ｆ９００障害識別コード数(CNT) + 1                 
              ＷＫ−変換前識別コード ,                                      
                := Ｆ９００障害識別コード(CNT IDX-CODE)                     
         END:                                                               
  * 識別コード体系変換                                                      
         CALL: ZMSSRLCV-RTN  ; 識別コード変換処理                           
         ＴＲＮＳ識別コード  := ＷＫ−変換後識別コード                      
         IF: ＷＫ−変換前識別コード下 NOT = ZERO                            
            ＴＲＮＳ識別コード区分 :=  ２４桁                               
         ELSE:                                                              
            ＴＲＮＳ識別コード区分 :=  １６桁                               
            ＴＲＮＳ旧識別コード上 :=  ＷＫ−変換前識別コード上             
            ＴＲＮＳ旧識別コード下 :=  ＷＫ−変換前識別コード中             
         END:                                                               
  * トランザクションレコード退避                                            
         Ｔ−ＴＲレコード件数 :=  Ｔ−ＴＲレコード件数  +  1                
         Ｔ−ＴＲトランザクションＲ(Ｔ−ＴＲレコード件数) ,                 
           :=  トランザクションＲ                                           
  * 電文有無フラグ更新（P400,P500,P700-RTNにて参照)                         
         ＷＫ−世代判定業務日付 := ＴＲＮＳ受付日付                         
         CALL: SEDAI-RTN ; 世代区分判定処理                                 
         ＷＫ−識別コード中 :=  ＴＲＮＳ識別コード中                        
  *                                                                         
         ＦＬＧ世代別電文有無(ＷＫ−世代区分)          :=  ＯＮ             
         ＦＬＧＦＥＰ別電文有無(ＷＫ−識別ＦＥＰ番号)  :=  ＯＮ             
         ＦＬＧ世別Ｆ別Ｃ別電文有無(ＷＫ−世代区分 ,                        
                       ＷＫ−識別ＦＥＰ番号 ,                               
                         ＴＲＮＳ販売チャネルコード)   :=  ＯＮ             
       EXIT:                                                                
  *                                                                         
   SPACE:0                                                                  
   NOTE:                                                                    
   ＦＥＰ別有効表出力処理                                                   
   NEND:                                                                    
   PROC:P410-RTN                                                            
       ENTRY:                                                               
  * ファイルポインタセット                                                  
         @ZFLPTRST( FILE     = YT ,                                         
                    MODE     = 2 ,                                          
                    FEPNO    = CNT-FEP ,                                    
                    FILEPTR  = YUKOPTR ,                                    
                    RTNCD    = ＷＫ−ＲＴＮＣＤ ) ;                         
         IF:  ＷＫ−ＲＴＮＣＤ NOT = "00" AND "01"                          
           @ZCTABORT( MSGID  = #RT203 ,                                     
                      PROGID = HRCAL010 ,                                   
                      CNT    = 10 ,                                         
                      TEXT1  = ＷＫ−ＲＴＮＣＤ ) ;                         
         END:                                                               
         SET  DYUKOPTR TO YUKOPTR                                           
                                                                            
  * トランザクションレコード件数分、繰り返し                                
         CNT := 1                                                           
         WHILE: CNT <= Ｔ−ＴＲレコード件数                                 
           ＷＫ−識別コード中  :=  Ｔ−ＴＲ識別コード中(CNT)                
           IF: ＷＫ−識別ＦＥＰ番号   = CNT-FEP                             
              IF: (Ｔ−ＴＲレコードＩＤ(CNT)  = 発券ＩＤ    AND ,           
                   Ｔ−ＴＲレコード状態(CNT)  = 有効)     OR ,              
                  (Ｔ−ＴＲレコードＩＤ(CNT)  = 代替券ＩＤ  AND ,           
                   Ｔ−ＴＲレコード状態(CNT)  = 有効)                       
  * トランザクションＲのレコード長 > 有効Ｒのレコード長　のため             
  * 桁落ちが発生する。そのため、有効表の予備エリアは初期化しておく。        
                 有効Ｒ  :=  Ｔ−ＴＲトランザクションＲ(CNT)                
                 ＹＵＫＯ予備  :=  SPACE                                    
                 WRITE  有効Ｒ  INVALID KEY CONTINUE                        
                 CASE: ＳＴＳコード                                         
                 OF: ZERO                                                   
                    CONTINUE.                                               
                 OF: "22"  ; DUPKEY                                         
  * ２センター同期により同一の電文を重複して受信                            
                    Ｔ−ＴＲレコード状態(CNT) := 無効                       
  * 重複電文については、P600-RTN にて発券申込処理をＣＡＬＬさせない         
  * ように、発券電文ＴＢＬ上の重複電文登録フラグを ＯＮ としておく          
                    IF: Ｔ−ＴＲレコードＩＤ(CNT) = 発券ＩＤ                
                       ＷＫ−添字 := Ｔ−ＴＲ発券電文ＴＣＮＴ(CNT)          
                       ＷＫ１重複電文登録フラグ(ＷＫ−添字) := ＯＮ         
                    END:                                                    
                 OTHER:                                                     
                    ＷＫ−識別コード上 := ＹＵＫＯ識別コード上              
                    ＷＫ−識別コード中 := ＹＵＫＯ識別コード中              
                    ＷＫ−識別コード下 := ＹＵＫＯ識別コード下              
                    @ZCTABORT( MSGID  = #RT215 ,                            
                               PROGID = HRCAL010 ,                          
                               CNT    = 11 ,                                
                               TEXT1  = "ﾕｳｺｳﾋｮｳ" ,                         
                               TEXT2  = CNT-FEP ,                           
                               TEXT3  = "-" ,                               
                               TEXT4  = "WRITE" ,                           
                               TEXT5  = ＷＫ−識別コード上 ,                
                               TEXT6  = ＷＫ−識別コード中 ,                
                               TEXT7  = ＷＫ−識別コード下 ,                
                               TEXT8  = ＳＴＳコード ,                      
                               TEXT9  = ＳＴＳ詳細  ) ;                     
                 END:                                                       
              END:                                                          
           END:                                                             
           CNT := CNT + 1                                                   
         END:                                                               
       EXIT:                                                                
  *                                                                         
   SPACE:0                                                                  
   NOTE:                                                                    
   世代・ＦＥＰ・販売チャネル別トランザクションファイル出力処理             
   NEND:                                                                    
   PROC:P510-RTN                                                            
       ENTRY:                                                               
  * トランザクションレコード件数分、繰り返し                                
         CNT := 1                                                           
         ＴＲＢＣレコード件数 := 0                                          
         WHILE: CNT <= Ｔ−ＴＲレコード件数                                 
           ＷＫ−識別コード中  :=  Ｔ−ＴＲ識別コード中(CNT)                
           IF: Ｔ−ＴＲ受付日付(CNT)  ,                                     
                 = Ｔ−ＳＵ業務日付(IDX-SEDAI)   AND ,                      
               ＷＫ−識別ＦＥＰ番号   = CNT-FEP  AND ,                      
               Ｔ−ＴＲ販売チャネルコード(CNT) = CNT-CHANNEL                
              ＴＲＢＣレコード件数 := ＴＲＢＣレコード件数 + 1              
              ＴＲＢＣトランザクションＲ(ＴＲＢＣレコード件数) ,            
                := Ｔ−ＴＲトランザクションＲ(CNT)                          
           END:                                                             
           CNT := CNT + 1                                                   
         END:                                                               
  * トランザクションファイル出力パラメータセット                            
         ＴＲＢＣ世代区分           := IDX-SEDAI                            
         ＴＲＢＣＦＥＰＮＯ         := CNT-FEP                              
         ＴＲＢＣ販売チャネルコード := CNT-CHANNEL                          
   ; システムヘッダの送受信端末名の退避情報をセット                         
         ＴＲＢＣＦＥＰ識別子       := ＷＫ−ＦＥＰ番号                     
         ＴＲＢＣパス番号           := ＷＫ−パス番号                       
   ; 共通ヘッダ（発券端末サーバ編集）の退避情報をセット                     
         ＴＲＢＣパス別電文日付     := ＷＫ−パス別電文日付                 
         ＴＲＢＣパス別電文通番     := ＷＫ−パス別電文通番                 
  * トランザクションファイル出力処理                                        
         ECALL: HSAAL110 (VISUCA , VISFPTR ,                                
                                    トランザクション出力ＰＲＭ)             
         IF: ＴＲＢＣＲＴＮＣＤ NOT = ZERO                                  
           @ZCTABORT( MSGID  = #RT208 ,                                     
                      PROGID = HRCAL010 ,                                   
                      CNT    = 12 ) ;                                       
         END:                                                               
       EXIT:                                                                
  *                                                                         
   SPACE:0                                                                  
   NOTE:                                                                    
     世代別ゲーム計数一括更新処理                                           
   NEND:                                                                    
   PROC:P710-RTN                                                            
       ENTRY:                                                               
  * ファイルポインタ、レコード件数セット                                    
         IF: IDX-SEDAI = 世代Ａ                                             
            SET  FGMKSPTR  TO  FGMKSPTRA                                    
            ＷＫ−ＧＫレコード件数 := Ｔ−Ｇ１レコード件数                  
         ELSE:                                                              
            SET  FGMKSPTR  TO  FGMKSPTRB                                    
            ＷＫ−ＧＫレコード件数 := Ｔ−Ｇ２レコード件数                  
         END:                                                               
  * ゲーム計数一括更新レコードの格納件数分、繰り返し                        
         CNT := 1                                                           
         WHILE: CNT <= ＷＫ−ＧＫレコード件数                               
            IF: IDX-SEDAI = 世代Ａ                                          
               ゲーム計数Ｒ := Ｔ−Ｇ１ゲーム計数Ｒ(CNT)                    
            ELSE:                                                           
               ゲーム計数Ｒ := Ｔ−Ｇ２ゲーム計数Ｒ(CNT)                    
            END:                                                            
  * ゲーム計数ファイル更新                                                  
           REWRITE  ゲーム計数Ｒ  INVALID KEY CONTINUE                      
           IF:  ＳＴＳコード NOT = ZERO                                     
             ＷＫ−計数ゲームタイプ   := ＧＭＫＳゲームタイプ               
             ＷＫ−計数ブロックコード := ＧＭＫＳブロックコード             
             @ZCTABORT( MSGID  = #RT201 ,                                   
                        PROGID = HRCAL010 ,                                 
                        CNT    = 13 ,                                       
                        TEXT1  = "ｹﾞｰﾑｹｲｽｳﾌｧｲﾙ" ,                           
                        TEXT2  = ＷＫ−ＦＥＰ番号 ,                         
                        TEXT3  = IDX-SEDAI ,                                
                        TEXT4  = "REWRITE" ,                                
                        TEXT5  = ＷＫ−ゲーム計数キー ,                     
                        TEXT6  = ＳＴＳコード ,                             
                        TEXT7  = ＳＴＳ詳細 ) ;                             
           END:                                                             
           CNT := CNT + 1                                                   
         END:                                                               
       EXIT:                                                                
  *                                                                         
   SPACE:0                                                                  
   NOTE:                                                                    
     ゲーム別プール計数一括更新処理                                         
   NEND:                                                                    
   PROC:P810-RTN                                                            
       ENTRY:                                                               
  * プール計数一括更新パラメータセット（個別）                              
                                                                            
  * 前回処理したプール計数一括更新処理とゲームタイプが異なる場合            
  * のみ、ゲーム種別を取得                                                  
         IF: ＷＫ−ゲームタイプ NOT = Ｔ−ＰＬゲームタイプ(CNT)             
            ＷＫ−ゲームタイプ := Ｔ−ＰＬゲームタイプ(CNT)                 
            CALL:IDX-GMTYSET-RTN  ;ゲームタイプファイルカウンタセッ         
         END:                                                               
         ＰＬＢＣゲーム種別   := Ｔ−ＧＴゲーム種別(IDX-GMTY)               
   ;                                                                        
         ＰＬＢＣゲームタイプ    ,                                          
           := Ｔ−ＰＬゲームタイプ(CNT)                                     
         ＰＬＢＣブロックコード  ,                                          
           := Ｔ−ＰＬブロックコード(CNT)                                   
  * ゲーム計数一括更新テーブルより、先頭回号を取得                          
         ＷＫ−ゲームタイプ    :=  ＰＬＢＣゲームタイプ                     
         ＷＫ−ブロックコード  :=  ＰＬＢＣブロックコード                   
         ＷＫ−日付            :=  ＵＮＫ１業務日付                         
         CALL:GMKS-SET-RTN ; ゲーム計数レコードセット処理                   
         IF: 退避ＧＫゲームタイプ = ＰＬＢＣゲームタイプ  AND ,             
             退避ＧＫブロックコード = ＰＬＢＣブロックコード                
  * 現世代のゲーム計数テーブルに対象のゲーム計数レコードが展開              
  * されていた場合                                                          
            ＰＬＢＣ先頭回号 := 退避ＧＫ先頭回号                            
         ELSE:                                                              
  * 現世代でないゲーム計数テーブルに対象のゲーム計数レコードが              
  * 展開されていた場合                                                      
            IF: ＵＮＫ１世代区分 = 世代Ａ                                   
               ＷＫ−日付 := Ｔ−ＳＵ業務日付(世代Ｂ)                       
            ELSE:                                                           
               ＷＫ−日付 := Ｔ−ＳＵ業務日付(世代Ａ)                       
            END:                                                            
            CALL:GMKS-SET-RTN ; ゲーム計数レコードセット処理                
            ＰＬＢＣ先頭回号 := 退避ＧＫ先頭回号                            
         END:                                                               
  * プール計数ファイル一括更新処理                                          
         ＦＬＧプール更新   := ＯＦＦ                                       
         IF: ＷＫ−処理区分  =  通常                                        
           ＦＬＧプール更新 := ＯＮ                                         
         ELSE:                                                              
           IF: ＦＬＧプールＣＨＫ = ＯＦＦ                                  
             CALL: P811-RTN   ;プール計数一括更新チェック処理               
             ＦＬＧプールＣＨＫ := ＯＮ                                     
           END:                                                             
           CASE:                                                            
           OF: ＷＫ−履歴ゲームタイプ < Ｔ−ＰＬゲームタイプ(CNT)           
             ＦＬＧプール更新 := ＯＮ                                       
           OF: ＷＫ−履歴ゲームタイプ = Ｔ−ＰＬゲームタイプ(CNT)           
             IF: ＷＫ−履歴ブロックコード ,                                 
               < Ｔ−ＰＬブロックコード(CNT)                                
               ＦＬＧプール更新 := ＯＮ                                     
             END:                                                           
           END:                                                             
         END:                                                               
         IF: ＦＬＧプール更新 = ＯＮ                                        
           ECALL: HSAAL160 (VISUCA , VISFPTR ,                              
                                      プール計数一括更新ＰＲＭ)             
           IF: ＰＬＢＣＲＴＮＣＤ NOT = ZERO                                
             @ZCTABORT( MSGID  = #RT209 ,                                   
                        PROGID = HRCAL010 ,                                 
                        CNT    = 14 ,                                       
                        TEXT1  = ＰＬＢＣＲＴＮＣＤ );                      
           END:                                                             
           CALL: P812-RTN    ;トランザクション出力履歴ファイル更新          
           CALL: TRNSEND-RTN ;トランザクションエンド                        
         END:                                                               
       EXIT:                                                                
  *                                                                         
   SPACE:0                                                                  
   NOTE:                                                                    
     世代別ゲーム計数一括読込処理                                           
   NEND:                                                                    
   PROC:PB10-RTN                                                            
       ENTRY:                                                               
  * ファイルポインタ、レコード件数セット                                    
         IF: IDX-SEDAI = 世代Ａ                                             
            SET  FGMKSPTR  TO  FGMKSPTRA ; 更新用ファイルポインタ           
            ＷＫ−ＧＫレコード件数 := Ｔ−Ｇ１レコード件数                  
         ELSE:                                                              
            SET  FGMKSPTR  TO  FGMKSPTRB ; 更新用ファイルポインタ           
            ＷＫ−ＧＫレコード件数 := Ｔ−Ｇ２レコード件数                  
         END:                                                               
  * ゲーム計数一括更新レコードの格納件数分、繰り返し                        
         CNT := 1                                                           
         WHILE: CNT <= ＷＫ−ＧＫレコード件数                               
  *                                                                         
           IF: IDX-SEDAI = 世代Ａ                                           
              ＧＭＫＳゲームタイプ   := Ｔ−Ｇ１ゲームタイプ(CNT)           
              ＧＭＫＳブロックコード := Ｔ−Ｇ１ブロックコード(CNT)         
           ELSE:                                                            
              ＧＭＫＳゲームタイプ   := Ｔ−Ｇ２ゲームタイプ(CNT)           
              ＧＭＫＳブロックコード := Ｔ−Ｇ２ブロックコード(CNT)         
           END:                                                             
  * ゲーム計数ファイル更新                                                  
           READ  ゲーム計数ファイル  INVALID KEY CONTINUE                   
           IF:  ＳＴＳコード NOT = ZERO                                     
             ＷＫ−計数ゲームタイプ   := ＧＭＫＳゲームタイプ               
             ＷＫ−計数ブロックコード := ＧＭＫＳブロックコード             
             @ZCTABORT( MSGID  = #RT201 ,                                   
                        PROGID = HRCAL010 ,                                 
                        CNT    = 23 ,                                       
                        TEXT1  = "ｹﾞｰﾑｹｲｽｳﾌｧｲﾙ" ,                           
                        TEXT2  = ＷＫ−ＦＥＰ番号 ,                         
                        TEXT3  = IDX-SEDAI ,                                
                        TEXT4  = "READ" ,                                   
                        TEXT5  = ＷＫ−ゲーム計数キー ,                     
                        TEXT6  = ＳＴＳコード ,                             
                        TEXT7  = ＳＴＳ詳細 ) ;                             
           END:                                                             
  * ゲーム計数一括更新テーブルに再展開                                      
           IF: IDX-SEDAI = 世代Ａ                                           
              Ｔ−Ｇ１ゲーム計数Ｒ(CNT) := ゲーム計数Ｒ                     
           ELSE:                                                            
              Ｔ−Ｇ２ゲーム計数Ｒ(CNT) := ゲーム計数Ｒ                     
           END:                                                             
  *                                                                         
           CNT := CNT + 1                                                   
         END:                                                               
       EXIT:                                                                
  *                                                                         
   SPACE:0                                                                  
   NOTE:                                                                    
   手続き （レベル３）                                                      
   NEND:                                                                    
   NOTE:                                                                    
     発券レコード共通編集処理                                               
   NEND:                                                                    
   PROC:P321-RTN                                                            
       ENTRY:                                                               
  * 共通編集                                                                
         ＴＲＮＳレコードＩＤ        :=  発券ＩＤ                           
         ＴＲＮＳ取引日付            :=  ＷＫ１日付(CNT)                    
         ＴＲＮＳ取引時刻            :=  ＷＫ１時刻(CNT)                    
         ＴＲＮＳ受付日付            :=  ＷＫ１受付日付(CNT)                
         ＴＲＮＳ受付時刻            :=  ＷＫ１受付時刻(CNT)                
         ＴＲＮＳ売場コード          :=  ＷＫ１発信元ＩＤ(CNT)              
         ＴＲＮＳ販売員ＩＤ          :=  ＷＫ１販売員ＩＤ(CNT)              
         ＴＲＮＳ機種区分            :=  ＷＫ１機種区分(CNT)                
         ＴＲＮＳ販売チャネルコード  ,                                      
           :=  ＷＫ１販売チャネルコード(CNT)                                
         ＴＲＮＳ電文通番            :=  ＷＫ１電文通番(CNT)                
         CASE:  ＷＫ１入力方式１(CNT)                                       
         OF:  B"1"                                                          
              ＴＲＮＳ入力方式１      :=  "1"                               
         OF:  B"0"                                                          
              ＴＲＮＳ入力方式１      :=  "0"                               
         END:                                                               
         CASE:  ＷＫ１入力方式２(CNT)                                       
         OF:  B"1"                                                          
              ＴＲＮＳ入力方式２      :=  "1"                               
         OF:  B"0"                                                          
              ＴＲＮＳ入力方式２      :=  "0"                               
         END:                                                               
  *                                                                         
         ＴＲＮＳセンター状態    :=  ＷＫ−センター状態                     
         ＴＲＮＳレコード状態    :=  ＷＫ−レコード状態                     
  *                                                                         
         ＴＲＮＳゲーム種別      :=  Ｔ−ＧＴゲーム種別(IDX-GMTY)           
  *                                                                         
         ＴＲＮＳゲームタイプ    :=  Ｔ１００ゲームタイプ(CNT)              
         ＴＲＮＳブロックコード  :=  Ｔ１００ブロックコード(CNT)            
         ＴＲＮＳ口数            :=  Ｔ１００申込口数(CNT)                  
         ＴＲＮＳ障害取消通番    :=  Ｔ１００障害取消通番(CNT)              
         ＴＲＮＳ統計情報        :=  Ｔ１００統計情報(CNT)                  
         ＴＲＮＳロール番号      :=  Ｔ１００裏面番号１(CNT)                
  *                                                                         
         ＴＲＮＳ出力枚数        :=  Ｔ１０４識別コード数(CNT)              
       EXIT:                                                                
  *                                                                         
   SPACE:0                                                                  
   NOTE:                                                                    
     発券レコード個別編集処理                                               
   NEND:                                                                    
   PROC:P322-RTN                                                            
       ENTRY:                                                               
  * 識別コードの分割数カウンタ加算                                          
         ＣＮＴ−識別  :=  ＣＮＴ−識別 + 1                                 
  * 開始回号、当初継続回号数、実質継続回号数                                
         IF: ＦＬＧくじ券タイプ = 単独くじ券                                
            ＴＲＮＳ開始回号        :=  ＷＫ−回号                          
            ＴＲＮＳ当初継続回号数  :=  1                                   
         ELSE:   ; 継続くじ券                                               
            ＴＲＮＳ開始回号 ,                                              
              :=  ＷＫ−回号 - ＣＮＴ−当初継続回号数 + 1                   
            ＴＲＮＳ当初継続回号数  :=  ＣＮＴ−当初継続回号数              
         END:                                                               
         ＴＲＮＳ実質継続回号数  :=  ＴＲＮＳ当初継続回号数                 
  * 出力番号、連番、連番チェックディジット                                  
         ＴＲＮＳ出力番号  :=  ＣＮＴ−識別                                 
         IF: ＴＲＮＳ販売チャネルコード = 発券端末                          
            ＴＲＮＳ連番 ,                                                  
              :=  ＷＫ−チケット連番 + ＣＮＴ−識別 - 1                     
            ＷＫ−ＣＫＤロール番号 := ＴＲＮＳロール番号                    
            ＷＫ−ＣＫＤ連番       := ＴＲＮＳ連番                          
            DIVIDE  ＷＫ−ＣＫＤ計算９  BY  9  GIVING  ＷＫ−商             
                                        REMAINDER  ＷＫ−ＣＫＤ             
            IF: ＷＫ−ＣＫＤ = ZERO                                         
              ＴＲＮＳ連番チェックＤ := ＷＫ−ＣＫＤ                        
            ELSE:                                                           
              ＴＲＮＳ連番チェックＤ := 9 - ＷＫ−ＣＫＤ                    
            END:                                                            
         END:                                                               
  * パネル数、申込数字、クイックピック、申込タイプ                          
         IF: ＦＬＧパネル分割 = １−５パネル編集時                          
            IF: Ｔ１０５パネル数(CNT) > 5                                   
               ＴＲＮＳパネル数  :=  5                                      
            ELSE:                                                           
               ＴＲＮＳパネル数  :=  Ｔ１０５パネル数(CNT)                  
            END:                                                            
            CNT-PANEL := 1                                                  
            WHILE: CNT-PANEL  <= ＴＲＮＳパネル数                           
              ＴＲＮＳ申込数字(CNT-PANEL) ,                                 
                :=  Ｔ１０５申込数字(CNT CNT-PANEL)                         
              ＴＲＮＳクイックピック区分(CNT-PANEL) ,                       
                :=  Ｔ１０５クイックピック(CNT CNT-PANEL)                   
              ＴＲＮＳ申込タイプ(CNT-PANEL) ,                               
                :=  Ｔ１０５申込タイプ(CNT CNT-PANEL)                       
              CNT-PANEL  :=  CNT-PANEL + 1                                  
            END:                                                            
         ELSE:  ; ６−７パネル編集時                                        
            ＴＲＮＳパネル数  :=  Ｔ１０５パネル数(CNT) - 5                 
  * １−５パネル編集時の申込明細の内容を初期化                              
            INITIALIZE  ＴＲＮＳ申込情報.                                   
            CNT-PANEL := 1                                                  
            WHILE:CNT-PANEL  <= ＴＲＮＳパネル数                            
              ＴＲＮＳ申込数字(CNT-PANEL) ,                                 
                := Ｔ１０５申込数字(CNT CNT-PANEL + 5)                      
              ＴＲＮＳクイックピック区分(CNT-PANEL) ,                       
                := Ｔ１０５クイックピック(CNT CNT-PANEL + 5)                
              ＴＲＮＳ申込タイプ(CNT-PANEL) ,                               
                := Ｔ１０５申込タイプ(CNT CNT-PANEL + 5)                    
              CNT-PANEL  :=  CNT-PANEL + 1                                  
            END:                                                            
         END:                                                               
  * 識別コード、旧識別コード、識別コード区分                                
  * 識別コード体系変換                                                      
         ＷＫ−変換前識別コード ,                                           
           :=  Ｔ１０４識別コード(CNT ＣＮＴ−識別)                         
         CALL: ZMSSRLCV-RTN  ; 識別コード変換処理                           
         ＴＲＮＳ識別コード  := ＷＫ−変換後識別コード                      
         IF: ＷＫ−変換前識別コード下 NOT = ZERO                            
            ＴＲＮＳ識別コード区分 :=  ２４桁                               
         ELSE:                                                              
            ＴＲＮＳ識別コード区分 :=  １６桁                               
            ＴＲＮＳ旧識別コード上 :=  ＷＫ−変換前識別コード上             
            ＴＲＮＳ旧識別コード下 :=  ＷＫ−変換前識別コード中             
         END:                                                               
  * セキュリティコード                                                      
         ＴＲＮＳセキュリティコード ,                                       
           := Ｔ１０３ハッシュ値(CNT ＣＮＴ−識別)                          
  * 分子、分母、金額                                                        
         IDX-KAIGOU := ＷＫ−回号 - 退避ＧＫ先頭回号 + 1                    
         ＴＲＮＳ分子      :=  退避ＧＫ分子数(IDX-KAIGOU)                   
         ＴＲＮＳ分母      :=  退避ＧＫ分母数(IDX-KAIGOU)                   
         IF: ＦＬＧロトコンビ  = ＯＮ                                       
            @ZSNCNBMP(BUNSI  =  ＴＲＮＳ分子 ,                              
                      BUNBO  =  ＴＲＮＳ分母 ,                              
                      RTYPE  =  ＴＲＮＳ申込タイプ(1) ,                     
                      RNUMS  =  ＷＫ−申込通り数 );                         
            ＴＲＮＳ金額  :=  ＷＫ−申込通り数 ,                            
              * 退避ＧＫ単価(IDX-KAIGOU)                                    
         ELSE:  ; ロトコンビ以外                                            
            ＴＲＮＳ金額  :=  ＴＲＮＳパネル数 * ＴＲＮＳ口数 ,             
                                * ＴＲＮＳ当初継続回号数                    
                                   * 退避ＧＫ単価(IDX-KAIGOU)               
         END:                                                               
  * 分割識別コード（６パネル以上のチケットの場合のみセット）                
         IF: Ｔ１０５パネル数(CNT) > 5                                      
            IF: ＦＬＧパネル分割 = １−５パネル編集時                       
  * 識別コード体系変換                                                      
               ＷＫ−変換前識別コード ,                                     
                 :=  Ｔ１０４識別コード(CNT ＣＮＴ−識別 + 1)               
               CALL: ZMSSRLCV-RTN  ; 識別コード変換処理                     
               ＴＲＮＳ分割識別コード  := ＷＫ−変換後識別コード            
            ELSE: ; ６−７パネル編集時                                      
  * 識別コード体系変換                                                      
               ＷＫ−変換前識別コード ,                                     
                 :=  Ｔ１０４識別コード(CNT ＣＮＴ−識別 - 1)               
               CALL: ZMSSRLCV-RTN  ; 識別コード変換処理                     
               ＴＲＮＳ分割識別コード  := ＷＫ−変換後識別コード            
            END:                                                            
         END:                                                               
  * トランザクションレコード退避                                            
         Ｔ−ＴＲレコード件数 :=  Ｔ−ＴＲレコード件数  +  1                
         Ｔ−ＴＲトランザクションＲ(Ｔ−ＴＲレコード件数) ,                 
           :=  トランザクションＲ                                           
  * トランザクションテーブルと発券電文テーブルのリンクをとるため            
  * 発券電文の発券電文テーブル内の格納位置をセットしておく                  
         Ｔ−ＴＲ発券電文ＴＣＮＴ(Ｔ−ＴＲレコード件数) := CNT              
  * 電文有無フラグ更新（P400,P500,P700-RTNにて参照)                         
         ＷＫ−世代判定業務日付 := ＴＲＮＳ受付日付                         
         CALL: SEDAI-RTN ; 世代区分判定処理                                 
         ＷＫ−識別コード中 :=  ＴＲＮＳ識別コード中                        
  *                                                                         
         ＦＬＧ世代別電文有無(ＷＫ−世代区分)          :=  ＯＮ             
         ＦＬＧＦＥＰ別電文有無(ＷＫ−識別ＦＥＰ番号)  :=  ＯＮ             
         ＦＬＧ世別Ｆ別Ｃ別電文有無(ＷＫ−世代区分 ,                        
                       ＷＫ−識別ＦＥＰ番号 ,                               
                         ＴＲＮＳ販売チャネルコード)   :=  ＯＮ             
  * ＷＫ１発券金額加算                                                      
  *   電文単位の発券金額を累計する。                                        
  *   P600-RTNにて発券申込のパラメータにセット                              
         ＷＫ１発券金額(CNT) ,                                              
           :=  ＷＫ１発券金額(CNT) + ＴＲＮＳ金額                           
       EXIT:                                                                
  *                                                                         
   SPACE:0                                                                  
   NOTE:                                                                    
     発券取消レコード編集処理                                               
   NEND:                                                                    
   PROC:P331-RTN                                                            
       ENTRY:                                                               
  *                                                                         
         ＴＲＮＳレコードＩＤ      := 発券取消ＩＤ                          
         ＴＲＮＳゲームタイプ      := Ｔ１２０ゲームタイプ(CNT)             
         ＴＲＮＳブロックコード    := Ｔ１２０ブロックコード(CNT)           
         ＴＲＮＳ開始回号          := Ｔ１２０開始回号(CNT)                 
         ＴＲＮＳ当初継続回号数    := Ｔ１２０継続回号数(CNT)               
         ＴＲＮＳ実質継続回号数    := Ｔ１２０継続回号数(CNT)               
         ＴＲＮＳ金額              := Ｔ１２０発券取消金額(CNT)             
         ＴＲＮＳ取消区分          :=  0     ;通常取消                      
  * 識別コード                                                              
         ＷＫ−変換前識別コード ,                                           
           := Ｔ１２０発券取消識別コード(CNT)                               
         CALL: ZMSSRLCV-RTN  ; 識別コード変換処理                           
         ＴＲＮＳ識別コード  := ＷＫ−変換後識別コード                      
  * 発券識別コード、旧識別コード、識別コード区分                            
         ＷＫ−変換前識別コード  := Ｔ１２０識別コード(CNT)                 
         CALL: ZMSSRLCV-RTN  ; 識別コード変換処理                           
         ＴＲＮＳ発券識別コード  := ＷＫ−変換後識別コード                  
         IF: ＷＫ−変換前識別コード下 NOT = ZERO                            
            ＴＲＮＳ識別コード区分 :=  ２４桁                               
         ELSE:                                                              
            ＴＲＮＳ識別コード区分 :=  １６桁                               
            ＴＲＮＳ旧識別コード上 :=  ＷＫ−変換前識別コード上             
            ＴＲＮＳ旧識別コード下 :=  ＷＫ−変換前識別コード中             
         END:                                                               
       EXIT:                                                                
  *                                                                         
   SPACE:0                                                                  
   NOTE:                                                                    
     支払レコード編集処理                                                   
   NEND:                                                                    
   PROC:P332-RTN                                                            
       ENTRY:                                                               
  * ゲーム種別                                                              
  * 前回処理した要求電文とゲームタイプが異なる場合のみ、                    
  * ゲーム種別を取得                                                        
         IF: ＷＫ−ゲームタイプ NOT = Ｔ２１０ゲームタイプ(CNT)             
            ＷＫ−ゲームタイプ    :=  Ｔ２１０ゲームタイプ(CNT)             
            CALL:IDX-GMTYSET-RTN                                            
              ; ゲームタイプテーブル添字セット処理                          
         END:                                                               
         ＴＲＮＳゲーム種別      :=  Ｔ−ＧＴゲーム種別(IDX-GMTY)           
  *                                                                         
         IF:  Ｔ２１０支払フラグ(CNT)  =  期限後支払                        
              ＴＲＮＳレコードＩＤ    :=  期限後支払ＩＤ                    
         ELSE:                                                              
              ＴＲＮＳレコードＩＤ    :=  支払ＩＤ                          
         END:                                                               
  *                                                                         
         ＴＲＮＳゲームタイプ      := Ｔ２１０ゲームタイプ(CNT)             
         ＴＲＮＳブロックコード    := Ｔ２１０ブロックコード(CNT)           
         ＴＲＮＳ口数              := Ｔ２１０申込口数(CNT)                 
         ＴＲＮＳ開始回号          := Ｔ２１０回号(CNT 1)                   
         ＴＲＮＳロール番号        := Ｔ２１０裏面番号１(CNT)               
  *                                                                         
         ＷＫ−連番ＣＤ分解        := Ｔ２１０裏面番号２(CNT)               
         ＴＲＮＳ連番              := ＷＫ−チケット連番                    
         ＷＫ−ＣＫＤロール番号    := ＴＲＮＳロール番号                    
         ＷＫ−ＣＫＤ連番          := ＴＲＮＳ連番                          
         DIVIDE  ＷＫ−ＣＫＤ計算９  BY  9  GIVING  ＷＫ−商                
                                     REMAINDER  ＷＫ−ＣＫＤ                
         IF: ＷＫ−ＣＫＤ = ZERO                                            
           ＴＲＮＳ連番チェックＤ  := ＷＫ−ＣＫＤ                          
         ELSE:                                                              
           ＴＲＮＳ連番チェックＤ  := 9 - ＷＫ−ＣＫＤ                      
         END:                                                               
  * 識別コード                                                              
         ＷＫ−変換前識別コード ,                                           
           := Ｔ２１０支払識別コード(CNT)                                   
         CALL: ZMSSRLCV-RTN  ; 識別コード変換処理                           
         ＴＲＮＳ識別コード  := ＷＫ−変換後識別コード                      
  * 発券識別コード、旧識別コード、識別コード区分                            
         ＷＫ−変換前識別コード  := Ｔ２１０識別コード(CNT)                 
         CALL: ZMSSRLCV-RTN  ; 識別コード変換処理                           
         ＴＲＮＳ発券識別コード  := ＷＫ−変換後識別コード                  
         IF: ＷＫ−変換前識別コード下 NOT = ZERO                            
            ＴＲＮＳ識別コード区分 :=  ２４桁                               
         ELSE:                                                              
            ＴＲＮＳ識別コード区分 :=  １６桁                               
            ＴＲＮＳ旧識別コード上 :=  ＷＫ−変換前識別コード上             
            ＴＲＮＳ旧識別コード下 :=  ＷＫ−変換前識別コード中             
         END:                                                               
  * 金額                                                                    
  * Ｔ２１０支払金額の属性 X(14) をＷＫ−金額 9(14) へ変換後、セット        
         ＷＫ−金額９              := Ｔ２１０支払金額(CNT)                 
         ＴＲＮＳ金額              := ＷＫ−金額９                          
  * 当せん等級、コンビ当せん等級、当初継続回号数、パネル数                  
  * （バッチ処理の売上集計処理(HBHUN370)にて、支払レコードより              
  *   支払関連の集計を行う為に、以下の項目に値をセットする）                
         IF: Ｔ２１０当せん口数(CNT 1) NOT = 0                              
  * ロトコンビの場合                                                        
            ＴＲＮＳ当初継続回号数    := 1                                  
            ＴＲＮＳパネル数          := 1                                  
            CNT-PANEL := 1                                                  
            WHILE:CNT-PANEL  <= Ｔ２１０当せん数(CNT)                       
              ＷＫ−等級Ｘ  :=  Ｔ２１０等級(CNT CNT-PANEL)                 
              CALL:TOUKYU-RTN  ;  当せん等級算出処理                        
              ＴＲＮＳコンビ当せん口数(ＷＫ−等級９) ,                      
                 := Ｔ２１０当せん口数(CNT CNT-PANEL)                       
              IF: CNT-PANEL = Ｔ２１０当せん数(CNT)                         
                 ＴＲＮＳコンビ最下位当等級 := ＷＫ−等級９                 
              END:                                                          
              CNT-PANEL := CNT-PANEL + 1                                    
            END:                                                            
  * ロトコンビ以外の場合                                                    
         ELSE:                                                              
            ＴＲＮＳ当初継続回号数    := 1                                  
            ＴＲＮＳパネル数          := Ｔ２１０当せん数(CNT)              
            CNT-PANEL := 1                                                  
            WHILE:CNT-PANEL  <= Ｔ２１０当せん数(CNT)                       
              ＷＫ−等級Ｘ  :=  Ｔ２１０等級(CNT CNT-PANEL)                 
              CALL:TOUKYU-RTN  ;  当せん等級算出処理                        
              IF: Ｔ２１０回号(CNT CNT-PANEL) = Ｔ２１０回号(CNT 1)         
  * 単独くじ券、継続くじ券の１番目の当せん明細に対する処理の場合            
  * または、単独くじ券の２番目以降の当せん明細に対する処理の場合            
  * （複数パネル当せん）                                                    
                 ＴＲＮＳ当せん等級(CNT-PANEL)  :=  ＷＫ−等級９            
              ELSE:                                                         
  * 継続くじ券の２番目以降の当せん明細に対する処理の場合                    
  * （継続申込複数当せん）                                                  
                 ＷＫ−格納位置 := Ｔ２１０回号(CNT CNT-PANEL) ,            
                   - Ｔ２１０回号(CNT 1) + 1                                
                 ＴＲＮＳ当せん等級(ＷＫ−格納位置) ,                       
                   :=  ＷＫ−等級９                                         
                 ＴＲＮＳ当初継続回号数    := ＷＫ−格納位置                
                 ＴＲＮＳパネル数          := 1                             
              END:                                                          
              CNT-PANEL := CNT-PANEL + 1                                    
            END:                                                            
         END:                                                               
  * 取消支払情報                                                            
         ＴＲＮＳ取消支払売場コード   :=  ＷＫ２発信元ＩＤ(CNT)             
         ＴＲＮＳ取消支払販売員ＩＤ   :=  ＷＫ２販売員ＩＤ(CNT)             
         ＴＲＮＳ取消支払取引日付     :=  ＷＫ２日付(CNT)                   
         ＴＲＮＳ取消支払取引時刻     :=  ＷＫ２時刻(CNT)                   
         ＴＲＮＳ取消支払受付日付     :=  ＷＫ２受付日付(CNT)               
         ＴＲＮＳ取消支払受付時刻     :=  ＷＫ２受付時刻(CNT)               
         ＴＲＮＳ取消支払ＦＥＰ番号   :=  ＷＫ−ＦＥＰ番号                  
         ＴＲＮＳ取消支払パス通番     :=  ＷＫ−パス番号                    
         ＴＲＮＳ取消支払Ｃ状態       :=  ＷＫ−センター状態                
       EXIT:                                                                
  *                                                                         
   SPACE:0                                                                  
   NOTE:                                                                    
     代替券レコード編集処理                                                 
   NEND:                                                                    
   PROC:P333-RTN                                                            
       ENTRY:                                                               
  * ゲーム種別                                                              
  * 前回処理した要求電文とゲームタイプが異なる場合のみ、                    
  * ゲーム種別を取得                                                        
         IF: ＷＫ−ゲームタイプ NOT = Ｔ２２１ゲームタイプ(CNT)             
            ＷＫ−ゲームタイプ    :=  Ｔ２２１ゲームタイプ(CNT)             
            CALL:IDX-GMTYSET-RTN                                            
              ; ゲームタイプテーブル添字セット処理                          
         END:                                                               
         ＴＲＮＳゲーム種別      :=  Ｔ−ＧＴゲーム種別(IDX-GMTY)           
  *                                                                         
         ＴＲＮＳレコードＩＤ    := 代替券ＩＤ                              
         ＴＲＮＳ出力番号        := 1                                       
         ＴＲＮＳ出力枚数        := 1                                       
         ＴＲＮＳパネル数        := 1                                       
  *                                                                         
         ＴＲＮＳゲームタイプ     := Ｔ２２１ゲームタイプ(CNT)              
         ＴＲＮＳブロックコード   := Ｔ２２１ブロックコード(CNT)            
         ＴＲＮＳ開始回号         := Ｔ２２１未抽せん開始回号(CNT)          
         ＴＲＮＳ当初継続回号数   := Ｔ２２１未抽せん回号数(CNT)            
         ＴＲＮＳ実質継続回号数   := Ｔ２２１未抽せん回号数(CNT)            
         ＴＲＮＳ口数             := Ｔ２２１申込口数(CNT)                  
         ＴＲＮＳセキュリティコード  := Ｔ２２１ハッシュ値(CNT)             
         ＴＲＮＳ障害取消通番     := Ｔ２２１障害取消通番(CNT)              
         ＴＲＮＳロール番号       := Ｔ２２１裏面番号１(CNT)                
  *                                                                         
         ＷＫ−連番ＣＤ分解      := Ｔ２２１裏面番号２(CNT)                 
         ＴＲＮＳ連番            := ＷＫ−チケット連番                      
         ＷＫ−ＣＫＤロール番号  := ＴＲＮＳロール番号                      
         ＷＫ−ＣＫＤ連番        := ＴＲＮＳ連番                            
         DIVIDE  ＷＫ−ＣＫＤ計算９  BY  9  GIVING  ＷＫ−商                
                                     REMAINDER  ＷＫ−ＣＫＤ                
         IF: ＷＫ−ＣＫＤ = ZERO                                            
           ＴＲＮＳ連番チェックＤ := ＷＫ−ＣＫＤ                           
         ELSE:                                                              
           ＴＲＮＳ連番チェックＤ := 9 - ＷＫ−ＣＫＤ                       
         END:                                                               
  * 識別コード、旧識別コード、識別コード区分                                
         ＷＫ−変換前識別コード ,                                           
           := Ｔ２２１代替券識別コード(CNT)                                 
         CALL: ZMSSRLCV-RTN  ; 識別コード変換処理                           
         ＴＲＮＳ識別コード  := ＷＫ−変換後識別コード                      
         IF: ＷＫ−変換前識別コード下 NOT = ZERO                            
            ＴＲＮＳ識別コード区分 :=  ２４桁                               
         ELSE:                                                              
            ＴＲＮＳ識別コード区分 :=  １６桁                               
            ＴＲＮＳ旧識別コード上 :=  ＷＫ−変換前識別コード上             
            ＴＲＮＳ旧識別コード下 :=  ＷＫ−変換前識別コード中             
         END:                                                               
  * 発券識別コード                                                          
         IF: Ｔ２２１前識別コード(CNT)  NOT =  LOW-VALUE                    
            ＷＫ−変換前識別コード  := Ｔ２２１前識別コード(CNT)            
            CALL: ZMSSRLCV-RTN  ; 識別コード変換処理                        
            ＴＲＮＳ発券識別コード  := ＷＫ−変換後識別コード               
         END:                                                               
  * 申込数字、クイックピック、申込タイプ                                    
         ＴＲＮＳ申込数字(1)    := Ｔ２２１申込数字(CNT)                    
         ＴＲＮＳクイックピック区分(1) ,                                    
           := Ｔ２２１クイックピック(CNT)                                   
         ＴＲＮＳ申込タイプ(1)  := Ｔ２２１申込タイプ(CNT)                  
       EXIT:                                                                
  *                                                                         
   SPACE:0                                                                  
   NOTE:                                                                    
     支払取消レコード編集                                                   
   NEND:                                                                    
   PROC:P334-RTN                                                            
       ENTRY:                                                               
  * 支払取消レコード編集                                                    
         ＴＲＮＳレコードＩＤ      := 支払取消ＩＤ                          
         ＴＲＮＳゲームタイプ      := Ｔ２４０ゲームタイプ(CNT)             
         ＴＲＮＳブロックコード    := Ｔ２４０ブロックコード(CNT)           
         ＴＲＮＳ取消区分          :=  0           ;通常                    
  * 識別コード                                                              
         ＷＫ−変換前識別コード ,                                           
           := Ｔ２４０支払取消識別コード(CNT)                               
         CALL: ZMSSRLCV-RTN  ; 識別コード変換処理                           
         ＴＲＮＳ識別コード  := ＷＫ−変換後識別コード                      
  * 発券識別コード、旧識別コード、識別コード区分                            
         ＷＫ−変換前識別コード  := Ｔ２４０識別コード(CNT)                 
         CALL: ZMSSRLCV-RTN  ; 識別コード変換処理                           
         ＴＲＮＳ発券識別コード  := ＷＫ−変換後識別コード                  
         IF: ＷＫ−変換前識別コード下 NOT = ZERO                            
            ＴＲＮＳ識別コード区分 :=  ２４桁                               
         ELSE:                                                              
            ＴＲＮＳ識別コード区分 :=  １６桁                               
            ＴＲＮＳ旧識別コード上 :=  ＷＫ−変換前識別コード上             
            ＴＲＮＳ旧識別コード下 :=  ＷＫ−変換前識別コード中             
         END:                                                               
  * 代替識別コード                                                          
         IF: Ｔ２４０代替券識別コード(CNT)  NOT =  LOW-VALUE                
            ＷＫ−変換前識別コード ,                                        
              := Ｔ２４０代替券識別コード(CNT)                              
            CALL: ZMSSRLCV-RTN  ; 識別コード変換処理                        
            ＴＲＮＳ代替識別コード  := ＷＫ−変換後識別コード               
         END:                                                               
       EXIT:                                                                
  *                                                                         
   SPACE:0                                                                  
   NOTE:                                                                    
   プール計数一括更新チェック処理                                           
   NEND:                                                                    
   PROC:P811-RTN                                                            
       ENTRY:                                                               
  * 前回のプール計数ファイル更新情報を取得し                                
  * 未更新分のプール計数ファイルを更新する。                                
         IDX-SEDAI := 1                                                     
         WHILE: IDX-SEDAI <= 2                                              
           CNT-FEP := 1                                                     
           WHILE: CNT-FEP <= ＰＡＴＨＦＥＰ台数                             
             CNT-CHANNEL := 1                                               
             WHILE: CNT-CHANNEL <= ＣＨＡＮ販売チャネル数                     
               IF: ＦＬＧ世別Ｆ別Ｃ別電文有無 ,                             
                   (IDX-SEDAI CNT-FEP CNT-CHANNEL) = ＯＮ                     
  ;トランザクション出力履歴ファイル読込処理                                 
                  CALL: TRSYRI-READ-RTN                                     
                  ＷＫ−履歴ゲームタイプ   := ,                             
                    ＴＲＳＲゲームタイプ ,                                  
                     (IDX-SEDAI ＷＫ−ＦＥＰ番号 ＷＫ−パス番号)            
                  ＷＫ−履歴ブロックコード := ,                             
                    ＴＲＳＲブロックコード ,                                
                     (IDX-SEDAI ＷＫ−ＦＥＰ番号 ＷＫ−パス番号)            
                  RETURN:                                                   
               END:                                                         
               CNT-CHANNEL := CNT-CHANNEL + 1                               
             END:                                                           
             CNT-FEP := CNT-FEP + 1                                         
           END:                                                             
           IDX-SEDAI := IDX-SEDAI + 1                                       
         END:                                                               
       EXIT:                                                                
  *                                                                         
   SPACE:0                                                                  
   NOTE:                                                                    
   トランザクション出力履歴ファイル更新処理                                 
   NEND:                                                                    
   PROC:P812-RTN                                                            
       ENTRY:                                                               
  * トランザクション出力履歴ファイルに                                      
  * プール計数ファイルの更新情報をを登録する。                              
         IDX-SEDAI := 1                                                     
         WHILE: IDX-SEDAI <= 2                                              
           CNT-FEP := 1                                                     
           WHILE: CNT-FEP <= ＰＡＴＨＦＥＰ台数                             
             CNT-CHANNEL := 1                                               
             WHILE: CNT-CHANNEL <= ＣＨＡＮ販売チャネル数                     
               IF: ＦＬＧ世別Ｆ別Ｃ別電文有無 ,                             
                   (IDX-SEDAI CNT-FEP CNT-CHANNEL) = ＯＮ                     
  ;トランザクション出力履歴ファイル読込処理                                 
                 CALL: TRSYRI-READ-RTN                                      
                 ＴＲＳＲゲームタイプ ,                                     
                   (IDX-SEDAI ＷＫ−ＦＥＰ番号 ＷＫ−パス番号) ,            
                     := Ｔ−ＰＬゲームタイプ(CNT)                           
                 ＴＲＳＲブロックコード ,                                   
                   (IDX-SEDAI ＷＫ−ＦＥＰ番号 ＷＫ−パス番号) ,            
                     := Ｔ−ＰＬブロックコード(CNT)                         
  ;トランザクション出力履歴ファイル更新処理                                 
                 CALL: TRSYRI-REWRITE-RTN                                   
               END:                                                         
               CNT-CHANNEL := CNT-CHANNEL + 1                               
             END:                                                           
             CNT-FEP := CNT-FEP + 1                                         
           END:                                                             
           IDX-SEDAI := IDX-SEDAI + 1                                       
         END:                                                               
       EXIT:                                                                
  *                                                                         
   SPACE:0                                                                  
   NOTE:                                                                    
   共通ルーチン                                                             
   NEND:                                                                    
   NOTE:                                                                    
   トランザクションエンド                                                   
   NEND:                                                                    
   PROC:TRNSEND-RTN                                                         
       ENTRY:                                                               
         TRNS-ENDKEY               := ZERO                                  
         TRNS-FUNCTION             := "TRNS"                                
         ECALL: A_VIS_CBL (VISUCA  TRNS-ENDKEY )                            
         IF:  TRNS-FSTATUS  NOT = "00" AND "01"                             
           @ZCTABORT( MSGID  = #RT236 ,                                     
                      PROGID = HRCAL010 ,                                   
                      CNT    = 18 ,                                         
                      TEXT1  = TRNS-FSTATUS ) ;                             
         END:                                                               
       EXIT:                                                                
  *                                                                         
  *                                                                         
   NOTE:                                                                    
   識別コード変換処理                                                       
   NEND:                                                                    
   PROC:ZMSSRLCV-RTN                                                        
       ENTRY:                                                               
  * ２４桁の識別コードの場合、識別コード変換は不要                          
         IF: ＷＫ−変換前識別コード下 NOT = ZERO                              
            ＷＫ−変換後識別コード := ＷＫ−変換前識別コード                
         ELSE:                                                              
  * １６桁の識別コードの場合、１６桁→２４桁へ識別コード変換                  
            IF: ＦＬＧ識別変換ＰＴＲセット  =  ＯＦＦ                           
  * 本サブルーチンを始めてコールした際、パラメータのポインタをセット        
               SET PTR_SBCDBEFORE TO ,                                      
                    ADDRESS OF ＷＫ−１６桁識別コード                       
               SET PTR_SBCDAFTER  TO ,                                      
                    ADDRESS OF ＷＫ−２４桁識別コード                       
               ＦＬＧ識別変換ＰＴＲセット  :=  ＯＮ                         
            END:                                                            
  *                                                                         
            ＷＫ−１６桁識別コード上 := ＷＫ−変換前識別コード上            
            ＷＫ−１６桁識別コード下 := ＷＫ−変換前識別コード中            
  * 識別コード変換部品呼出                                                  
            @ZMSSRLCV(MODE = 2 ,                                            
                      SBCDBEFORE  = PTR_SBCDBEFORE  ,                       
                      SBCDAFTER   = PTR_SBCDAFTER  ) ;                      
            ＷＫ−変換後識別コード上 := ＷＫ−２４桁識別コード上            
            ＷＫ−変換後識別コード中 := ＷＫ−２４桁識別コード中            
            ＷＫ−変換後識別コード下 := ＷＫ−２４桁識別コード下            
         END:                                                               
       EXIT:                                                                
  *                                                                         
   SPACE:0                                                                  
   NOTE:                                                                    
   ゲームタイプテーブル添字セット処理                                       
   NEND:                                                                    
   PROC:IDX-GMTYSET-RTN                                                     
       ENTRY:                                                               
         IDX-GMTY   := 0                                                    
         ＦＬＧ一致 := ＯＦＦ                                               
         WHILE: IDX-GMTY <= Ｔ−ＧＴレコード件数  AND  ,                    
                ＦＬＧ一致 = ＯＦＦ                                         
           IDX-GMTY := IDX-GMTY + 1                                         
           IF: Ｔ−ＧＴゲームタイプ(IDX-GMTY) = ＷＫ−ゲームタイプ          
             ＦＬＧ一致 := ＯＮ                                             
           END:                                                             
         END:                                                               
       EXIT:                                                                
  *                                                                         
   SPACE:0                                                                  
   NOTE:                                                                    
   ゲームタイプファイル読込処理                                             
   NEND:                                                                    
   PROC:GMTY-READ-RTN                                                       
       ENTRY:                                                               
  * ゲームタイプファイル読込                                                
         ＧＭＴＹゲームタイプ  :=  ＣＤＣＫ変換後入力電文(49:2)             
         READ ゲームタイプファイル                                          
           INVALID KEY CONTINUE.                                            
         CASE: ＳＴＳコード                                                 
         OF: ZERO       ;正常                                               
         OTHER:         ;その他                                             
           @ZCTABORT( MSGID  = #RT201 ,                                     
                      PROGID = HRCAL010 ,                                   
                      CNT    = 21       ,                                   
                      TEXT1  = "ｹﾞｰﾑﾀｲﾌﾟF" ,                                
                      TEXT2  = "-" ,                                        
                      TEXT3  = "-" ,                                        
                      TEXT4  = "READ" ,                                     
                      TEXT5  = ＧＭＴＹゲームタイプ ,                       
                      TEXT6  = ＳＴＳコード ,                               
                      TEXT7  = ＳＴＳ詳細 );                                
         END:                                                               
  * ゲームタイプテーブルセット処理                                          
         Ｔ−ＧＴレコード件数 := 1                                          
         Ｔ−ＧＴゲームタイプＲ(1) := ゲームタイプＲ                        
       EXIT:                                                                
  *                                                                         
   SPACE:0                                                                  
   NOTE:                                                                    
   ゲーム計数レコードセット処理                                             
   NEND:                                                                    
   PROC:GMKS-SET-RTN                                                        
       ENTRY:                                                               
  * 世代区分セット                                                          
         IF: ＷＫ−日付 = Ｔ−ＳＵ業務日付(1)                               
            IDX-GMKS   := 0                                                 
            ＦＬＧ一致 := ＯＦＦ                                            
            WHILE: IDX-GMKS <= Ｔ−Ｇ１レコード件数  AND  ,                 
                   ＦＬＧ一致 = ＯＦＦ                                      
              IDX-GMKS := IDX-GMKS + 1                                      
              IF: Ｔ−Ｇ１ゲームタイプ(IDX-GMKS) ,                          
                    = ＷＫ−ゲームタイプ  AND ,                             
                  Ｔ−Ｇ１ブロックコード(IDX-GMKS) ,                        
                    = ＷＫ−ブロックコード                                  
                ＦＬＧ一致 := ＯＮ                                          
              END:                                                          
            END:                                                            
            退避ＧＫゲーム計数Ｒ := Ｔ−Ｇ１ゲーム計数Ｒ(IDX-GMKS)          
         ELSE:                                                              
            IDX-GMKS   := 0                                                 
            ＦＬＧ一致 := ＯＦＦ                                            
            WHILE: IDX-GMKS <= Ｔ−Ｇ２レコード件数  AND  ,                 
                   ＦＬＧ一致 = ＯＦＦ                                      
              IDX-GMKS := IDX-GMKS + 1                                      
              IF: Ｔ−Ｇ２ゲームタイプ(IDX-GMKS) ,                          
                    = ＷＫ−ゲームタイプ  AND ,                             
                  Ｔ−Ｇ２ブロックコード(IDX-GMKS) ,                        
                    = ＷＫ−ブロックコード                                  
                ＦＬＧ一致 := ＯＮ                                          
              END:                                                          
            END:                                                            
            退避ＧＫゲーム計数Ｒ := Ｔ−Ｇ２ゲーム計数Ｒ(IDX-GMKS)          
         END:                                                               
       EXIT:                                                                
  *                                                                         
   SPACE:0                                                                  
   NOTE:                                                                    
   ゲーム計数レコード読込処理                                               
   NEND:                                                                    
   PROC:GMKS-READ-RTN                                                       
       ENTRY:                                                               
  * ゲーム計数ファイル読込処理                                              
         ＷＫ−世代判定業務日付 := ＣＤＣＫ受付日付                         
         CALL: SEDAI-RTN  ; 世代区分判定処理                                
  *                                                                         
         CASE: ＷＫ−世代区分                                               
         OF: 世代Ａ                                                         
           SET  FGMKSPTR  TO  FGMKSPTRA                                     
         OF: 世代Ｂ                                                         
           SET  FGMKSPTR  TO  FGMKSPTRB                                     
         END:                                                               
         ＧＭＫＳゲームタイプ    :=  ＣＤＣＫ変換後入力電文(49:2)           
         ＷＫ−ブロックコードＸ  :=  ＣＤＣＫ変換後入力電文(51:2)           
         ＧＭＫＳブロックコード  :=  ＷＫ−ブロックコード９                 
         READ ゲーム計数ファイル                                            
           INVALID KEY CONTINUE.                                            
         CASE: ＳＴＳコード                                                 
         OF: ZERO       ;正常                                               
         OTHER:         ;その他                                             
           ＷＫ−計数ゲームタイプ   := ＧＭＫＳゲームタイプ                 
           ＷＫ−計数ブロックコード := ＧＭＫＳブロックコード               
           @ZCTABORT( MSGID  = #RT201 ,                                     
                      PROGID = HRCAL010 ,                                   
                      CNT    = 22       ,                                   
                      TEXT1  = "ｹﾞｰﾑｹｲｽｳF" ,                                
                      TEXT2  = "-" ,                                        
                      TEXT3  = ＷＫ−世代区分 ,                             
                      TEXT4  = "READ" ,                                     
                      TEXT5  = ＷＫ−ゲーム計数キー ,                       
                      TEXT6  = ＳＴＳコード ,                               
                      TEXT7  = ＳＴＳ詳細 );                                
             ＣＤＣＫＲＴＮＣＤ := "99"                                     
             RETURN:S                                                       
         END:                                                               
  * ゲーム計数テーブルセット処理                                            
         CASE: ＷＫ−世代区分                                               
         OF: 世代Ａ                                                         
           Ｔ−Ｇ１レコード件数     := 1                                    
           Ｔ−Ｇ１ゲーム計数Ｒ(1)  := ゲーム計数Ｒ                         
         OF: 世代Ｂ                                                         
           Ｔ−Ｇ２レコード件数     := 1                                    
           Ｔ−Ｇ２ゲーム計数Ｒ(1)  :=  ゲーム計数Ｒ                        
         END:                                                               
       EXIT:                                                                
  *                                                                         
   SPACE:0                                                                  
   NOTE:                                                                    
   世代区分判定処理                                                         
   NEND:                                                                    
   PROC:SEDAI-RTN                                                           
       ENTRY:                                                               
         CASE: ＷＫ−世代判定業務日付                                       
          OF: Ｔ−ＳＵ業務日付(1)                                           
            ＷＫ−世代区分  := 世代Ａ                                       
          OF: Ｔ−ＳＵ業務日付(2)                                           
            ＷＫ−世代区分  := 世代Ｂ                                       
         END:                                                               
       EXIT:                                                                
  *                                                                         
   SPACE:0                                                                  
   NOTE:                                                                    
   当せん等級算出処理                                                       
   NEND:                                                                    
   PROC:TOUKYU-RTN                                                          
       ENTRY:                                                               
         CASE: ＴＲＮＳゲーム種別                                           
         OF: ナンバーズ                                                     
           CASE: ＷＫ−等級ＢＩＴ                                           
           OF: ストレート                                                   
             ＷＫ−等級９    := 1                                           
           OF: ボックス                                                     
             ＷＫ−等級９    := 2                                           
           OF: Ｓ／Ｂストレート                                             
             ＷＫ−等級９    := 3                                           
           OF: Ｓ／Ｂボックス                                               
             ＷＫ−等級９    := 4                                           
           OF: Ｆペア                                                       
             ＷＫ−等級９    := 5                                           
           OF: Ｂペア                                                       
             ＷＫ−等級９    := 6                                           
           OF: チャンス／ピタリ                                             
             ＷＫ−等級９    := 7                                           
           OF: チャンス／一字違                                             
             ＷＫ−等級９    := 8                                           
           END:                                                             
         OF: ロト                                                           
           CASE: ＷＫ−等級ＢＩＴ                                           
           OF: １等                                                         
             ＷＫ−等級９    := 1                                           
           OF: ２等                                                         
             ＷＫ−等級９    := 2                                           
           OF: ３等                                                         
             ＷＫ−等級９    := 3                                           
           OF: ４等                                                         
             ＷＫ−等級９    := 4                                           
           OF: ５等                                                         
             ＷＫ−等級９    := 5                                           
           OF: ６等                                                         
             ＷＫ−等級９    := 6                                           
           OF: ７等                                                         
             ＷＫ−等級９    := 7                                           
           OF: ８等                                                         
             ＷＫ−等級９    := 8                                           
           OF: ９等                                                         
             ＷＫ−等級９    := 9                                           
           END:                                                             
         END:                                                               
       EXIT:                                                                
  *                                                                         
   SPACE:0                                                                  
   NOTE:                                                                    
   トランザクションエラーファイル出力処理                                   
   NEND:                                                                    
   PROC:TRNS-ERR-RTN                                                        
       ENTRY:                                                               
  * ファイルポインタセット                                                  
         ＷＫ−世代判定業務日付 := 退避ＫＨ受付日付                         
         CALL: SEDAI-RTN ; 世代区分判定処理                                 
         IF: ＷＫ−世代区分 = 世代Ａ                                        
           SET  FTRERPTR  TO  FTRERPTRA                                     
         ELSE: ; 世代Ｂ                                                     
           SET  FTRERPTR  TO  FTRERPTRB                                     
         END:                                                               
  * トランザクションエラーファイル読み込み（管理レコード）                  
         ＴＲＥＲ相対キー := 1                                              
         READ  トランザクションＥＲＦ  INVALID KEY CONTINUE                 
         IF:  ＳＴＳコード NOT = ZERO                                       
           @ZCTABORT( MSGID  = #RT201 ,                                     
                      PROGID = HRCAL010 ,                                   
                      CNT    = 15 ,                                         
                      TEXT1  = "ﾄﾗﾝｻﾞｸｼｮﾝｴﾗｰF" ,                            
                      TEXT2  = "-" ,                                        
                      TEXT3  = ＷＫ−世代区分 ,                             
                      TEXT4  = "READ" ,                                     
                      TEXT5  = ＴＲＥＲ相対キー ,                           
                      TEXT6  = ＳＴＳコード ,                               
                      TEXT7  = ＳＴＳ詳細 ) ;                               
         END:                                                               
  * トランザクションエラーファイル項目セット（管理レコード）                
         ＴＲＥＲカレント相対キー := ,                                      
                       ＴＲＥＲカレント相対キー + 1                         
         ＷＫ−相対番号 := ＴＲＥＲカレント相対キー                         
  * トランザクションエラーファイル更新（管理レコード）                      
         REWRITE  ＴＲＥＲ管理Ｒ  INVALID KEY CONTINUE                      
         IF:  ＳＴＳコード NOT = ZERO                                       
           @ZCTABORT( MSGID  = #RT201 ,                                     
                      PROGID = HRCAL010 ,                                   
                      CNT    = 16 ,                                         
                      TEXT1  = "ﾄﾗﾝｻﾞｸｼｮﾝｴﾗｰF" ,                            
                      TEXT2  = "-" ,                                        
                      TEXT3  = ＷＫ−世代区分 ,                             
                      TEXT4  = "REWRITE" ,                                  
                      TEXT5  = ＴＲＥＲ相対キー ,                           
                      TEXT6  = ＳＴＳコード ,                               
                      TEXT7  = ＳＴＳ詳細 ) ;                               
         END:                                                               
  * トランザクションエラーファイル項目セット（明細レコード）                
         INITIALIZE  ＴＲＥＲ明細Ｒ１.                                      
         ＴＲＥＲデータ種別    := 電文                                      
         ＴＲＥＲ処理状態      := 未処理 ;未処理(ｺｰﾄﾞ:00)                   
         ＴＲＥＲ送受信端末名  := ＷＫ−変換前送受信端末名                  
         ＴＲＥＲセンター状態  := ＷＫ−変換前センター状態                  
         IF: 退避ＫＨ電文種別 = 発券要求  OR ,                              
             退避ＫＨ電文種別 = 発券障害取消要求  OR ,                      
             退避ＫＨ電文種別 = 発券端末サーバ障害取消要求                  
            ＴＲＥＲ電文  :=  ＷＫ−発券電文ＴＢＬ(CNT)                     
         ELSE:                                                              
            ＴＲＥＲ電文  :=  ＷＫ−発券以外電文ＴＢＬ(CNT)                 
         END:                                                               
  * トランザクションエラーファイル出力（明細レコード）                      
         ＴＲＥＲ相対キー := ＷＫ−相対番号                                 
         WRITE  ＴＲＥＲ明細Ｒ１  INVALID KEY CONTINUE                      
         IF:  ＳＴＳコード NOT = ZERO                                       
           @ZCTABORT( MSGID  = #RT201 ,                                     
                      PROGID = HRCAL010 ,                                   
                      CNT    = 17 ,                                         
                      TEXT1  = "ﾄﾗﾝｻﾞｸｼｮﾝｴﾗｰF" ,                            
                      TEXT2  = "-" ,                                        
                      TEXT3  = ＷＫ−世代区分 ,                             
                      TEXT4  = "WRITE" ,                                    
                      TEXT5  = ＴＲＥＲ相対キー ,                           
                      TEXT6  = ＳＴＳコード ,                               
                      TEXT7  = ＳＴＳ詳細 ) ;                               
         END:                                                               
       EXIT:                                                                
  *                                                                         
   SPACE:0                                                                  
   NOTE:                                                                    
   トランザクション出力履歴ファイル読込処理                                 
   NEND:                                                                    
   PROC:TRSYRI-READ-RTN                                                     
       ENTRY:                                                               
         ＴＲＳＲＦＥＰ番号          :=  CNT-FEP                            
         ＴＲＳＲ販売チャネルコード  :=  CNT-CHANNEL                        
         READ  トランザクション出力履歴Ｆ                                   
                                       INVALID  CONTINUE.                   
         IF:  ＳＴＳコード  NOT =  ZERO                                     
            @ZCTABORT( MSGID   =  #RT201                                    
            ,          PROGID  =  HRCAL010                                  
            ,          CNT     =  19                                        
            ,          TEXT1   =  "TRNSｼｭﾂﾘｮｸﾘﾚｷF"                          
            ,          TEXT2   =  "-"                                       
            ,          TEXT3   =  "-"                                       
            ,          TEXT4   =  "READ"                                    
            ,          TEXT5   =  ＴＲＳＲキー項目                          
            ,          TEXT6   =  ＳＴＳコード                              
            ,          TEXT7   =  ＳＴＳ詳細             );                 
         END:                                                               
       EXIT:                                                                
  *                                                                         
   SPACE:0                                                                  
   NOTE:                                                                    
   トランザクション出力履歴ファイル更新処理                                 
   NEND:                                                                    
   PROC:TRSYRI-REWRITE-RTN                                                  
       ENTRY:                                                               
         REWRITE  トランザクション出力履歴Ｒ                                
                                       INVALID  CONTINUE.                   
         IF:  ＳＴＳコード  NOT =  ZERO                                     
            @ZCTABORT( MSGID   =  #RT201                                    
            ,          PROGID  =  HRCAL010                                  
            ,          CNT     =  20                                        
            ,          TEXT1   =  "TRNSｼｭﾂﾘｮｸﾘﾚｷF"                          
            ,          TEXT2   =  "-"                                       
            ,          TEXT3   =  "-"                                       
            ,          TEXT4   =  "REWRITE"                                 
            ,          TEXT5   =  ＴＲＳＲキー項目                          
            ,          TEXT6   =  ＳＴＳコード                              
            ,          TEXT7   =  ＳＴＳ詳細             );                 
         END:                                                               
       EXIT:                                                                
